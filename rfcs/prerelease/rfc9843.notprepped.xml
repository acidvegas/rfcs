<?xml version='1.0' encoding='UTF-8'?>


<!DOCTYPE rfc [
  <!ENTITY nbsp    "&#160;">
  <!ENTITY zwsp   "&#8203;">
  <!ENTITY nbhy   "&#8209;">
  <!ENTITY wj     "&#8288;">
]>

<rfc xmlns:xi="http://www.w3.org/2001/XInclude" category="std" docName="draft-ietf-lsr-flex-algo-bw-con-22" number="9843" consensus="true" ipr="trust200902" obsoletes="" updates="9350" submissionType="IETF" xml:lang="en" tocInclude="true" tocDepth="3" symRefs="true" sortRefs="true" version="3">

  <front>
    <title abbrev="IGP Flex-Algorithms: Bandwidth, Delay, and Metrics">IGP Flexible
    Algorithms: Bandwidth, Delay, Metrics, and Constraints</title>
    <seriesInfo name="RFC" value="9843"/>
    <author initials="S." surname="Hegde" fullname="Shraddha Hegde">
      <organization>Juniper Networks Inc.</organization>
      <address>
        <postal>
          <street>Exora Business Park</street>
          <city>Bangalore</city>
          <region>Karnataka</region>
          <code>560103</code>
          <country>India</country>
        </postal>
        <email>shraddha@juniper.net</email>
      </address>
    </author>
    <author initials="W." surname="Britto" fullname="William Britto">
      <organization>Juniper Networks Inc.</organization>
      <address>
        <email>bwilliam@juniper.net</email>
      </address>
    </author>
    <author initials="R." surname="Shetty" fullname="Rajesh Shetty">
      <organization>Juniper Networks Inc.</organization>
      <address>
        <email>mrajesh@juniper.net</email>
      </address>
    </author>
    <author initials="B." surname="Decraene" fullname="Bruno Decraene">
      <organization>Orange</organization>
      <address>
        <email>bruno.decraene@orange.com</email>
      </address>
    </author>
    <author initials="P." surname="Psenak" fullname="Peter Psenak">
      <organization>Cisco Systems</organization>
      <address>
        <email>ppsenak@cisco.com</email>
      </address>
    </author>
    <author initials="T." surname="Li" fullname="Tony Li">
      <organization>Juniper Networks Inc.</organization>
      <address>
        <email>tony.li@tony.li</email>
      </address>
    </author>
    <date year="2025" month="September"/>

    <area>RTG</area>
    <workgroup>lsr</workgroup>

    <keyword>AS</keyword>
    <keyword>IGP</keyword>

    <abstract>
      <t>
    Many networks configure the IGP link metric relative to the link capacity, and high
    bandwidth traffic gets routed per the link capacity. Flexible
    Algorithms provide mechanisms to create constraint-based paths in an IGP.
    This specification documents a generic metric-type and a
    set of bandwidth-related constraints to be used in Flexible Algorithms.
      </t>
      <t>This document updates RFC 9350.</t>
    </abstract>

  </front>
  <middle>
    <section anchor="sec_introduction" numbered="true" toc="default">
      <name>Introduction</name>
      <t>  High bandwidth traffic such as residential Internet traffic and
   machine-to-machine elephant flows benefit from using high capacity
   links.  Accordingly, many network operators define a link's metric
   relative to its capacity to help direct traffic to higher bandwidth
   links, but this is no guarantee that lower bandwidth links will be
   avoided, especially in failure scenarios.  To ensure that elephant
   flows are only placed on high capacity links, it would be useful to
   explicitly exclude the high throughput traffic from utilizing links
   below a certain capacity. Flex-Algorithm <xref target="RFC9350" format="default"/>
   provides a mechanism to create constrained paths by defining 
   a set of parameters consisting of
   calculation-type, metric-type, and a set of constraints.  In
   this document, we define further extensions to the Flexible Algorithm Definition (FAD) that
   will allow operators additional control over their traffic flows,
   especially with respect to bandwidth constraints. </t>
      <t>Historically, IGPs have done path computation by minimizing the
   sum of the link metrics along the path from source to
   destination. While the metric has been administratively defined,
   implementations have defaulted to a metric that is inversely
   proportional to link bandwidth. This has driven traffic to higher
   bandwidth links and has required manual metric manipulation to
   achieve the desired loading of the network.</t>
      <t>Over time, with the addition of different traffic types, the need
   for alternate types of metrics has evolved. Flex-Algorithm
   already supports using the minimum link delay and the
   administratively assigned traffic-engineering metrics in path
   computation. However, it is clear that additional metrics may be of
   interest in different situations. A network operator may seek to
   minimize their operational costs and thus may want a metric that
   reflects the actual fiscal costs of using a link.  Other traffic
   may require low jitter, leading to an entirely different set of
   metrics. With Flex-Algorithm, all of these different metrics, and
   more, could be used concurrently on the same network.</t>
      <t>In some circumstances, path computation constraints, such as
   administrative groups, can be used to ensure that traffic avoids
   particular portions of the network. These strict constraints are
   appropriate when there is an absolute requirement to avoid parts of
   the topology, even in failure conditions. However, if the
   requirement is less strict, then using a high metric in a portion
   of the topology may be more appropriate. </t>
      <t>This document defines a family of generic metrics that can advertise
      various types of administratively assigned metrics. This document introduces
   standard metric-types that have specific semantics and require 
   standardization.
   This document also specifies user-defined metric-types where specifics are
   not defined so that administrators are free to assign semantics as
      they see fit.</t>
  
      <t> <xref target="sec_fad_con" format="default"/> defines additional FAD <xref target="RFC9350" format="default"/> 
   constraints that allow the network
   administrator to preclude the use of low bandwidth links or high
   delay links. <xref target="sec_bw_metric" format="default"/> specifies a new bandwidth-based metric-type
   to be used with Flex-Algorithm and other applications.
   </t>
      <t> <xref target="sec_auto_metric" format="default"/>
   defines mechanisms to automatically calculate link metrics based on
   the parameters defined in the FAD and the advertised Maximum Link Bandwidth
   of each link. This is advantageous because administrators can change their
   criteria for metric assignment centrally, without individual
   modification of each link metric throughout the network. The procedures
   described in this document are intended to assign a metric to a link based on
   the total link capacity, and they are not intended to update the metric based
   on actual traffic flow. Thus, the procedures described in this document are not a
   replacement to the capability of a PCE  <xref target="RFC4655" format="default"/>, which has a dynamic view of
   the network and provides real-time bandwidth management or a distributed bandwidth
      management protocol.</t>

 <section anchor="req_lang" numbered="true" toc="default">
   <name>Requirements Language</name>
        <t>
    The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>", "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>", "<bcp14>SHALL
    NOT</bcp14>", "<bcp14>SHOULD</bcp14>", "<bcp14>SHOULD NOT</bcp14>", "<bcp14>RECOMMENDED</bcp14>", "<bcp14>NOT RECOMMENDED</bcp14>",
    "<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document are to be interpreted as
    described in BCP&nbsp;14 <xref target="RFC2119"/> <xref target="RFC8174"/> 
    when, and only when, they appear in all capitals, as shown here.
        </t>
 </section>
</section>

    <section anchor="sec_generic_metric" numbered="true" toc="default">
      <name>Generic Metric Advertisement</name>
      <t> IS-IS <xref target="RFC1195" format="default"/> and OSPF <xref target="RFC2328" format="default"/> advertise 
a metric for each link in their respective
 link state advertisements. Multiple metric-types are  already supported.
 Administratively assigned metrics are described in the original OSPF
 and IS-IS specifications. The Traffic Engineering Default Metric
is defined in <xref target="RFC5305" format="default"/> and <xref target="RFC3630" format="default"/>,
and the Unidirectional Link Delay is defined in
<xref target="RFC8570" format="default"/> and <xref target="RFC7471" format="default"/>.
Other metrics, such as jitter, reliability, and fiscal cost may be
   helpful, depending on the traffic class. Rather than attempt to
   enumerate all possible metrics of interest, this document specifies
   a generic mechanism for advertising metrics. </t>

      <t>
Each generic metric advertisement is on a per-link and per-metric-type
   basis.  The metric advertisement consists of a metric-type
   field and a value for the metric.  The metric-type field has been 
   assigned in the "IGP Metric-Type" IANA registry.  Metric-types
   0-127 are standard metric-types as assigned by IANA.  This document
   further specifies a user-defined metric-type space of metric-types
   128-255. They can be assigned by an operator for local use.
      </t>
      
      <t>Implementations <bcp14>MUST</bcp14> support sending and receiving a Generic Metric
 sub-TLV in Application-Specific Link Attributes (ASLA) encodings as 
 well as in TLV 22 and Extended Link Opaque Link State Advertisements (LSAs) <xref target="RFC7684" format="default"/> and TE-LSAs.
 The usage of a generic metric by an individual application is subject to the same
 rules that apply to other link attributes as defined in <xref target="RFC3630" format="default"/>,
 <xref target="RFC5305" format="default"/>, <xref target="RFC9479" format="default"/>,  
 <xref target="RFC9492" format="default"/>, and <xref target="RFC9350" format="default"/>.</t>
      <section anchor="sec_isis_gen_metric" numbered="true" toc="default">
        <name>IS-IS Generic Metric Sub-TLV</name>
        <t>The IS-IS Generic Metric sub-TLV specifies the link metric for a given
   metric-type.  Typically, this metric is assigned by a
   network administrator.
   The Generic Metric sub-TLV is advertised in the TLVs/sub-TLVs below:</t>
        <ol spacing="normal" type="a">
          <li>TLV 22 (Extended IS reachability) <xref target="RFC5305"
          format="default"/></li>
          <li>TLV 222 (MT-ISN) <xref target="RFC5120" format="default"/></li>
          <li>TLV 23 (IS Neighbor Attribute) <xref target="RFC5311"
          format="default"/></li>
          <li>TLV 223 (MT IS Neighbor Attribute) <xref target="RFC5311"
          format="default"/></li>
          <li>TLV 141 (Inter-AS Reachability Information) <xref
          target="RFC9346" format="default"/></li>
          <li>sub-TLV 16 (Application-Specific Link Attributes (ASLA)) of TLVs
          22/222/23/223/141 <xref target="RFC9479" format="default"/></li>
          <li>TLV 25 (L2 Bundle Member Attributes) <xref target="RFC8668"
          format="default"/>. Marked as "y(s)" (shareable among bundle
          members).</li>
        </ol>
        <figure anchor="isis_gen_metric_sub_tlv">
          <name>IS-IS Generic Metric Sub-TLV</name>	  
          <artwork name="" type="" align="left" alt=""><![CDATA[
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Type        |     Length    |  metric-type  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         Value                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
	</figure>
	<t>
where:
	</t>

<dl spacing="normal" newline="true">
  <dt>Type (1 octet):</dt>
  <dd>An 8-bit field assigned by IANA (17).  This value
  uniquely identifies the Generic Metric TLV.</dd>
  <dt>Length (1 octet):</dt>
  <dd>An 8-bit field indicating the total length, in octets, of the subsequent
  fields. For this TLV, the Length is set to 4.</dd>
  <dt>Metric-Type (1 octet):</dt>
  <dd>An 8-bit field specifying the type of metric.  The value is taken from
  the "IGP Metric-Type" registry maintained by IANA. The metric-type may be
  any value that is indicated as allowed in the Generic Metric sub-TLV by the
  "IGP Metric-Type" registry.</dd>
  <dt>Value (3 octets):</dt>
  <dd>A 24-bit unsigned integer representing the metric value.  The valid
  range is from 0 to 16,777,215 (0xFFFFFF).</dd>
</dl>
        <t>
    The Generic Metric sub-TLV <bcp14>MAY</bcp14> be advertised multiple times.
    For a particular metric-type,
    the Generic Metric sub-TLV <bcp14>MUST</bcp14> be advertised only once for a link
    when advertised in TLVs 22, 222, 23, 223, and 141.
    When the Generic Metric sub-TLV is advertised in ASLA,
    each metric-type <bcp14>MUST</bcp14> be advertised only once per-application for a link.
    If there are multiple Generic Metric sub-TLVs advertised for a link
    for the same metric-type  (and the same application in case of ASLA)
    in one or more received Link State Protocol Data Units (LSPDUs), advertisement in the lowest-numbered fragment
    <bcp14>MUST</bcp14> be used, and the subsequent instances <bcp14>MUST</bcp14> be ignored.
        </t>
        <t>For a link, if the metric-type corresponds to a metric-type for
	which legacy advertisement mechanisms exist (e.g., the IGP Metric, 
	the Min Unidirectional Link Delay, or the 
    Traffic Engineering Default Metric), the legacy metric-types <bcp14>MUST</bcp14> 
	be utilized from the existing TLV or sub-TLVs. If a Generic Metric 
	advertises a legacy metric, it <bcp14>MUST</bcp14> be ignored.
        </t>
        <t>A metric value of
   0xFFFFFF is considered a maximum link metric, and a link having 
   this metric value <bcp14>MUST</bcp14> be used during Flex-Algorithm calculations
   as a last resort link as described in <xref section="15.3" target="RFC9350" format="default"/>. 
   A link can be made unusable by Flex-Algorithm by leaving out Generic Metric
   advertisement of the particular metric-type that the Flex-Algorithm 
   uses, as described in <xref target="RFC9350" format="default"/>.
        </t>
        <t> During the router maintenance activity, the Generic Metric for 
   all the links on the node <bcp14>MAY</bcp14> be set to a maximum value of 
   16,777,215 (0xFFFFFF), as it is the maximum usable link metric for the 
   Flex-Algorithm calculations.</t>
      </section>
      <section anchor="sec_ospf_gen_metric" numbered="true" toc="default">
        <name>OSPF Generic Metric Sub-TLV</name>
        <t>
   The OSPF Generic Metric sub-TLV specifies the link metric for a given
   metric-type. Typically, this metric is assigned by a
   network administrator.
   The Generic Metric sub-TLV is advertised in the TLVs below:</t>
   <ol type="a" spacing="normal">
     
          <li>sub-TLV of TE Link TLV (type 2) of OSPF TE LSA <xref target="RFC3630" format="default"/>.</li>
          <li>sub-TLV of TE Link TLV (type 2) of OSPFv2 Inter-AS-TE-v2 LSA <xref target="RFC5392" format="default"/>.</li>
          <li>sub-TLV of TE Link TLV (type 2) of OSPFv3 Intra-Area-TE-LSA <xref target="RFC5329" format="default"/>.</li>
          <li>sub-TLV of TE Link TLV (type 2) of OSPFv3 Inter-AS-TE-v3 LSA <xref target="RFC5392" format="default"/>.</li>
          <li>sub-TLV of Application-Specific Link Attributes (ASLA) sub-TLV <xref target="RFC9492" format="default"/> 
            of the OSPFv2 Extended Link TLV <xref target="RFC7684" format="default"/>.</li>
          <li>sub-TLV of Application-Specific Link Attributes (ASLA) sub-TLV <xref target="RFC9492" format="default"/>
            of the OSPFv3 Router-Link TLV <xref target="RFC8362" format="default"/>.</li>
          <li>sub-TLV of the OSPFv2 L2 Bundle Member Attributes sub-TLV <xref target="RFC9356" format="default"/>.</li>
          <li>sub-TLV of the OSPFv3 L2 Bundle Member Attributes sub-TLV <xref target="RFC9356" format="default"/>.</li>
        </ol>

        <t>The Generic Metric sub-TLV, types 25/36/34, is 8 octets in length.
</t>
        <figure anchor="ospf_gen_metric_sub_tlv">
          <name>OSPF Generic Metric Sub-TLV</name>
          <artwork name="" type="" align="left" alt=""><![CDATA[
       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |              Type             |             Length            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | metric-type   |         Reserved (MBZ)                        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                            Value                              |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ]]></artwork>
	</figure>

<t>
  where:
</t>
<dl spacing="normal" newline="true">
  <dt>Type (2 octets):</dt>
  <dd>A 16-bit field assigned by IANA (25/36/34).
  This value uniquely identifies the Generic Metric TLV.</dd>
  <dt>Length (2 octets):</dt>
  <dd>A 16-bit field indicating the total length, in octets, of the subsequent
  fields. For this TLV, the Length is set to 8.</dd>
  <dt>Metric-Type (1 octet):</dt>
  <dd>An 8-bit field specifying the type of metric.  The value is taken from
  the "IGP Metric-Type" registry maintained by IANA. The metric-type may be
  any value that is indicated as allowed in the Generic Metric sub-TLV by the
  "IGP Metric-Type" registry.</dd>
  <dt>Reserved (3 octets):</dt>
  <dd><bcp14>MUST</bcp14> set to zero by the sender and <bcp14>MUST</bcp14> be ignored by the receiver.</dd>
  <dt>Value (4 octets):</dt>
  <dd>A 32-bit unsigned integer representing the metric value.
  The valid
  range is from 0 to 4,294,967,295 (0xFFFFFFFF).</dd>
</dl>

<t>The Generic Metric sub-TLV <bcp14>MAY</bcp14> be advertised multiple times.
For a particular metric-type, the Generic Metric sub-TLV <bcp14>MUST</bcp14>
be advertised only once for a link when advertised as (a) through (d) above.
When the Generic Metric sub-TLV is advertised as a sub-TLV of ASLA, it
<bcp14>MUST</bcp14> be advertised only once per application for a link.  If
there are multiple Generic Metric sub-TLVs advertised for a link for the same
metric-type (and the same application in case of ASLA) in one or more received
LSAs, advertisement in the lowest-numbered LSA <bcp14>MUST</bcp14> be used, and
the subsequent instances <bcp14>MUST</bcp14> be ignored.</t>
        <t>For a link, if the metric-type corresponds to a metric-type for 
	which legacy advertisement mechanisms exist (e.g., the IGP Metric, 
	the Min Unidirectional Link Delay, or the Traffic Engineering 
	Default Metric), the legacy metric-types <bcp14>MUST</bcp14> be utilized from 
	the existing TLV or sub-TLVs. If a Generic Metric advertises a
	legacy metric, it <bcp14>MUST</bcp14> be ignored.
</t>
        <t>A metric value of
   0xFFFFFFFF is considered a maximum link metric, and a link having 
   this metric value <bcp14>MUST</bcp14> be used during Flex-Algorithm calculations
   as a last resort link, as described in <xref section="15.3" target="RFC9350" format="default"/>.</t>
        <t>A link can be made unusable by Flex-Algorithm by leaving out Generic Metric
   advertisement of the particular metric-type that the Flex-Algorithm 
	uses, as described in <xref target="RFC9350" format="default"/>.</t>


        <t> During the router maintenance activity, the Generic Metric for 
   all the links on the node <bcp14>MAY</bcp14> be set to a maximum value of 
   4,294,967,295 (0xFFFFFFFF), as it is the maximum usable link metric for the 
   Flex-Algorithm calculations.</t>
      </section>
      <section anchor="sec_multi_area" numbered="true" toc="default">
        <name>Generic Metric Applicability to Flexible Algorithm Multi-Domain/Multi-Area Networks</name>
        <t>Generic Metric can be used by Flex-Algorithm
 by specifying the metric-type in the
Flexible Algorithm Definitions. When Flex-Algorithm is used in a multi-area network,
<xref target="RFC9350" format="default"/> defines the Flexible Algorithm Prefix Metric (FAPM)
 sub-TLV that carries
the Flexible-Algorithm-specific metric. Metrics carried in FAPM will be equal
to the metric to reach the prefix for that Flex-Algorithm in its
source area or domain (source area from the Area Border Router (ABR) perspective). When Flex-Algorithm uses
Generic Metric, the same procedures as described in 
<xref target="RFC9350" sectionFormat="of" section="13"/>
are used to send and process the FAPM sub-TLV.</t>
      </section>
    </section>
    <section anchor="sec_fad_con" numbered="true" toc="default">
      <name>FAD Constraint Sub-TLVs</name>
      <t>

   Large high throughput flows are referred to as "elephant flows".
   Directing an elephant flow
   down a low-bandwidth link might congest the link and cause other 
   critical application traffic flowing on the link to drop. Thus, in the
   context of Flex-Algorithm, it would be useful to be able to
   constrain the topology to only those links capable of supporting a
      minimum amount of bandwidth.</t>
      
      <t>If the capacity of a low bandwidth link is constant, constraining the topology to avoid those links can already be achieved
   through the use of administrative groups. However, when a Layer 3
   link is actually a collection of Layer 2 links (Link Aggregation Group (LAG) / Layer 2
   Bundle), the link bandwidth will vary based on the set of active
   constituent links. This could be automated by having an
   implementation vary the advertised administrative groups based on
   bandwidth, but this seems unnecessarily complex and expressing this
   requirement as a direct constraint on the topology seems
   simpler. This is also advantageous if the minimum required
   bandwidth changes, as this constraint would provide a single
   centralized, coordinated point of control.</t>
      <t>To satisfy this requirement, this document defines an
   Exclude Minimum Bandwidth
   constraint.  When this constraint is advertised in a FAD,
   a link will be pruned from the Flex-Algorithm topology if the
   link's advertised maximum link bandwidth value is below the FAD advertised
   minimum bandwidth value.</t>
      <t>Similarly, this document defines an Exclude Maximum Link Delay
   constraint. Applications, such as High-Frequency Trading are sensitive 
   to link delays and may perform poorly in networks prone to delay
   variability, such as those with transparent Layer 2 link 
   recovery mechanisms or satellite links.
   Mechanisms already exist to measure the link delay dynamically and
   advertise it in the IGP.  Networks that employ dynamic link-delay
   measurement, may want to exclude links that have a delay over a
   given threshold.</t>
      <section anchor="sec_isis" numbered="true" toc="default">
        <name>IS-IS FAD Constraint Sub-TLVs</name>
        <section anchor="sec_isis_bw_exclusion" numbered="true" toc="default">
          <name>IS-IS Exclude Minimum Bandwidth Sub-TLV</name>
          <t>

IS-IS Flex-Algorithm Exclude Minimum Bandwidth (FAEMB) sub-TLV  is a
sub-TLV of the IS-IS FAD sub-TLV. It has the following format:

</t>
          <figure anchor="isis_faemb_sub_tlv">
            <name>IS-IS FAEMB Sub-TLV</name>
            <artwork name="" type="" align="left" alt=""><![CDATA[
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Type     |    Length     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Min Bandwidth                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
	  </figure>

<t>where:</t>
<dl spacing="normal" newline="true">
  <dt>Type (1 octet):</dt>
  <dd>An 8-bit field assigned by IANA (6).  This value
  uniquely identifies the FAEMB sub-TLV.</dd>
  <dt>Length (1 octet):</dt>
  <dd>An 8-bit field indicating the total length, in octets, of the subsequent
  fields. For this sub-TLV, the Length is set to 4.</dd>
  <dt>Min Bandwidth (4 octets):</dt>
  <dd>A 32-bit field specifying the link bandwidth encoded in IEEE floating
  point format (32 bits) <xref target="IEEE754-2019"/>.  The units are bytes per second.</dd>
</dl>

          <t>The FAEMB sub-TLV <bcp14>MUST</bcp14> appear once at most in the FAD sub-TLV.
    If it appears more than once, the IS-IS FAD sub-TLV <bcp14>MUST</bcp14> be
   ignored by the receiver. </t>
          <t>The minimum bandwidth value advertised in the FAEMB sub-TLV <bcp14>MUST</bcp14> be compared with
   maximum link bandwidth value advertised in sub-sub-TLV 9 of the ASLA sub-TLV <xref target="RFC9479" format="default"/>.
   If the L-flag is set in the ASLA sub-TLV, the minimum bandwidth value advertised in the FAEMB
   sub-TLV <bcp14>MUST</bcp14> be compared with the maximum link bandwidth value as
   advertised in the sub-TLV 9 of the TLVs
   22/222/23/223/141 <xref target="RFC5305" format="default"/>, as defined in <xref target="RFC9479" sectionFormat="of" section="4.2"/>. </t>
          <t>If the maximum link bandwidth value is lower than the minimum
   link bandwidth value advertised in the FAEMB sub-TLV,
   the link <bcp14>MUST</bcp14> be excluded from the Flex-Algorithm topology.

  If a link does not have the Maximum Link Bandwidth advertised but the
  FAD contains the FAEMB sub-TLV, then that link
   <bcp14>MUST NOT</bcp14> be excluded from the topology based on the Minimum
   Bandwidth constraint.
          </t>
        </section>
        <section anchor="sec_isis_delay_exclusion" numbered="true" toc="default">
          <name>IS-IS Exclude Maximum Delay Sub-TLV</name>
          <t>

IS-IS Flex-Algorithm Exclude Maximum Delay (FAEMD) sub-TLV is a
sub-TLV of the IS-IS FAD sub-TLV. It has the following format:

</t>
          <figure anchor="isis_faemd_sub_tlv">
            <name>IS-IS FAEMD Sub-TLV</name>
            <artwork name="" type="" align="left" alt=""><![CDATA[
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Type     |    Length     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Max Link Delay            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
	  </figure>
<t>where:</t>
<dl spacing="normal" newline="true">
  <dt>Type (1 octet):</dt>
  <dd>An 8-bit field assigned by IANA (7).  This value
  uniquely identifies the FAEMD sub-TLV.</dd>
  <dt>Length (1 octet):</dt>
  <dd>An 8-bit field indicating the total length, in octets, of the subsequent
  fields. For this sub-TLV, the Length is set to 3.</dd>
  <dt>Max Link Delay (3 octets):</dt>
  <dd>A 24-bit field specifying the Maximum link delay in microseconds.</dd>
</dl>	  

<t>The FAEMD sub-TLV <bcp14>MUST</bcp14> appear only once in the FAD sub-TLV.
If it appears more than once, the IS-IS FAD sub-TLV <bcp14>MUST</bcp14> be
ignored by the receiver.</t>
          <t>The maximum link delay value advertised in the FAEMD sub-TLV <bcp14>MUST</bcp14> be compared with
   Min Unidirectional Link Delay advertised in sub-sub-TLV 34 of the ASLA sub-TLV <xref target="RFC9479" format="default"/>.
   If the L-flag is set in the ASLA sub-TLV, the maximum link delay value advertised in the FAEMD
   sub-TLV <bcp14>MUST</bcp14> be compared with Min Unidirectional Link Delay as
   advertised by the sub-TLV 34 of the TLVs
   22/222/23/223/141 <xref target="RFC8570" format="default"/>, as defined in <xref target="RFC9479" sectionFormat="of" section="4.2"/>. </t>
          <t>If the  Min Unidirectional Link Delay value is higher than the
   Maximum Link Delay advertised in the FAEMD sub-TLV, the link <bcp14>MUST</bcp14> be
   excluded from the Flex-Algorithm topology.

If a link does not have the Min Unidirectional Link Delay advertised but
the FAD contains the FAEMD sub-TLV, then that link <bcp14>MUST NOT</bcp14> be
   excluded from the topology based on the Maximum Delay constraint.
          </t>
        </section>
      </section>
      <section anchor="sec_ospf" numbered="true" toc="default">
        <name>OSPF FAD Constraint Sub-TLVs</name>
        <section anchor="sec_ospf_bw_exclusion" numbered="true" toc="default">
          <name>OSPF Exclude Minimum Bandwidth Sub-TLV</name>
          <t>

OSPF Flex-Algorithm Exclude Minimum Bandwidth (FAEMB) sub-TLV is a
sub-TLV of the OSPF FAD TLV. It has the following format:

</t>
          <figure anchor="ospf_faemb_sub_tlv">
            <name>OSPF FAEMB Sub-TLV</name>
            <artwork name="" type="" align="left" alt=""><![CDATA[
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Type                     |    Length                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Min Bandwidth                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
	  </figure>
<t>where:</t>
<dl spacing="normal" newline="true">
  <dt>Type (2 octets):</dt>
  <dd>A 16-bit field assigned by IANA (6).  This value
  uniquely identifies the OSPF FAEMB sub-TLV.</dd>
  <dt>Length (2 octets):</dt>
  <dd>A 16-bit field indicating the total length, in octets, of the subsequent
  fields. For this sub-TLV, the Length is set to 4.</dd>
  <dt>Min Bandwidth (4 octets):</dt>
  <dd>A 32-bit field specifying the link bandwidth encoded in IEEE floating
  point format (32 bits)<xref target="IEEE754-2019"/>.  The units are bytes per second.</dd>
</dl>

          <t>The FAEMB sub-TLV <bcp14>MUST</bcp14> only appear once in the FAD sub-TLV.
    If it appears more than once, the OSPF FAD TLV <bcp14>MUST</bcp14> be
    ignored by the receiver.</t>
          <t>The Maximum Link Bandwidth as advertised in the Extended Link TLV
   in the Extended Link Opaque LSA in OSPFv2 <xref target="RFC7684" format="default"/>
   or as a sub-TLV
   of the Router-Link TLV of the E-Router-LSA Router-Link TLV in 
   OSPFv3 <xref target="RFC8362" format="default"/> <bcp14>MUST</bcp14> be  compared against
   the Minimum Bandwidth advertised in the FAEMB sub-TLV.
   If the link bandwidth value is lower than the Minimum Bandwidth 
   advertised in the FAEMB sub-TLV, the link <bcp14>MUST</bcp14> be excluded 
   from the Flex-Algorithm topology.
          </t>
          <t>If a link does not have the Maximum Link Bandwidth advertised
   but the FAD contains the FAEMB sub-TLV, then that link <bcp14>MUST</bcp14> be included in the
   topology and proceed to apply further pruning rules for the link.
          </t>
        </section>
        <section anchor="sec_ospf_delay_exclusion" numbered="true" toc="default">
          <name>OSPF Exclude Maximum Delay Sub-TLV</name>
          <t>

The OSPF Flex-Algorithm Exclude Maximum Delay (FAEMD) sub-TLV is a
sub-TLV of the OSPF FAD TLV. It has the following format.

</t>
          <figure anchor="ospf_faemd_sub_tlv">
            <name>OSPF FAEMD Sub-TLV</name>
            <artwork name="" type="" align="left" alt=""><![CDATA[
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Type                     |    Length                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  RESERVED     |                     Max Link Delay            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
</figure>

<t>where:</t>
<dl spacing="normal" newline="true">
  <dt>Type (2 octets):</dt>
  <dd>A 16-bit field assigned by IANA (7).  This value
  uniquely identifies the OSPF FAEMD sub-TLV.</dd>
  <dt>Length (2 octets):</dt>
  <dd>A 16-bit field indicating the total length, in octets, of the subsequent
  fields. For this sub-TLV, the Length is set to 4.</dd>
  <dt>Reserved (1 octet):</dt>
  <dd><bcp14>MUST</bcp14> be set to zero by the sender and <bcp14>MUST</bcp14> be ignored by the receiver.</dd>
  <dt>Max Link Delay (3 octets):</dt>
  <dd>A 24-bit field specifying the Maximum link delay in microseconds.</dd>
</dl>

          <t> The FAEMD sub-TLV <bcp14>MUST</bcp14> only appear once in the OSPF FAD TLV.
    If it appears more than once, the OSPF FAD TLV <bcp14>MUST</bcp14> be
   ignored by the receiver.
          </t>

          <t>The Min Delay value advertised via the Min/Max Unidirectional Link Delay 
    of the ASLA sub-TLV <xref target="RFC9492" format="default"/> <bcp14>MUST</bcp14> be compared against the Maximum Delay
    advertised in the FAEMD sub-TLV. If the Min Unidirectional Link Delay is higher
    than the Maximum Delay advertised in the FAEMD sub-TLV, the link <bcp14>MUST</bcp14> be
    excluded from the Flex-Algorithm topology. If the
    Min/Max Unidirectional Link Delay is not advertised for a link but 
	the FAD contains this sub-TLV, then that link <bcp14>MUST NOT</bcp14> be
   excluded from the topology based on the Maximum Delay constraint.
          </t>
        </section>
      </section>
    </section>
    <section anchor="sec_bw_metric" numbered="true" toc="default">
      <name>Bandwidth Metric Advertisement</name>
      <t>
   Historically, IGP implementations have made default metric
   assignments based on link bandwidth. This has proven to be useful
   but has suffered from having different defaults across
   implementations and from the rapid growth of link bandwidths. With
   Flex-Algorithm, the network administrator can define a function
   that will produce a metric for each link and have each node
   automatically compute each link's metric based on its bandwidth.</t>
      <t>This document defines a standard metric-type for this purpose
   called the "Bandwidth Metric".  The Bandwidth Metric <bcp14>MAY</bcp14> be
   advertised in the Generic Metric sub-TLV with the metric-type set
   to "Bandwidth Metric".  IS-IS and OSPF will advertise this type
   of metric in their link advertisements. The Bandwidth Metric is a link
   attribute, and it <bcp14>MUST</bcp14> follow <xref target="RFC9350" sectionFormat="of" section="12"/> for its advertisement and processing during Flex-Algorithm calculation.</t>
      <t> Flex-Algorithm uses this
   metric-type by specifying the bandwidth metric as the metric-type
   in a FAD TLV. A FAD TLV may also specify an automatic computation
   of the bandwidth metric based on a link's advertised bandwidth. An
   explicit advertisement of a link's bandwidth metric using the
   Generic Metric sub-TLV overrides this automatic computation.
   The automatic Bandwidth metric calculation sub-TLVs are advertised
   in the FAD TLV, and these parameters are applicable to applications
   such as Flex-Algorithm that make use of the FAD TLV.
</t>
      <section anchor="sec_auto_metric" numbered="true" toc="default">
        <name>Automatic Metric Calculation</name>
        <t> Networks that are designed to be highly regular and that follow uniform
   metric assignment may want to simplify their operations by
   automatically calculating the bandwidth metric. When
   a FAD advertises the metric-type as Bandwidth Metric and the link does
   not have the Bandwidth Metric advertised, automatic metric derivation
   can be used with additional FAD constraint advertisement as
   described in this section.  </t>
        <t> If a link's bandwidth changes, then the delay in learning about the
   change may create the possibility of micro-loops in the
   topology. This is no different from the IGP's susceptibility to
   micro-loops during a metric change.  The micro-loop avoidance
   procedures described in <xref target="I-D.bashandy-rtgwg-segment-routing-uloop" format="default"/>
   or any other mechanism as described in the framework <xref target="RFC5715" format="default"/>
   can be used to avoid micro-loops when the automatic metric
   calculation is deployed.</t>
        <t> Computing the metric between adjacent systems based on bandwidth
   becomes more complex in the case of parallel adjacencies. If there
   are parallel adjacencies between systems, then the bandwidth
   between the systems is the sum of the bandwidth of the parallel
   links. This is somewhat more complex to deal with, so there is an
   optional mode for computing the aggregate bandwidth.</t>
        <section anchor="sec_auto_metric_mode" numbered="true" toc="default">
          <name>Automatic Metric Calculation Modes</name>
          <section anchor="sec_simple" numbered="true" toc="default">
            <name>Simple Mode</name>
            <t> In Simple Mode, the Maximum Link Bandwidth of a single Layer 3 link
   is used to derive the metric.  This mode is suitable for
   deployments that do not use parallel Layer 3 links. In this case,
   the computation of the metric is straightforward.

   If a Layer 3 link is composed of a Layer 2 bundle, then the link
   bandwidth is the sum of the bandwidths of the working components
   and may vary with Layer 2 link failures. </t>
          </section>
          <section anchor="sec_intf_grp" numbered="true" toc="default">
            <name>Interface Group Mode</name>
            <t> The Simple Mode of metric calculation may not work well when there
   are multiple parallel Layer 3 interfaces between two nodes.
   Ideally, the metric between two systems should be the same given
   the same bandwidth, whether the bandwidth is provided by parallel
   Layer 2 links or parallel Layer 3 links. To address this, in
   Interface Group Mode, nodes <bcp14>MUST</bcp14> compute the aggregate bandwidth of
   all parallel adjacencies, <bcp14>MUST</bcp14> derive the metric based on the
   aggregate bandwidth, and <bcp14>MUST</bcp14> apply the resulting metric to each of
   the parallel adjacencies. Note that a single elephant flow is normally
   pinned to a single Layer 3 interface. If the single Layer 3 link
   bandwidth is not sufficient for any single elephant flow, the mechanisms
   to solve this issue are outside the scope of this document.
</t>
            <figure anchor="interface_grp">
              <name>Parallel Interfaces</name>
              <artwork name="" type="" align="left" alt=""><![CDATA[
        A------B====C====F====D
               |              |
                ------E-------
      ]]></artwork>
            </figure>
            <t>
   For example, in the above diagram, there are two parallel links
   between B-&gt;C, C-&gt;F, F-&gt;D.  Let us assume the link bandwidth is
   uniform 10 Gbps on all links. When bandwidth is used to derive the metric 
   for the links, the metric for each link will be
   the same. Traffic from B to D will be forwarded as B-&gt;E-&gt;D because
   the metric will be lower.  Since the
   bandwidth is higher on the B&nbhy;&gt;C-&gt;F-&gt;D path, the metric for that
   path should be lower than the B-&gt;E-&gt;D path to attract the traffic on
   the B-&gt;C-&gt;F-&gt;D path.  Interface
   Group Mode should be preferred in cases where there are parallel Layer 3
   links.
            </t>
            <t>
    In the Interface Group Mode, every node  <bcp14>MUST</bcp14>
    identify the set of parallel links between a pair
    of nodes based on IGP link advertisements
    and <bcp14>MUST</bcp14> consider cumulative bandwidth of the
    parallel links while arriving at the metric of each link. </t>
            <t>The parallel Layer 3 links between two nodes may not have the 
	   same bandwidth. In such cases, the method described in Interface Group Mode will
	   result in the same metric being used for all the parallel links, which may cause
	   undesired load balancing on the links. In such cases, a device may locally
	   apply a load-balancing factor relative to the link bandwidth on the ECMP next hops.
	   The load-balancing mechanisms are outside the scope of this document.</t>
          </section>
        </section>
        <section anchor="sec_auto_metric_methods" numbered="true" toc="default">
          <name>Automatic Metric Calculation Methods</name>
          <t>
In automatic metric calculation for simple and Interface Group Mode,
Maximum Link Bandwidth of the links is used to derive the metric. 
There are two types of automatic metric derivation methods.</t>
          <ol type="1" spacing="normal">
            <li>Reference bandwidth method</li>
            <li>Bandwidth thresholds method</li>
          </ol>

          <section anchor="sec_ref_bw_method" numbered="true" toc="default">
            <name>Reference Bandwidth Method</name>
            <t>In many networks, the metric is inversely proportional to the link
   bandwidth.  The administrator or implementation selects a reference
   bandwidth and the metric is derived by dividing the reference
   bandwidth by the advertised Maximum Link Bandwidth.  Advertising
   the reference bandwidth in the FAD constraints allows the metric
   computation to be done on every node for each link.
   The metric is computed using reference bandwidth and the advertised link bandwidth.
   Centralized control of this
   reference bandwidth simplifies management in the case where the
   reference bandwidth changes. In order to ensure that small
   bandwidth changes do not change the link metric, it is useful to
   define the granularity of the bandwidth that is of interest.  The
   link bandwidth will be truncated to this granularity before
   deriving the metric.  </t>
            <t>For example,</t>
                <t indent="3">reference bandwidth = 1000G  </t>
                <t indent="3">Granularity = 20G </t>
                <t indent="3">The derived metric is 10 for link bandwidth in the range 100G to 119G </t>
          </section>
          <section anchor="sec_bw_threshold_method" numbered="true" toc="default">
            <name>Bandwidth Thresholds Method</name>
            <t> The reference bandwidth approach described above provides a uniform
   metric value for a range of link bandwidths.  In certain cases,
   there may be a need to define non-proportional metric values for
   the varying ranges of link bandwidth.  For example, bandwidths from
   10G to 30G are assigned metric value 100, bandwidth from 30G to 70G
   are assigned a metric value of 50, and bandwidths greater than 70G have a
   metric of 10.  In order to support this, a staircase mapping based
   on bandwidth thresholds is supported in the FAD.  This
   advertisement contains a set of threshold values and associated
   metrics. </t>
          </section>
        </section>
        <section anchor="sec_auto_isis" numbered="true" toc="default">
          <name>IS-IS FAD Constraint Sub-TLVs for Automatic Metric Calculation</name>
          <section anchor="sec_isis_auto_ref_bw" numbered="true" toc="default">
            <name>Reference Bandwidth Sub-TLV</name>
            <t>
This section provides FAD constraint advertisement details for the
reference bandwidth method of metric calculation, as described in
 <xref target="sec_ref_bw_method" format="default"/>.

The Flexible Algorithm Definition Reference Bandwidth (FADRB) sub-TLV is
a sub-TLV of the IS-IS FAD sub-TLV. It has the following format:


</t>
            <figure anchor="isis_fadrb_sub_tlv">
              <name>IS-IS FADRB Sub-TLV</name>
              <artwork name="" type="" align="left" alt=""><![CDATA[
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Type     |    Length     |     Flags     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Reference Bandwidth                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Granularity Bandwidth                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
</figure>

<t>where:</t>
   
<dl spacing="normal" newline="true">
  <dt>Type (1 octet):</dt>
  <dd>An 8-bit field assigned by IANA (8).  This value
  uniquely identifies the IS-IS FADRB sub-TLV.</dd>
  <dt>Length (1 octet):</dt>
  <dd>An 8-bit field indicating the total length, in octets, of the subsequent
  fields. For this sub-TLV, the Length is set to 9.</dd>
  <dt>Flags (1 octet):</dt>
  <dd><t>An 8-bit field containing flags.</t>
  <artwork name="" type="" align="left" alt=""><![CDATA[
                 0 1 2 3 4 5 6 7
                +-+-+-+-+-+-+-+-+
                |G|             |
                +-+-+-+-+-+-+-+-+
		]]></artwork></dd>

  <dt>G-flag:</dt>
  <dd>When set, Interface Group Mode <bcp14>MUST</bcp14> be used to derive
  total link bandwidth.  Unassigned bits <bcp14>MUST</bcp14> be set to
  zero and <bcp14>MUST</bcp14> be ignored by the receiver.</dd>

  <dt>Reference Bandwidth (4 octets):</dt>
  <dd>A 32-bit field with Bandwidth encoded in IEEE floating point format
  <xref target="IEEE754-2019"/>.  The units are bytes per second.</dd>
  <dt>Granularity Bandwidth (4 octets):</dt>
  <dd>A 32-bit field with Bandwidth encoded in IEEE floating point format
  <xref target="IEEE754-2019"/>.  The units are bytes per second.</dd>
</dl>                  
<t>When granularity_bw is less than or equal to Total_link_bandwidth, then:</t>

<dl spacing="normal" newline="false">
  <dt>Metric calculation:</dt><dd>(Reference_bandwidth) / (Total_link_bandwidth - (Modulus of(Total_link_bandwidth, granularity_bw)))</dd>
</dl>
                                            
<t>When granularity_bw is greater than Total_link_bandwidth, then:</t>
<dl spacing="normal" newline="false">
  <dt>Metric calculation:</dt><dd>Reference_bandwidth / Total_link_bandwidth</dd>
</dl>
                                       
<t>The division used here is integer division.  Modulus of operation is
defined as a remainder value when two numbers are divided.</t>

            <t>   The Granularity Bandwidth value ensures that the metric
         does not change when there is a small
         change in the link bandwidth.
   The IS-IS FADRB sub-TLV <bcp14>MUST NOT</bcp14> appear more than once in an IS-IS FAD
   sub-TLV.  If it appears more than once, the IS-IS FAD sub-TLV <bcp14>MUST</bcp14> be ignored
   by the receiver. The value advertised in the Reference Bandwidth field <bcp14>MUST</bcp14> be non-zero.
   If a zero value is advertised in the Reference Bandwidth field in the IS-IS FADRB sub-TLV,
   the sub-TLV <bcp14>MUST</bcp14> be ignored.</t>
            <t>If a Generic Metric sub-TLV with a Bandwidth metric-type
   is advertised for a link,
   the Flex-Algorithm calculation <bcp14>MUST</bcp14> use the advertised Bandwidth Metric
   and <bcp14>MUST NOT</bcp14> use the automatically derived metric for that link.
	    </t>

<t>
  In case of Interface Group Mode, the following rules apply to parallel links:
</t>

  <ul spacing="normal">
    <li>
    <t>If all the parallel links have been advertised with the Bandwidth Metric:</t>
    <t>The individual link Bandwidth Metric <bcp14>MUST</bcp14> be used.</t></li>

    <li>
      <t>If only some links among the parallel links have advertised the Bandwidth 
  Metric:</t>

  <ul>
    <li>The Bandwidth Metric for such links <bcp14>MUST</bcp14> be ignored.</li>
    <li>Automatic metric calculation <bcp14>MUST</bcp14> be used to derive the link metric.</li>
  </ul>
    </li>
              </ul>
           
            <t>If the calculated metric evaluates to zero, a metric of 1 <bcp14>MUST</bcp14> be used.</t>
            <t> If the calculated metric evaluates to a number greater than 0xFFFFFF, 
   it is set to 0xFFFFFF.</t>
          </section>
          <section anchor="sec_isis_threshold_metric" numbered="true" toc="default">
            <name>Bandwidth Threshold Sub-TLV</name>
            <t>
This section provides FAD constraint advertisement details for the
Bandwidth Thresholds method of metric calculation as
described in <xref target="sec_bw_threshold_method" format="default"/>.
The Flexible Algorithm Definition Bandwidth Threshold (FADBT) sub-TLV is
a sub-TLV of the IS-IS FAD sub-TLV. It has the following format:

</t>
            <figure anchor="isis_fadbt_sub_tlv">
              <name>IS-IS FADBT Sub-TLV</name>
              <artwork name="" type="" align="left" alt=""><![CDATA[
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Type     |    Length     |       Flags   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Bandwidth Threshold 1                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Threshold Metric 1        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Bandwidth Threshold 2                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Threshold Metric 2        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Bandwidth Threshold 3                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                  .....
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Threshold Metric N-1      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Bandwidth Threshold N                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Threshold Metric N        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
</figure>

<t>where:</t>

<dl spacing="normal" newline="true">
  <dt>Type (1 octet):</dt>
  <dd> An 8-bit field assigned by IANA (9).  This value
  uniquely identifies the IS-IS FADBT sub-TLV.</dd>
  <dt>Length (1 octet):</dt>
  <dd>An 8-bit field indicating the total length, in octets, of the subsequent
  fields. For this sub-TLV, the Length is calculated as (1+N*7). Here, N is
  equal to the number of Threshold Metrics specified.  N <bcp14>MUST</bcp14> be
  greater than or equal to 1.</dd>
  <dt>Flags (1 octet):</dt>
  <dd><artwork name="" type="" align="left" alt=""><![CDATA[
                 0 1 2 3 4 5 6 7
                +-+-+-+-+-+-+-+-+
                |G| | |         |
                +-+-+-+-+-+-+-+-+
		]]></artwork>
  <dl spacing="normal" newline="false">
  <dt>G-flag:</dt><dd>When set, Interface Group Mode <bcp14>MUST</bcp14> be
  used to derive total link bandwidth. Unassigned bits <bcp14>MUST</bcp14> be set to zero and <bcp14>MUST</bcp14> be ignored by the receiver.</dd>
  </dl>
  </dd>
</dl>

<t>Following is the staircase bandwidth threshold and associated metric values.</t>
        
<dl spacing="normal" newline="true">
  <dt>Bandwidth Threshold 1 (4 octets):</dt>
  <dd>Minimum Link Bandwidth is encoded in IEEE floating point format (32
  bits)<xref target="IEEE754-2019"/>.  The units are bytes per second.</dd>
  <dt>Threshold Metric 1 (3 octets):</dt>
  <dd>Metric value range (1 - 16,777,215 (0xFFFFFF))</dd>
  <dt>Bandwidth Threshold N (4 octets):</dt>
  <dd>Maximum Link Bandwidth is encoded in IEEE floating point format (32
  bits)<xref target="IEEE754-2019"/>.  The units are bytes per second.</dd>
  <dt>Threshold Metric N (3 octets):</dt>
  <dd>Metric value range (1 - 16,777,215 (0xFFFFFF))</dd>
</dl>

<t>When the G-flag is set, the cumulative bandwidth of the parallel links is
computed as described in <xref target="sec_intf_grp" format="default"/>. If the
G-flag is not set, the advertised Maximum Link Bandwidth is used.</t>

<t>The assignment of the Bandwidth Metric based on computed link bandwidth is described below.</t>
<t>The Bandwidth Metric for a link during the Flex-Algorithm Shortest Path
First (SPF) calculation <bcp14>MUST</bcp14> be assigned according to the
following rules:</t>
   <ol type="1" spacing="normal">
     <li><t>When the computed link bandwidth is less than Bandwidth Threshold 1:</t>
     <t>The Bandwidth Metric <bcp14>MUST</bcp14> be set to the maximum metric value of 4,261,412,864.</t>
     </li>
     <li><t>When the computed link bandwidth is greater than or equal to
     Bandwidth Threshold 1 and less than Bandwidth Threshold 2:</t>
     <t>The Bandwidth Metric <bcp14>MUST</bcp14> be set to Threshold Metric 1.</t>
     </li>
     <li><t>When the computed link bandwidth is greater than or equal to
     Bandwidth Threshold 2 and less than Bandwidth Threshold 3:</t>
     <t>The Bandwidth Metric <bcp14>MUST</bcp14> be set to Threshold Metric 2.</t>
     </li>
     <li><t>In general, for all integer values of X such that 1  X &lt; N:</t>
     <t>When the computed link bandwidth is greater than or equal to Bandwidth
     Threshold X and less than Bandwidth Threshold X+1:</t>
     <t>The Bandwidth Metric <bcp14>MUST</bcp14> be set to Threshold Metric X.</t>
     </li>
     <li><t>When the computed link bandwidth is greater than or equal to Bandwidth Threshold N:</t>
     <t>The Bandwidth Metric <bcp14>MUST</bcp14> be set to Threshold Metric N.</t>
     </li>
   </ol>

   <t>Notes:</t>
   <ul spacing="normal">
     <li>The term "Bandwidth Threshold X" refers to a predefined threshold 
       value corresponding to the index X.</li>
       <li>The term "Threshold Metric X" refers to the metric value 
       associated with Bandwidth Threshold X.</li>
       <li>N represents the total number of bandwidth thresholds 
       defined in the system.</li>
   </ul>

            <t>Implementations <bcp14>MUST</bcp14> ensure that these rules are consistently applied to 
maintain interoperability and optimal path computation 
within the network.</t>
            <t>The IS-IS FADBT sub-TLV <bcp14>MUST NOT</bcp14> appear more than once in an IS-IS FAD
   sub-TLV.  If it appears more than once, the IS-IS FAD sub-TLV <bcp14>MUST</bcp14>
   be ignored by the receiver.</t>
            <t>A FAD <bcp14>MUST NOT</bcp14> contain both the FADBT sub-TLV and the FADRB sub-TLV.  If both
   of these sub-TLVs are advertised in the same FAD for a Flexible
   Algorithm, the FAD <bcp14>MUST</bcp14> be ignored by the receiver.</t>
            <t>If a Generic Metric sub-TLV with Bandwidth metric-type is advertised
   for a link, the Flex-Algorithm calculation <bcp14>MUST</bcp14> use the Bandwidth
   Metric advertised on the link and <bcp14>MUST NOT</bcp14> use the automatically
	    derived metric for that link.</t>
	    
<t>In case of Interface Group Mode, the following rules apply to parallel links:</t>
<ul spacing="normal">
  <li>
    <t>If all the parallel links have been advertised with the Bandwidth Metric:</t>
  <t>The individual link Bandwidth Metric <bcp14>MUST</bcp14> be used.</t></li>
  <li>
    <t>If only some links among the parallel links have advertised the Bandwidth Metric:</t>
    <ul>
  
    <li>The Bandwidth Metric for such links <bcp14>MUST</bcp14> be ignored.</li>
    <li>Automatic metric calculation <bcp14>MUST</bcp14> be used to derive the link metric.</li></ul>
  </li>
    </ul>
          </section>
        </section>
        <section anchor="sec_auto_ospf" numbered="true" toc="default">
          <name>OSPF FAD Constraint Sub-TLVs for Automatic Metric Calculation</name>
          <section anchor="sec_ospf_auto_ref_bw" numbered="true" toc="default">
            <name>Reference Bandwidth Sub-TLV</name>
            <t>
The Flexible Algorithm Definition Reference Bandwidth (FADRB) sub-TLV is
a sub-TLV of the OSPF FAD TLV. It has the following format:


</t>
            <figure anchor="ospf_fadrb_sub_tlv">
              <name>OSPF FADRB Sub-TLV</name>
              <artwork name="" type="" align="left" alt=""><![CDATA[
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Type                     |    Length                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Flags   |     Reserved                                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Reference Bandwidth                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Granularity Bandwidth                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
</figure>

<t>where:</t>

<dl spacing="normal" newline="true">
  <dt>Type (2 octets):</dt>
  <dd>A 16-bit field assigned by IANA (8).  This value
  uniquely identifies the OSPF FADRB sub-TLV.</dd>
  <dt>Length (2 octets):</dt>
  <dd>A 16-bit field indicating the total length, in octets, of the subsequent
  fields. For this sub-TLV, Length is set to 14.</dd>
  <dt>Flags (1 octet):</dt>
  <dd><artwork name="" type="" align="left" alt=""><![CDATA[
                 0 1 2 3 4 5 6 7
                +-+-+-+-+-+-+-+-+
                |G| | |         |
                +-+-+-+-+-+-+-+-+
		]]></artwork>
  <dl spacing="normal" newline="false">
    <dt>G-flag:</dt><dd>When set, Interface Group Mode <bcp14>MUST</bcp14> be
    used to derive total link bandwidth. Unassigned bits <bcp14>MUST</bcp14> be set to zero and <bcp14>MUST</bcp14> be ignored by the receiver.</dd>
  </dl></dd>
  <dt>Reference Bandwidth (4 octets):</dt>
  <dd>Bandwidth encoded in 32 bits in IEEE floating point format
  <xref target="IEEE754-2019"/>.  The units are in bytes per second.</dd>
  <dt>Granularity Bandwidth (4 octets):</dt>
  <dd>Bandwidth encoded in 32 bits in IEEE floating point format
  <xref target="IEEE754-2019"/>.  The units are in bytes per second.</dd>
</dl>

<t>When granularity_bw is less than or equal to Total_link_bandwidth, then:</t>

<dl spacing="normal" newline="true">
  <dt>Metric calculation:</dt><dd>(Reference_bandwidth) /
  (Total_link_bandwidth - (Modulus of(Total_link_bandwidth,
  granularity_bw)))</dd>
</dl>
        
<t>When granularity_bw is greater than Total_link_bandwidth, then:</t>
            
<dl spacing="normal" newline="true">
  <dt>Metric calculation:</dt><dd>Reference_bandwidth/
  Total_link_bandwidth</dd>
</dl>

<t>The division used here is integer division.</t>
	
<t>Modulus of operation is defined as a remainder value when two numbers are
divided.</t>

<t>The Granularity Bandwidth value is used to ensure that the metric does not
change when there is a small change in the link bandwidth.  The OSPF FADRB
sub-TLV <bcp14>MUST NOT</bcp14> appear more than once in an OSPF FAD TLV.  If
it appears more than once, the OSPF FAD TLV <bcp14>MUST</bcp14> be ignored by
the receiver. The value advertised in the Reference Bandwidth field
<bcp14>MUST</bcp14> be non-zero.  If a zero value is advertised in the
Reference Bandwidth field in the OSPF FADRB sub-TLV, the sub-TLV
<bcp14>MUST</bcp14> be ignored.  If a Generic Metric sub-TLV with Bandwidth
metric-type is advertised for a link, the Flex-Algorithm calculation
<bcp14>MUST</bcp14> use the advertised Bandwidth Metric on the link and
<bcp14>MUST NOT</bcp14> use the automatically derived metric for that link.
In the case of Interface Group Mode, the following procedures apply:
            </t>
            <ul spacing="normal">
              <li>
                <t> When all parallel links have advertised the Bandwidth
                Metric: The individual link Bandwidth Metric
                <bcp14>MUST</bcp14> be used for each link.</t>
              </li>
              <li>
                <t> When only a subset of the parallel links have advertised
                the Bandwidth Metric: The Bandwidth Metric advertisements for
                those links <bcp14>MUST</bcp14> be ignored. In this scenario,
                automatic metric calculation <bcp14>MUST</bcp14> be used to
                derive the link metrics for all parallel links.</t>
              </li>
            </ul>

            <t>If the calculated metric evaluates to zero, a metric of 1 <bcp14>MUST</bcp14> be used.</t>
            <t> If the calculated metric evaluates to a number greater than 0xFFFFFFFF, 
     it is set to 0xFFFFFFFF.</t>
          </section>
          <section anchor="sec_ospf_threshold_metric" numbered="true" toc="default">
            <name>Bandwidth Threshold Sub-TLV</name>
            <t>
The Flexible Algorithm Definition Bandwidth Threshold (FADBT) sub-TLV is
a sub-TLV of the OSPF FAD TLV. It has the following format:

</t>
            <figure anchor="ospf_fadbt_sub_tlv">
              <name>OSPF FADBT Sub-TLV</name>
              <artwork name="" type="" align="left" alt=""><![CDATA[
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Type                     |    Length                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Flags   | Reserved                                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Bandwidth Threshold 1                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Threshold Metric 1                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Bandwidth Threshold 2                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Threshold Metric 2                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Bandwidth Threshold 3                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                  .....
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Threshold Metric N-1                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Bandwidth Threshold N                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Threshold Metric N                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
</figure>

<t>where:</t>
<dl spacing="normal" newline="true">
  <dt>Type (2 octets):</dt>
  <dd>A 16-bit field assigned by IANA (9).  This value
  uniquely identifies the OSPF FADBT sub-TLV.</dd>
  <dt>Length (2 octets):</dt>
  <dd>A 16-bit field indicating the total length, in octets, of the subsequent
  fields. For this sub-TLV, Length is set to 2 + N*8 octets. Here, N is equal to
  the number of Threshold Metrics specified. N <bcp14>MUST</bcp14> be greater than
  or equal to 1.</dd>
  <dt>Flags (1 octet):</dt>
  <dd>
    <artwork name="" type="" align="left" alt=""><![CDATA[
                 0 1 2 3 4 5 6 7
                +-+-+-+-+-+-+-+-+
                |G|             |
                +-+-+-+-+-+-+-+-+
		]]></artwork>
    <dl spacing="normal" newline="false">
      <dt>G-flag:</dt><dd>When set, Interface Group Mode <bcp14>MUST</bcp14>
      be used to derive total link bandwidth. Unassigned bits <bcp14>MUST</bcp14> be set to zero and <bcp14>MUST</bcp14> be ignored by the receiver.</dd>
    </dl>
  </dd>
</dl>
	
<t>Following is the staircase bandwidth threshold and associated metric values.</t>

<dl spacing="normal" newline="true">	
  <dt>Bandwidth Threshold 1 (4 octets):</dt>
  <dd>Minimum Link Bandwidth is encoded in IEEE floating point format (32
  bits)<xref target="IEEE754-2019"/>.  The units are bytes per second.</dd>
  <dt>Threshold Metric 1 (4 octets):</dt>
  <dd>Metric value range (1 - 4,294,967,296 (0xFFFFFFFF))</dd>
  <dt>Bandwidth Threshold N (4 octets): </dt>
  <dd>Maximum Link Bandwidth is encoded in IEEE floating point format (32
  bits)<xref target="IEEE754-2019"/>.  The units are bytes per second.</dd>
  <dt>Threshold Metric N (4 octets):</dt>
  <dd>Metric value range (1 - 4,294,967,296 (0xFFFFFFFF))</dd>
</dl>

<t>When the G-flag is set, the cumulative bandwidth of the parallel links is
computed as described in <xref target="sec_intf_grp" format="default"/>.  If
the G-flag is not set, the advertised Maximum Link Bandwidth is used.</t>

<t>The assignment of the Bandwidth Metric based on computed link bandwidth is described below.</t>
<t>During the Flex-Algorithm SPF calculation, the Bandwidth Metric for a link  <bcp14>MUST</bcp14> be assigned according to the following rules:</t>

<ol type="1" spacing="normal">
  <li><t>When the computed link bandwidth is less than Bandwidth Threshold 1:</t>
  <t>The Bandwidth Metric <bcp14>MUST</bcp14> be set to the maximum metric
  value of 4,294,967,296.</t></li>
  <li><t>When the computed link bandwidth is greater than or equal to
  Bandwidth Threshold 1 and less than Bandwidth Threshold 2:</t>
  <t>The Bandwidth Metric <bcp14>MUST</bcp14> be set to Threshold Metric 1.</t>
  </li>
  <li><t>When the computed link bandwidth is greater than or equal to
  Bandwidth Threshold 2 and less than Bandwidth Threshold 3:</t>
  <t>The Bandwidth Metric <bcp14>MUST</bcp14> be set to Threshold Metric 2.</t></li>
  <li><t>In general, for all integer values of X where 1 X &lt; N:</t>
  <t>When the computed link bandwidth is greater than or equal to Bandwidth
  Threshold X and less than Bandwidth Threshold X+1:</t>
  <t>The Bandwidth Metric <bcp14>MUST</bcp14> be set to Threshold Metric X.</t></li>
  <li><t>When the computed link bandwidth is greater than or equal to
  Bandwidth Threshold N:</t>
  <t>The Bandwidth Metric <bcp14>MUST</bcp14> be set to Threshold Metric N.</t></li>
</ol>

<t>Notes:</t>
<ul spacing="normal">
  <li>
    <t>Bandwidth Threshold X refers to the predefined bandwidth threshold
    corresponding to index X.</t>
  </li>
  <li>
    <t>Threshold Metric X is the metric value associated with Bandwidth
    Threshold X.</t>
  </li>
  <li>
    <t>N represents the total number of bandwidth thresholds defined in the
    system.</t>
  </li>
</ul>

            <t>Implementations <bcp14>MUST</bcp14> consistently apply these rules to ensure accurate
 path computations and maintain interoperability within the network.</t>
            <t>The OSPF FADBT sub-TLV <bcp14>MUST NOT</bcp14> appear more than once in an OSPF FAD
   sub-TLV.  If it appears more than once, the OSPF FAD sub-TLV <bcp14>MUST</bcp14> 
   be ignored by the receiver.</t>
            <t>A FAD <bcp14>MUST NOT</bcp14> contain both the FADBT sub-TLV and the FADRB sub-TLV.  If both
   these sub-TLVs are advertised in the same FAD for a Flexible
   Algorithm, the FAD <bcp14>MUST</bcp14> be ignored by the receiver.</t>
            <t>If a Generic Metric sub-TLV with Bandwidth metric-type is advertised
   for a link, the Flex-Algorithm calculation <bcp14>MUST</bcp14> use the Bandwidth
   Metric advertised on the link and <bcp14>MUST NOT</bcp14> use the automatically
   derived metric for that link.</t>
            <t> Metric Assignment in Interface Group Mode:</t>
            <t>When a link does not have a configured Bandwidth Metric, 
   the automatically derived metric <bcp14>MUST</bcp14> be used for that link.</t>
            <t>In case of Interface Group Mode, the following rules apply to parallel links:</t>
            <ul spacing="normal">
              <li>
                <t>If all parallel links have advertised the Bandwidth Metric:</t>
                <t>The individual link Bandwidth Metric <bcp14>MUST</bcp14> be used for each link during path computation.</t></li>
            
	      <li>
                <t>If only some of the parallel links have advertised the Bandwidth Metric:</t>
		<ul>
                  <li>The Bandwidth Metric advertisements for those links <bcp14>MUST</bcp14> be ignored.</li>
                  <li>Automatic metric calculation <bcp14>MUST</bcp14> be used to derive the link metrics for all parallel links.</li>
                </ul>
              </li>
              </ul>
	     
            <t>This approach ensures consistent metric calculation and avoids discrepancies 
caused by partial Bandwidth Metric advertisements among parallel links.</t>
          </section>
        </section>
      </section>
    </section>
    <section anchor="sec-metric" numbered="true" toc="default">
      <name>Bandwidth Metric Considerations</name>
      <t>
    This section specifies the rules of deriving the Bandwidth Metric if
    and only if the winning FAD for the Flex-Algorithm specifies the
    metric-type as "Bandwidth Metric".
      </t>
      <ol type="1" spacing="normal">
        <li>If the Generic Metric sub-TLV with Bandwidth metric-type is
        advertised for the link as described in <xref target="sec_bw_metric"
        format="default"/>, it <bcp14>MUST</bcp14> be used during the
        Flex-Algorithm calculation.</li>
        <li>If the Generic Metric sub-TLV with Bandwidth metric-type is not
        advertised for the link and the winning FAD for the Flex-Algorithm
        does not specify the automatic Bandwidth metric calculation (as
        defined in <xref target="sec_auto_metric" format="default"/>), the
        link is treated as if the Bandwidth Metric is not available for the
        link.</li>
        <li>If the Generic Metric sub-TLV with Bandwidth metric-type is not
        advertised for the link and the winning FAD (<xref section="5.3"
        target="RFC9350" format="default"/>) for the Flex-Algorithm specifies
        the automatic Bandwidth metric calculation (as defined in <xref
        target="sec_auto_metric" format="default"/>), the Bandwidth Metric
        <bcp14>MUST</bcp14> be automatically calculated per the
        procedures defined in <xref target="sec_auto_metric"
        format="default"/>.  If the Link Bandwidth is not advertised for a
        link, the link <bcp14>MUST</bcp14> be pruned for the Flex-Algorithm
        calculations.</li>
        <li>In IS-IS, for Flex-Algorithm purposes, the Link Bandwidth is
        advertised as a sub-sub-TLV 9 of the Flex-Algorithm-specific ASLA
        sub-TLV.  It is also possible to advertise the link bandwidth or
        Flex-Algorithm in sub-TLV 9 of TLVs 22/222/23/223/141 <xref target="RFC5305"/>
        together with the L-flag set in the Flex-Algorithm-specific ASLA
        advertisement. In the absence of both of these advertisements, the
        bandwidth of the link is not available for Flex-Algorithm
        purposes.</li>
      </ol>

    </section>
    <section anchor="sec-calc" numbered="true" toc="default">
      <name>Calculation of Flex-Algorithm Paths</name>
      <t>The following two new additional rules are added to the existing rules in the
      Flex-Algorithm calculations specified in <xref target="RFC9350"
      sectionFormat="of" section="13"/>:</t>

<blockquote>
      <ol spacing="normal" start="6">
        <li>Check if any exclude FAEMB rule is part of the Flex-Algorithm
        definition.  If such exclude rule exists and the link has Maximum Link
        Bandwidth advertised, check if the link bandwidth satisfies the FAEMB
        rule. If the link does not satisfy the FAEMB rule, the link
        <bcp14>MUST</bcp14> be pruned from the Flex-Algorithm computation.</li>
        <li>Check if any exclude FAEMD rule is part of the Flex-Algorithm
        definition.  If such exclude rule exists and the link has Min
        Unidirectional link delay advertised, check if the link delay
        satisfies the FAEMD rule. If the link does not satisfy the FAEMD rule,
        the link <bcp14>MUST</bcp14> be pruned from the Flex-Algorithm
        computation.</li>
      </ol>
</blockquote>

    </section>
    <section anchor="backward_compatibility" numbered="true" toc="default">
      <name>Backward Compatibility</name>
      <t> This extension brings no new backward-compatibility issues.
		 This document defines new FAD constraints in Sections 
		 <xref target="sec_fad_con" format="counter"/>, <xref target="sec_auto_isis" format="counter"/>, and
		 <xref target="sec_auto_ospf" format="counter"/>. As described in  <xref target="RFC9350" format="default"/>,
		 any node that does not understand sub-TLVs in a FAD TLV stops participation in the 
		 corresponding Flex-Algorithm. The new extensions can be deployed among the nodes that are
		 upgraded to understand the new extensions without affecting the nodes that are not upgraded.
		 This document also defines a new metric advertisement as described in 
		 <xref target="sec_generic_metric" format="default"/>. As per <xref target="RFC9350" sectionFormat="of" section="13"/>,
		 when the links do not advertise the metric-type specified by the selected FAD, 
		 the link is pruned from Flex-Algorithm calculations. The new metric-types and 
         Flex-Algorithms using the new metric-types can be deployed in the network without affecting	
         existing deployment.	 </t>
    </section>
    <section anchor="sec-con" numbered="true" toc="default">
      <name>Security Considerations</name>
      <t>This document inherits security considerations from <xref target="RFC9350" format="default"/>.</t>
    </section>
    <section anchor="sec-ops" numbered="true" toc="default">
      <name>Operational Considerations</name>
      <t>Operational considerations defined in <xref target="RFC9350" format="default"/> generally apply to
	the extensions defined in this document as well. This document defines a metric-type
	range for user-defined metrics. When user-defined metrics are used in an inter-area or
	inter-level network, all the domains should assign same meaning to the particular
	metric-type. The YANG data models for Flex-Algorithm extensions are defined in 
	documents <xref target="I-D.ietf-lsr-ospf-yang-augmentation-v1" format="default"/> and 
	<xref target="I-D.ietf-lsr-isis-yang-augmentation-v1" format="default"/>.</t>
      <t>Before the router goes into maintenance activity, the traffic needs to be diverted away
	   from the router. This is achieved by setting the overload bit or setting link metrics on the
	   router to a high value. In case of Generic Metric, the link metrics can be set to a Maximum
	   usable metric for OSPF and IS-IS. The traffic will be diverted away from the router to a shorter
	   available path. If there are no alternate paths available, traffic will stay on the router as
	   the links are not removed from the Flex-Algorithm calculation when they are set to a maximum metric per 
	   <xref target="RFC9350" format="default"/>.
      </t>
    </section>
    <section anchor="IANA" numbered="true" toc="default">
      <name>IANA Considerations</name>
      <section anchor="igp_metric_type" numbered="true" toc="default">
        <name>IGP Metric-Type Registry</name>
        <t>The "IGP Metric-Type" registry has been updated to include another column
        specifying whether the particular metric-type is allowed in the
        Generic Metric sub-TLV.  The range 128-255 is redefined
        by this document as a user-defined range, and this range does not require
        Standards Action <xref target="RFC8126"/>. </t>

<table anchor="iana_metric_type">
  <name>IGP Metric-Type Registry</name>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
      <th>Reference</th>
      <th>Allowed in Generic-Metric</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>IGP Metric</td>
      <td><xref target="RFC9350" sectionFormat="of" section="5.1"/></td>
      <td>No</td>
    </tr>
    <tr>
      <td>1</td>
      <td>Min Unidirectional Link Delay as defined in <xref target="RFC8570"
      sectionFormat="comma" section="4.2"/> and <xref target="RFC7471"
      sectionFormat="comma" section="4.2"/></td>
      <td><xref target="RFC9350" sectionFormat="of" section="5.1"/></td>
      <td>No</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Traffic Engineering Default Metric as defined in <xref
      target="RFC5305" sectionFormat="comma" section="3.7"/> and  Traffic Engineering Metric as defined in <xref
      target="RFC3630" sectionFormat="comma" section="2.5.5"/></td>
      <td><xref target="RFC9350" sectionFormat="of" section="5.1"/></td>
      <td>No</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Bandwidth Metric</td>
      <td>RFC 9843</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td>128-255</td>
      <td>Reserved for User-Defined Metric</td>
      <td>RFC 9843</td>
      <td>Yes</td>
    </tr>
  </tbody>
</table>
      </section>
      <section anchor="isis_fad" numbered="true" toc="default">
        <name>IS-IS Sub-Sub-TLVs for Flexible Algorithm Definition Sub-TLV</name>
        <t>The "IS-IS Sub-Sub-TLVs for Flexible Algorithm Definition Sub-TLV" registry is part
	of the "IS-IS TLV Codepoints" registry group.</t>

<dl spacing="compact" newline="false">
  <dt>Type:</dt><dd>6</dd>
  <dt>Description:</dt><dd>IS-IS Exclude Minimum Bandwidth</dd>
  <dt>Reference:</dt><dd>RFC 9843, <xref target="sec_isis_bw_exclusion" format="default"/></dd>
</dl>
<dl spacing="compact" newline="false">
  <dt>Type:</dt><dd>7</dd>
  <dt>Description:</dt><dd>IS-IS Exclude Maximum Delay</dd>
  <dt>Reference:</dt><dd>RFC 9843, <xref target="sec_isis_delay_exclusion" format="default"/></dd>
</dl>
<dl spacing="compact" newline="false">
  <dt>Type:</dt><dd>8</dd>
  <dt>Description:</dt><dd>IS-IS Reference Bandwidth</dd>
  <dt>Reference:</dt><dd>RFC 9843, <xref target="sec_isis_auto_ref_bw" format="default"/></dd>
</dl>
<dl spacing="compact" newline="false">
  <dt>Type:</dt><dd>9</dd>
  <dt>Description:</dt><dd>IS-IS Bandwidth Threshold</dd>
  <dt>Reference:</dt><dd>RFC 9843, <xref target="sec_isis_threshold_metric" format="default"/></dd>
</dl>
      </section>
      <section anchor="ospf_fad" numbered="true" toc="default">
        <name>OSPF Sub-TLVs for Flexible Algorithm Definition Sub-TLV</name>
        <t>The "OSPF Flexible Algorithm Definition TLV Sub-TLVs"
	  registry is part of the "Open Shortest Path First (OSPF) Parameters" 
	  registry group.</t>
<dl spacing="compact" newline="false">
  <dt>Type:</dt><dd>6</dd>
  <dt>Description:</dt><dd>OSPF Exclude Minimum Bandwidth</dd>
  <dt>Reference:</dt><dd>RFC 9843, <xref target="sec_ospf_bw_exclusion" format="default"/></dd>
</dl>
<dl spacing="compact" newline="false">
  <dt>Type:</dt><dd>7</dd>
  <dt>Description:</dt><dd>OSPF Exclude Maximum Delay</dd>
  <dt>Reference:</dt><dd>RFC 9843, <xref target="sec_ospf_delay_exclusion" format="default"/></dd>
</dl>
<dl spacing="compact" newline="false">
  <dt>Type:</dt><dd>8</dd>
  <dt>Description:</dt><dd>OSPF Reference Bandwidth</dd>
  <dt>Reference:</dt><dd>RFC 9843, <xref target="sec_ospf_auto_ref_bw" format="default"/></dd>
</dl>
<dl spacing="compact" newline="false">
  <dt>Type:</dt><dd>9</dd>
  <dt>Description:</dt><dd>OSPF Bandwidth Threshold</dd>
  <dt>Reference:</dt><dd>RFC 9843, <xref target="sec_ospf_threshold_metric" format="default"/></dd>
</dl>
      </section>
      <section anchor="isis_gen_metric" numbered="true" toc="default">
        <name>IS-IS Sub-TLVs for TLVs Advertising Neighbor Information</name>
        <t>The "IS-IS Sub-TLVs for TLVs Advertising Neighbor Information" registry
  is part of the "IS-IS TLV Codepoints" registry group.</t>

<dl spacing="compact" newline="false">
  <dt>Type:</dt><dd>17</dd>
  <dt>Description:</dt><dd>Generic Metric</dd>
  <dt>TLVs set to "Y":</dt><dd>22, 23, 25, 141, 222, and 223</dd>
  <dt>Reference:</dt><dd>RFC 9843, <xref target="sec_isis_gen_metric" format="default"/></dd>
</dl>

      </section>
      <section anchor="isis_gen_metric_te_app" numbered="true" toc="default">
        <name>Sub-Sub-TLV Codepoints for Application-Specific Link Attributes</name>
        <t>The "IS-IS Sub-Sub-TLV Codepoints for Application-Specific Link Attributes" registry
  is part of the "IS-IS TLV Codepoints" registry group.</t>
<dl spacing="compact" newline="false">
  <dt>Type:</dt><dd>17</dd>
  <dt>Description:</dt><dd>Generic Metric</dd>
  <dt>Reference:</dt><dd>RFC 9843, <xref target="sec_isis_gen_metric" format="default"/></dd>
</dl>
      </section>
      <section anchor="ospf_gen_metric" numbered="true" toc="default">
        <name>OSPFv2 Extended Link TLV Sub-TLVs</name>
        <t>The "OSPFv2 Extended Link TLV Sub-TLVs" registry
  is part of the "Open Shortest Path First v2 (OSPFv2) Parameters" registry group.</t>
<dl spacing="compact" newline="false">
  <dt>Value:</dt><dd>25</dd>
  <dt>Description:</dt><dd>Generic Metric</dd>
  <dt>L2BM:</dt><dd>Y</dd>
  <dt>Reference:</dt><dd>RFC 9843, <xref target="sec_ospf_gen_metric" format="default"/></dd>
</dl>
      </section>
      <section anchor="ospf_gen_metric_te_lsa" numbered="true" toc="default">
        <name>Types for Sub-TLVs of TE Link TLV (Value 2)</name>
        <t>The "Types for sub-TLVs of TE Link TLV (Value 2)" registry
  is part of the "Open Shortest Path First (OSPF) Traffic Engineering TLVs" registry group.</t>
<dl spacing="compact" newline="false">
  <dt>Value:</dt><dd>36</dd>
  <dt>Description:</dt><dd>Generic Metric</dd>
  <dt>Reference:</dt><dd>RFC 9843, <xref target="sec_ospf_gen_metric" format="default"/></dd>
</dl>
      </section>
      <section anchor="ospfv3_gen_metric_te_lsa" numbered="true" toc="default">
        <name>OSPFv3 Extended-LSA Sub-TLVs</name>
        <t> The "OSPFv3 Extended-LSA Sub-TLVs" registry
  is part of the "Open Shortest Path First v3 (OSPFv3) Parameters" registry group.</t>
<dl spacing="compact" newline="false">
  <dt>Value:</dt><dd>34</dd>
  <dt>Description:</dt><dd>Generic Metric</dd>
  <dt>L2BM:</dt><dd>Y</dd>
  <dt>Reference:</dt><dd>RFC 9843, <xref target="sec_ospf_gen_metric" format="default"/></dd>
</dl>
      </section>
    </section>
 
  </middle>
  <back>

    <displayreference target="I-D.bashandy-rtgwg-segment-routing-uloop" to="SR-LOOP-AVOID"/>
    <displayreference target="I-D.ietf-lsr-isis-yang-augmentation-v1" to="ISIS-AUGMENTATION"/>
    <displayreference target="I-D.ietf-lsr-ospf-yang-augmentation-v1" to="OSPF-AUGMENTATION"/>
    <references>
      <name>References</name>
      <references>
        <name>Normative References</name>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.5305.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.3630.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.7684.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9479.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9492.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8362.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9350.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9356.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.5392.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.5329.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8668.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.1195.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.2328.xml"/>
	<xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8126.xml"/>

        <reference anchor="IEEE754-2019" target="">
          <front>
            <title>IEEE Standard for Floating-Point Arithmetic</title>
            <author>
              <organization>IEEE</organization>
            </author>
            <date day="22" month="July" year="2019"/>
          </front>
          <seriesInfo name="IEEE Std" value="754-2019"/>
          <seriesInfo name="DOI" value="10.1109/ieeestd.2019.8766229"/>
        </reference>
      </references>
      <references>
        <name>Informative References</name>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8570.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.7471.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.5311.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9346.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.5120.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.5715.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.4655.xml"/>

<!-- [I-D.ietf-lsr-ospf-yang-augmentation-v1]
draft-ietf-lsr-ospf-yang-augmentation-v1-16
IESG State: I-D Exists as of 09/08/25.
-->
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-lsr-ospf-yang-augmentation-v1.xml"/>

<!-- [I-D.ietf-lsr-isis-yang-augmentation-v1]
draft-ietf-lsr-isis-yang-augmentation-v1-09
IESG State: I-D Exists as of 09/08/25.
-->
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-lsr-isis-yang-augmentation-v1.xml"/>

<!-- [I-D.bashandy-rtgwg-segment-routing-uloop]
draft-bashandy-rtgwg-segment-routing-uloop-17
IESG State: Expired as of 09/08/25.
-->
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml3/reference.I-D.bashandy-rtgwg-segment-routing-uloop.xml"/>
      </references>
    </references>

    <section anchor="rules" numbered="true" toc="default">
	<name>Updated List of Rules for Pruning Links in Flex-Algorithm Topology</name>
	
        <t>This section lists the entire set of rules to prune links from
        Flex-Algorithm topology during Flexible Algorithm calculation.  It
        includes the original rules defined in <xref target="RFC9350"
        sectionFormat="of" section="13"/> as well as the new additions (rules 6 and 7) described in
        this document.</t>

        <t>For all links in the topology:</t>
        <ol type="1" spacing="normal">
          <li>Check if any exclude Administrative Group rule is part of the
          Flex-Algorithm Definition.  If such exclude rule exists, check if
          any color that is part of the exclude rule is also set on the link.
          If such a color is set, the link <bcp14>MUST</bcp14> be pruned from
          the computation.</li>
          <li>Check if any exclude SRLG rule is part of the Flex-Algorithm
          Definition.  If such exclude rule exists, check if the link is part
          of any SRLG that is also part of the SRLG exclude rule. If the link
          is part of such SRLG, the link <bcp14>MUST</bcp14> be pruned from
          the computation.</li>
          <li>Check if any include-any Administrative Group rule is part of
          the Flex-Algorithm Definition. If such include-any rule exists,
          check if any color that is part of the include-any rule is also set
          on the link.  If no such color is set, the link <bcp14>MUST</bcp14>
          be pruned from the computation.</li>
          <li>Check if any include-all Administrative Group rule is part of
          the Flex-Algorithm Definition. If such include-all rule exists,
          check if all colors that are part of the include-all rule are also
          set on the link.  If all such colors are not set on the link, the
          link <bcp14>MUST</bcp14> be pruned from the computation.</li>
          <li>If the Flex-Algorithm Definition uses something other than the
          IGP metric (<xref target="RFC9350" sectionFormat="of" section="5"/>),
          and such metric is not advertised for the particular link in a
          topology for which the computation is done, such link
          <bcp14>MUST</bcp14> be pruned from the computation. A metric of
          value 0 <bcp14>MUST NOT</bcp14> be assumed in such a case.</li>
          <li>Check if any exclude FAEMB rule is part of the Flex-Algorithm
          Definition.  If such exclude rule exists and the link has Maximum
          Link Bandwidth advertised, check if the link bandwidth satisfies the
          FAEMB rule. If the link does not satisfy the FAEMB rule, the link
          <bcp14>MUST</bcp14> be pruned from the Flex-Algorithm
          computation.</li>
          <li>Check if any exclude FAEMD rule is part of the Flex-Algorithm
          Definition.  If such exclude rule exists and the link has Min
          Unidirectional Link Delay advertised, check if the link delay
          satisfies the FAEMD rule. If the link does not satisfy the FAEMD
          rule, the link <bcp14>MUST</bcp14> be pruned from the Flex-Algorithm
          computation.</li>
        </ol>
      </section>
       <section anchor="ack" numbered="false" toc="default">
      <name>Acknowledgements</name>
      <t>Many thanks to <contact fullname="Chris Bowers"/>, <contact
      fullname="Krzysztof Szarcowitz"/>, <contact fullname="Julian Lucek"/>,
      <contact fullname="Ram Santhanakrishnan"/>, <contact fullname="Ketan
      Talaulikar"/>, and <contact fullname="Acee Lindem"/> for discussions and
      input.</t>
    </section>
        <section numbered="false" toc="default">
      <name>Contributors</name>

    <contact fullname="Salih K.A.">
      <organization>Juniper Networks</organization>
      <address>
        <email>salih@juniper.net</email>
      </address>
    </contact>
	</section>



	
  </back>
</rfc>
