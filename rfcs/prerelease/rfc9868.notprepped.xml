<?xml version='1.0' encoding='utf-8'?>

<!DOCTYPE rfc [
  <!ENTITY nbsp    "&#160;">
  <!ENTITY zwsp   "&#8203;">
  <!ENTITY nbhy   "&#8209;">
  <!ENTITY wj     "&#8288;">
]>

<rfc xmlns:xi="http://www.w3.org/2001/XInclude" ipr="trust200902" docName="draft-ietf-tsvwg-udp-options-45" category="std" consensus="true" submissionType="IETF" xml:lang="en" number="9868" updates="768" tocInclude="true" sortRefs="true" symRefs="true" version="3">
  <!-- xml2rfc v2v3 conversion 3.30.0 -->
  <link href="https://datatracker.ietf.org/doc/draft-ietf-tsvwg-udp-options-45" rel="prev"/>
  <front>
    <title abbrev="Transport Options for UDP">Transport Options for UDP</title>
    <seriesInfo name="RFC" value="9868"/>
    <author initials="J." surname="Touch" fullname="Joe Touch">
      <organization>Independent Consultant</organization>
      <address>
        <postal>
          <city>Manhattan Beach</city>
          <region>CA</region>
          <code>90266</code>
          <country>United States of America</country>
        </postal>
        <phone>+1 (310) 560-0334</phone>
        <email>touch@strayalpha.com</email>
      </address>
    </author>
    <author initials="C." surname="Heard" fullname="C. M. (Mike) Heard" role="editor">
      <organization>Unaffiliated</organization>
      <address>
        <postal>
          <street>PO Box 2667</street>
          <city>Redwood City</city>
          <region>CA</region>
          <code>94064-2667</code>
          <country>United States of America</country>
        </postal>
        <phone>+1 (408) 499-7257</phone>
        <email>heard@pobox.com</email>
      </address>
    </author>
    <date year="2025" month="October"/>
    <area>WIT</area>
    <workgroup>TSVWG</workgroup>
    <keyword>example</keyword>
    <abstract>
      <?line 224?>

<t>Transport protocols are extended through the use of transport header
options. This document updates RFC 768 (UDP) by indicating the
location, syntax, and semantics for UDP transport layer options
within the surplus area after the end of the UDP user data but
before the end of the IP datagram.</t>
    </abstract>
  </front>
  <middle>
    <?line 233?>

<section anchor="introduction">
      <name>Introduction</name>
      <t>Transport protocols use options as a way to extend their
capabilities. TCP <xref target="RFC9293"/>, the Stream Control Transmission Protocol (SCTP) <xref target="RFC9260"/>, and the Datagram Congestion Control Protocol (DCCP) <xref target="RFC4340"/>
include space for these options, but UDP <xref target="RFC0768"/> currently does not.
This document updates RFC 768 with an extension to UDP that provides
space for transport options including their generic syntax and
semantics for their use in UDP's stateless, unreliable message
protocol. The details of the impact on RFC 768 are provided in
<xref target="sec-updates-768"/>. This extension does not apply to UDP-Lite, as discussed
further in <xref target="sec-options-vs-lite"/>.</t>
    </section>
    <section anchor="conventions-used-in-this-document">
      <name>Conventions Used in This Document</name>
      <t>
    The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>",
    "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>", "<bcp14>SHALL
    NOT</bcp14>", "<bcp14>SHOULD</bcp14>", "<bcp14>SHOULD NOT</bcp14>",
    "<bcp14>RECOMMENDED</bcp14>", "<bcp14>NOT RECOMMENDED</bcp14>",
    "<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document are
    to be interpreted as described in BCP&nbsp;14 <xref target="RFC2119"/>
    <xref target="RFC8174"/> when, and only when, they appear in all capitals,
    as shown here. 
</t>
      <?line -18?>
<t>In this document, the characters ">>" at the beginning of a paragraph 
indicate a statement using the key words listed above. This
convention aids reviewers in quickly identifying or finding the
portions of this RFC covered by these key words.</t>
    </section>
    <section anchor="terminology">
      <name>Terminology</name>
      <t>The following terminology is used in this document:</t>
      <dl newline="false" spacing="normal">
	<dt>IP datagram <xref target="RFC0791"/> <xref target="RFC8200"/>:</dt>
	<dd>
	  <t>An IP packet, composed of the IP
header (including any IPv4 options) and an IP payload area
(including any IPv6 extension headers or other shim headers).</t>
</dd>
        <dt>Must-support options:</dt>
        <dd>
          <t>UDP Options that all implementations are
required to support. Their use in individual UDP packets is
optional.</t>
        </dd>
        <dt>SAFE Options:</dt>
        <dd>
          <t>UDP Options that are designed to be safe to ignore
for a receiver that does not understand them. Such options do not
alter the UDP user data or signal a change in what its contents
represent.</t>
        </dd>
        <dt>Socket pair:</dt>
        <dd>
          <t>A pair of sockets defining a UDP exchange, defined
by a remote socket and a local socket, each composed of an IP
address and UDP port number (most widely known from TCP <xref target="RFC0793"/>, which has been obsoleted by <xref target="RFC9293"/>).</t>
        </dd>
        <dt>Surplus area:</dt>
        <dd>
          <t>The area of an IP payload that follows a UDP
packet; this area is used for UDP Options in this document.</t>
        </dd>
        <dt>UDP packet:</dt>
        <dd>
          <t>The more contemporary term used herein to refer to a
user datagram <xref target="RFC0768"/>.</t>
        </dd>
        <dt>UDP fragment:</dt>
        <dd>
          <t>One or more components of a UDP packet and its UDP
Options that enable transmission over multiple IP payloads,
larger than permitted by the maximum size of a single IP packet;
note that each UDP fragment is itself transmitted as a UDP packet
with its own options.</t>
        </dd>
        <dt>(UDP) User data:</dt>
        <dd>
          <t>The user data field of a UDP packet <xref target="RFC0768"/>.</t>
        </dd>
        <dt>UDP Length:</dt>
        <dd>
          <t>The length field of a UDP header <xref target="RFC0768"/>.</t>
        </dd>
        <dt>UNSAFE Options:</dt>
        <dd>
          <t>UDP Options that are not designed to be safely ignored
by a receiver that does not understand them. Such options
could alter the UDP user data or signal a change in what its
contents represent, but there are restrictions on how they can be
transmitted; these restrictions are noted in Sections <xref target="sec-udp-opt" format="counter"/> and <xref target="sec-unsafe-opt" format="counter"/>.</t>
        </dd>
        <dt>User:</dt>
        <dd>
          <t>The upper layer application, protocol, or service that
produces and consumes content that UDP transfers.</t>
        </dd>
        <dt>User datagram:</dt>
        <dd>
          <t>A UDP packet, composed of a UDP header and UDP
payload; as discussed herein, the UDP payload need not extend to the
end of the IP datagram. In this document, the original intent
that a UDP datagram corresponds to the user portion of a single
IP datagram is redefined, where a UDP datagram can span more than
one IP datagram through UDP fragmentation.</t>
        </dd>
      </dl>
    </section>
    <section anchor="background">
      <name>Background</name>
      <t>Many protocols include a default, invariant header and an area for
   header options that varies from packet to packet. These options
   enable the protocol to be extended for use in particular
   environments or in ways unforeseen by the original designers.
   Examples include TCP's Maximum Segment Size (MSS), Window Scale,
      Timestamp, and Authentication Options <xref target="RFC9293"/> <xref target="RFC5925"/> <xref target="RFC7323"/>.</t>
      <t>Header options are used both in stateful (connection-oriented, e.g.,
   TCP <xref target="RFC9293"/>, SCTP <xref target="RFC9260"/>, and DCCP <xref target="RFC4340"/>) and stateless
   (connectionless, e.g., IPv4 <xref target="RFC0791"/> and IPv6 <xref target="RFC8200"/>) protocols. In
   stateful protocols, they can help extend the way in which state is
   managed. In stateless protocols, their effect is often limited to
   individual packets, but they can have an aggregate effect on a
   sequence of packets as well.</t>
      <t>UDP is one of the most popular protocols that lacks space for header
   options <xref target="RFC0768"/>. The UDP header was intended to be a minimal
   addition to IP, providing only port numbers and a checksum for error
   detection. This document extends UDP to provide a trailer area for
      such options, located after the UDP user data.</t>
      <t>UDP Options are possible because UDP includes its own length field,
   separate from that of the IP header. Other transport protocols infer
   transport payload length from the IP datagram length (TCP, DCCP, and
   SCTP). Internet historians have suggested a number of possible
   reasons why the design of UDP includes this field, e.g., to support
   multiple UDP packets within the same IP datagram or to indicate the
   length of the UDP user data as distinct from zero padding required
   for systems that cannot write an arbitrary number of bytes of data. These
   suggestions are not consistent with earlier versions of UDP or with the
   concurrent design of multi-segment, multiplexing protocols; however,
   the real reason remains unknown. Regardless, this field presents
   an opportunity to differentiate the UDP user data from the implied
   transport payload length, which this document leverages to support a
   trailer options field.</t>
      <t>There are other ways to include additional header fields or options
   in protocols that otherwise are not extensible. In particular, in-
   band encoding can be used to differentiate transport payload from
   additional fields, such as was proposed in <xref target="I-D.hildebrand-spud-prototype"/>. This approach can
   cause complications for interactions with legacy devices and is
   thus not considered further in this document.</t>
      <t>IPv6 Teredo extensions <xref target="RFC4380"/> <xref target="RFC6081"/> use a similar
   inconsistency between UDP and IPv6 packet lengths to support
   trailers, but in this case, the values differ between the UDP header
   and an IPv6 length contained as the payload of the UDP user data.
   This allows IPv6 trailers in the UDP user data but has no relation
   to the surplus area discussed in this document. As a consequence,
   Teredo extensions are compatible with UDP Options.</t>
    </section>
    <section anchor="udp-option-intended-uses">
      <name>UDP Option Intended Uses</name>
      <t>UDP Options can be used to provide a soft control plane to UDP. They
   enable capabilities available in other transport protocols, such as
   fragmentation and reassembly, that enable UDP frames larger than the
   IP MTU to traverse devices that rely on transport ports, e.g., Network Address Translations (NATs),
   without additional mechanisms or state. They add features that
   could, in the future, protect transport integrity and validate
   source identity (authentication), as well as those that could
   encrypt the user payload while still protecting the UDP transport
   header -- unlike Datagram Transport Layer Security (DTLS) <xref target="RFC9147"/>.
   They also enable Packetization Layer Path MTU Discovery (PLPMTUD)
   over UDP, known as Datagram Packetization Layer Path Maximum
   Transmission Unit Discovery (DPLPMTUD) <xref target="RFC9869"/>, providing a means for
   probe packet validation without affecting the user data plane, as
   well as providing explicit indication of the receiver transport
   reassembly size.</t>
      <t>UDP originally assumed that such capabilities would be provided by
   the user or by a layer above UDP <xref target="RFC0768"/>. However, enough protocols
   have evolved to use UDP directly, so such an intermediate layer
   would be difficult to deploy for legacy applications. UDP Options
   leverage the opportunity presented by the surplus area to enable
   these extensions within the UDP transport layer itself. Among the
   use cases where this approach could be of benefit are request-
   response protocols such as DNS over UDP <xref target="I-D.heard-dnsop-udp-opt-large-dns-responses"/>.</t>
    </section>
    <section anchor="udp-option-design-principles">
      <name>UDP Option Design Principles</name>
      <t>UDP Options have been designed based on the following core
   principles. Each is an observation about preexisting behavior of UDP <xref target="RFC0768"/>
   in the absence of these extensions that this document does not
   intend to change or a lesson learned from other protocol designs.</t>
      <ol spacing="normal" type="1"><li>
          <t>UDP is stateless; UDP Options do not change that fact.  </t>
          <t>
The state required or maintained by the endpoints is intended to be
managed either by the application or a layer/library on behalf of
the application. Reassembly of fragments is the only limited
exception where this document introduces a notion of state to
UDP.</t>
        </li>
        <li>
          <t>UDP is unidirectional; UDP Options do not change that fact.  </t>
          <t>
Responses to options are initiated by the application or a
layer/library on behalf of the application. A mechanism that
requires bidirectionality needs to be defined in a separate
document.</t>
        </li>
        <li>
          <t>UDP Options have no length limit separate from that of the UDP
packet itself.  </t>
          <t>
Past experience with other protocols confirms that static length
limits will always need to be exceeded, e.g., as has been an
issue with TCP options and IPv4 addresses. Each implementation
can limit how long/many options there are, but a specification is
more robust when it does not introduce such a limit.</t>
        </li>
        <li>
          <t>UDP Options are not intended to replace or replicate other
protocols.  </t>
          <t>
This includes NTP, ICMP (notably echo), etc. UDP Options are
intended to introduce features useful for applications, not to
either replace these other protocols nor instrument UDP to
replace the need for network testing devices.</t>
        </li>
        <li>
          <t>UDP Options are a framework, not a protocol.  </t>
          <t>
Options can be defined in this initial document even when the
details are not sufficient to specify a complete protocol. Uses
of such options could then be described or supplemented in other
documents. Examples herein include REQ/RES and TIME; in both
cases, the option format is defined, but the protocol that uses
these is specified elsewhere (REQ/RES for DPLPMTUD <xref target="RFC9869"/>) or
left undefined (TIME).</t>
        </li>
        <li>
          <t>The UDP Option mechanism and UDP Options themselves are intended
	  to default to the same behavior experienced by a legacy receiver.  </t>
          <t>
By default, even when option checksums (OCS, APC),
authentication, or decryption fail, all received packets (with
the exception of UDP fragments) are passed (possibly with an
empty data payload) to the user application. Options that do not
modify user data are intended to (by default) result in the user
data also being passed, even if, e.g., option checksums or
authentication fails. It is always the user's or application's
obligation to override this default behavior explicitly.</t>
        </li>
      </ol>
      <t>These principles are intended to enable the design and use of UDP
   Options with minimal impact to legacy UDP endpoints, preferably
   none. UDP is -- and remains -- a minimal transport protocol.
   Additional capability is explicitly activated by user applications
   or libraries acting on their behalf.</t>
      <t>Finally, UDP Options do not attempt to match the number of zero-
   length UDP datagrams received by legacy and option-aware receivers
   from a source using UDP fragmentation (see <xref target="sec-frag"/>). Legacy
   receivers interpret every UDP fragment as a zero-length packet
   (because they do not perform reassembly), but option-aware receivers
   would reassemble the packet as a non-zero-length packet. Zero-length
   UDP packets have been used as "liveness" indicators (see <xref section="5" sectionFormat="of" target="RFC8085"/>),
   but such use is dangerous because they lack unique
   identifiers (the IPv6 base header has none, and the IPv4 ID field is
   deprecated for such use <xref target="RFC6864"/>).</t>
    </section>
    <section anchor="the-udp-option-area">
      <name>The UDP Option Area</name>
      <t>The UDP transport header includes demultiplexing and service
identification (port numbers), an error detection checksum, and a
field that indicates the UDP datagram length (including UDP header).
The UDP Length field is typically redundant with the size of the
maximum space available as a transport protocol payload, as
determined by the IP header (see details in <xref target="sec-legacy-int"/>). The UDP
Option area is created when the UDP Length indicates a smaller
transport payload than implied by the IP header.</t>
      <t>For IPv4, the IP Total Length field indicates the total IP datagram
length (including the IP header), and the size of the IP options is
indicated in the IP header (in 4-byte words) as the "Internet Header
Length" (IHL) <xref target="RFC0791"/>, as shown in <xref target="fig-1"/>. In exceptional cases,
the Protocol field in IPv4 might not indicate UDP (i.e., 17), e.g.,
when intervening shim headers are present such as IP Security
(IPsec) <xref target="RFC4301"/> or for IP Payload Compression (IPComp) <xref target="RFC3173"/>.</t>
      <t>The upper bound for UDP Length when Protocol = 17 is given by:</t>
      <artwork><![CDATA[
   UDP_Length <= IPv4_Total_Length - IPv4_IHL * 4
]]></artwork>
      <t>If shim headers are present, this upper bound must be reduced by the
sum of the lengths of shim headers that precede the UDP header.</t>
      <figure anchor="fig-1">
        <name>IPv4 Datagram with UDP Header</name>
        <artwork><![CDATA[
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version|  IHL  |   DSCP    |ECN|          Total Length         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Identification        |Flags|      Fragment Offset    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Time to Live | Proto=17 (UDP)|        Header Checksum        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Source Address                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Destination Address                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
... zero or more IP options (using space as indicated by IHL) ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
...     zero or more shim headers (each indicating size)      ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         UDP Source Port       |     UDP Destination Port      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          UDP Length           |         UDP Checksum          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
      </figure>
      <t>For IPv6, the IP Payload Length field indicates the transport
payload after the base IPv6 header, which includes the IPv6
extension headers and space available for the transport protocol, as
shown in <xref target="fig-2"/> <xref target="RFC8200"/>. Note that the Next Header field in IPv6
might not indicate UDP (i.e., 17), e.g., when intervening IP
extension headers are present. For IPv6, the lengths of any
additional IP extensions are indicated within each extension
<xref target="RFC8200"/>, so the upper bound for UDP Length is given by:</t>
      <artwork><![CDATA[
  UDP_Length <= IPv6_Payload_Length - sum(extension header lengths)
]]></artwork>
      <figure anchor="fig-2">
        <name>IPv6 Datagram with UDP Header</name>
        <artwork><![CDATA[
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version| Traffic Class |             Flow Label                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Payload Length        |  Next Header  |   Hop Limit   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
...
|                       Source Address (128 bits)               |
...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
...
|                    Destination Address (128 bits)             |
...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
... zero or more IP Extension headers (each indicating size)  ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         UDP Source Port       |     UDP Destination Port      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          UDP Length           |         UDP Checksum          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
      </figure>
      <t>In both cases, the space available for the UDP packet is indicated
by IP, either directly in the base header or by adding information
in the shim headers or extensions. In either case, this document
will refer to this available space as the "IP transport payload".</t>
      <t>As a result of this redundancy, there is an opportunity to use the
UDP Length field as a way to break up the IP transport payload into
two areas -- that intended as UDP user data and an additional
"surplus area" (as shown in <xref target="fig-3"/>).</t>
      <figure anchor="fig-3">
        <name>IP Transport Payload vs. UDP Length</name>
        <artwork><![CDATA[
                         IP transport payload
          <------------------------------------------------->
+--------+---------+----------------------+------------------+
| IP Hdr | UDP Hdr |     UDP user data    |   surplus area   |
+--------+---------+----------------------+------------------+
          <------------------------------>
                     UDP Length
]]></artwork>
      </figure>
      <t>In most cases, the IP transport payload and UDP Length point to the
same location, indicating that there is no surplus area. This is not
a requirement of UDP <xref target="RFC0768"/> (discussed further in <xref target="sec-legacy-int"/>).
This document uses the surplus area for UDP Options.</t>
      <t>The surplus area can commence at any valid byte offset, i.e., it
need not be 16-bit or 32-bit aligned. In effect, this document
redefines the UDP Length field as a "trailer options offset".</t>
    </section>
    <section anchor="the-udp-surplus-area-structure">
      <name>The UDP Surplus Area Structure</name>
      <t>UDP Options use the entire surplus area, i.e., the contents of the
IP payload after the last byte of the UDP payload. They commence
with a 2-byte Option Checksum (OCS) field aligned to the first 2-
byte boundary (relative to the start of the IP datagram) of that
area, adding zeroes before OCS as needed for alignment. The UDP
Option area can be used with any UDP payload length (including zero,
i.e., a UDP Length of 8), as long as there remains enough space for
the aligned OCS and the options used.</t>
      <t>>> UDP Options <bcp14>MAY</bcp14> begin at any UDP Length offset.</t>
      <t>>> Option area bytes used for alignment before the OCS <bcp14>MUST</bcp14> be zero.
If this is not the case, all options <bcp14>MUST</bcp14> be ignored and the surplus
area silently discarded.</t>
      <t>These alignment bytes, coupled with OCS as computed over the
remainder of the surplus area, ensure that the one's complement sum
of the surplus area is zero. OCS is half-word (2-byte) aligned to
avoid the need for byte-swapping in its implementation.</t>
      <t>The OCS contains an optional one's complement sum that detects errors
in the surplus area, which is not otherwise covered by the UDP
      checksum, as detailed in <xref target="sec-ocs"/>.</t>
      <t>The remainder of the surplus area consists of options, all except
two of which are defined using a TLV (type, length, and optional
value) syntax similar to that of TCP <xref target="RFC9293"/>, as detailed in
<xref target="sec-udp-opt"/> (types No Operation (NOP) and End of Options List (EOL) have an implicit length of one byte).
These options continue until the end of the surplus area or can end
earlier using the EOL Option, followed by zeroes
(discussed further in <xref target="sec-udp-opt"/>).</t>
    </section>
    <section anchor="sec-ocs">
      <name>The Option Checksum (OCS)</name>
      <t>The Option Checksum (OCS) Option is a conventional Internet checksum
   <xref target="RFC0791"/> that detects errors in the surplus area. The OCS Option
   contains a 16-bit checksum that is aligned to the first 2-byte
   boundary, preceded by zeroes for padding (if needed), as shown in
   <xref target="fig-4"/>.</t>
      <figure anchor="fig-4">
        <name>UDP OCS Format, Here Using One Zero Byte for Alignment</name>
        <artwork><![CDATA[
                +--------+--------+--------+--------+
                |         UDP data         |    0   |
                +--------+--------+--------+--------+
                |       OCS       |  UDP Options... |
                +--------+--------+--------+--------+
]]></artwork>
      </figure>
      <t>The OCS consists of a 16-bit Internet checksum <xref target="RFC1071"/>, computed
   over the surplus area and including the length of the surplus area
   as an unsigned 16-bit value. The OCS protects the surplus area from
   errors in a similar way that the UDP checksum protects the UDP user
   data (when not zero).</t>
      <t>The primary purpose of the OCS is to detect existing nonstandard
   (i.e., non-option) uses of that area and accidental errors. It is
   not intended to detect attacks, as discussed further in <xref target="sec-sec-cons"/>.
   OCS is not intended to prevent future nonstandard uses of the
   surplus area nor does it enable shared use with mechanisms that do
   not comply with UDP Options.</t>
      <t>The design enables traversal of errant middleboxes that incorrectly
   compute the UDP checksum over the entire IP payload <xref target="I-D.fairhurst-udp-options-cco"/> <xref target="Zu20"/>,
   rather than only the UDP header and UDP payload (as indicated by the
   UDP header length). Because the OCS is computed over the surplus
   area and its length and then inverted, the OCS effectively negates the
   effect that incorrectly including the surplus has on the UDP
   checksum. As a result, when OCS is non-zero, the UDP checksum is the
   same in either case.</t>
      <t>>> The OCS <bcp14>MUST</bcp14> be non-zero when the UDP checksum is non-zero.</t>
      <t>>> When the UDP checksum is zero, the OCS <bcp14>MAY</bcp14> be unused and is then
   indicated by a zero OCS value.</t>
      <t>>> UDP Option implementations <bcp14>MUST</bcp14> default to using the OCS (i.e., as a
   non-zero value); users overriding that default take the risk of not
   detecting nonstandard uses of the option area (of which there are
   none currently known).</t>
      <t>Like the UDP checksum, the OCS is optional under certain
   circumstances and contains zero when not used. UDP checksums can be
   zero for IPv4 <xref target="RFC0791"/> and for IPv6 <xref target="RFC8200"/> when the UDP payload
   is already covered by another checksum, as might occur for tunnels
   <xref target="RFC6935"/>. The same exceptions apply to the OCS when used to detect
   bit errors; an additional exception occurs for its use in the UDP
      datagram prior to fragmentation or after reassembly (see <xref target="sec-frag"/>).</t>


      <t>The benefits are similar to allowing UDP checksums to be zero, but
   the risks differ. The OCS is additionally important to ensure packets
   with UDP Options can traverse errant middleboxes <xref target="Zu20"/>. When the
   cost of computing an OCS is negligible, it is better to use the OCS to
   ensure such traversal. In cases where such traversal risks can
   safely be ignored, such as controlled environments, over paths where
   traversal is validated, or where upper layer protocols
   (applications, libraries, etc.) can adapt (by enabling the OCS when
   packet exchange fails), and when bit errors at the UDP layer would
   be detected by other layers (as with the UDP checksum), the OCS can be
   disabled, e.g., to conserve energy or processing resources or when
   performance can be improved. This is why zeroing the OCS is only safe
   when UDP checksum is also zero and why OCS might still be used in
   that case.</t>
      <t>The OCS covers the surplus area as formatted for transmission and is
   processed immediately upon reception.</t>
      <t>>> If the receiver validation of the OCS fails, all options <bcp14>MUST</bcp14> be
   ignored and the surplus area silently discarded.</t>
      <t>>> UDP user data that is validated by a correct UDP checksum <bcp14>MUST</bcp14> by
   default be delivered to the application layer, even if the OCS
   fails, unless the endpoints have negotiated otherwise for this UDP
   packet's socket pair.</t>
      <t>When not used (i.e., containing zero), the OCS is assumed to be
   "correct" for the purpose of accepting UDP datagrams at a receiver
   (see <xref target="sec-opt-inclusion"/>).</t>
    </section>
    <section anchor="sec-udp-opt">
      <name>UDP Options</name>
      <t>UDP Options are a minimum of two bytes in length as shown in <xref target="fig-5"/>,
   except only the one-byte options No Operation (NOP) and End
   of Options List (EOL) described below.</t>
      <figure anchor="fig-5">
        <name>UDP Option Default Format</name>
        <artwork><![CDATA[
                +--------+--------+------------~~------------+
                |  Kind  | Length | (remainder of option...) |
                +--------+--------+------------~~------------+
]]></artwork>
      </figure>
      <t>The Kind field is always one byte and is named after the
   corresponding TCP field (though other protocols refer to this as
   "Type"). The Length field, which indicates the length in bytes of the
   entire option, including Kind and Length, is one byte for all
   lengths below 255 (including the Kind and Length bytes). A Length of
   255 indicates use of the UDP Option extended format shown in <xref target="fig-6"/>.
   The Extended Length field is a 16-bit field in network standard
   byte order. The length of the option refers to its Length field or
   Extended Length field, whichever is applicable.</t>
      <figure anchor="fig-6">
        <name>UDP Option Extended Format</name>
        <artwork><![CDATA[
                +--------+--------+--------+--------+
                |  Kind  |  255   | Extended Length |
                +--------+--------+--------+--------+
                | (remainder of option...)          |
                +--------+--------+--------+--------+
]]></artwork>
      </figure>
      <t>>> The UDP Length <bcp14>MUST</bcp14> be at least as large as the UDP header (8)
   and no larger than the IP transport payload. Datagrams with length
   values outside this range <bcp14>MUST</bcp14> be silently dropped as invalid and
   logged.</t>
      <t>>> All logging <bcp14>SHOULD</bcp14> be rate limited. Excess logging events can be
   coalesced and reported as a count or can be silently dropped if
   needed to avoid resource overloading.</t>
      <t>>> Option Lengths (or Extended Lengths, where applicable) smaller
   than the minimum for the corresponding Kind <bcp14>MUST</bcp14> be treated as an
   error. Such errors call into question the remainder of the surplus
   area and thus <bcp14>MUST</bcp14> result in all UDP Options being silently
   discarded.</t>
      <t>>> Any UDP Option other than NOP or EOL whose length is 254 or less
   <bcp14>MUST</bcp14> use the UDP Option default format shown in <xref target="fig-5"/>. NOP and
   EOL never use either length format.</t>
      <t>>> Any UDP Option whose length is larger than 254 <bcp14>MUST</bcp14> use the UDP
   Option extended format shown in <xref target="fig-6"/>.</t>
      <t>>> For compactness, UDP Options <bcp14>SHOULD</bcp14> use the smallest option
   format possible.</t>
      <t>>> UDP Options <bcp14>MUST</bcp14> be interpreted in the order in which they occur
   in the surplus area or, in the case of UDP fragments, in the order
   in which they appear in the UDP fragment option area (see <xref target="sec-frag"/>).</t>
   <t>The following UDP Options are currently defined:</t>
         <table>
        <thead>
          <tr>
            <th align="left">Kind</th>
            <th align="left">Length</th>
            <th align="left">Meaning</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left">0*</td>
            <td align="left">-</td>
            <td align="left">End of Options List (EOL)</td>
          </tr>
          <tr>
            <td align="left">1*</td>
            <td align="left">-</td>
            <td align="left">No Operation (NOP)</td>
          </tr>
          <tr>
            <td align="left">2*</td>
            <td align="left">6</td>
            <td align="left">Additional Payload Checksum (APC)</td>
          </tr>
          <tr>
            <td align="left">3*</td>
            <td align="left">10/12</td>
            <td align="left">Fragmentation (FRAG)</td>
          </tr>
          <tr>
            <td align="left">4*</td>
            <td align="left">4</td>
            <td align="left">Maximum Datagram Size (MDS)</td>
          </tr>
          <tr>
            <td align="left">5*</td>
            <td align="left">5</td>
            <td align="left">Maximum Reassembled Datagram Size (MRDS)</td>
          </tr>
          <tr>
            <td align="left">6*</td>
            <td align="left">6</td>
            <td align="left">Request (REQ)</td>
          </tr>
          <tr>
            <td align="left">7*</td>
            <td align="left">6</td>
            <td align="left">Response (RES)</td>
          </tr>
          <tr>
            <td align="left">8</td>
            <td align="left">10</td>
            <td align="left">Timestamp (TIME)</td>
          </tr>
          <tr>
            <td align="left">9</td>
            <td align="left">(varies)</td>
            <td align="left">RESERVED for Authentication (AUTH)</td>
          </tr>
          <tr>
            <td align="left">10-126</td>
            <td align="left">(varies)</td>
            <td align="left">Unassigned (assignable by IANA)</td>
          </tr>
          <tr>
            <td align="left">127</td>
            <td align="left">(varies)</td>
            <td align="left">RFC3692-style experiments (EXP)</td>
          </tr>
          <tr>
            <td align="left">128-191</td>
            <td align="left"></td>
            <td align="left">Reserved</td>
          </tr>
          <tr>
            <td align="left">192</td>
            <td align="left">(varies)</td>
            <td align="left">Reserved for UNSAFE Compression (UCMP)</td>
          </tr>
          <tr>
            <td align="left">193</td>
            <td align="left">(varies)</td>
            <td align="left">Reserved for UNSAFE Encryption (UENC)</td>
          </tr>
          <tr>
            <td align="left">194-253</td>
            <td align="left"></td>
            <td align="left">Unassigned-UNSAFE (assignable by IANA)</td>
          </tr>
          <tr>
            <td align="left">254</td>
            <td align="left">(varies)</td>
            <td align="left">RFC3692-style UNSAFE experiments (UEXP)</td>
          </tr>
          <tr>
            <td align="left">255</td>
            <td align="left"></td>
            <td align="left">Reserved-UNSAFE</td>
          </tr>
        </tbody>
      </table>
      <t>Options indicated by Kind values in the range 0..191 are known as
   SAFE Options because they do not interfere with use of UDP user data by
   legacy endpoints or when the option is unsupported. Options
   indicated by Kind values in the range 192..255 are known as UNSAFE
   Options because they might interfere with use by legacy receiving
   endpoints (e.g., an option that alters the UDP data payload).</t>
      <t>UNSAFE Option nicknames are expected to begin with capital "U",
   which needs to be avoided for SAFE Option nicknames (see <xref target="sec-iana-cons"/>). 
   RESERVED and RESERVED-UNSAFE are not assignable by IANA and not
   otherwise defined at this time. The AUTH, UCMP, and UENC
   reservations are intended for all future options supporting
   authentication, compression, and encryption, respectively, and
   remain reserved until assigned for those uses.</t>
      <t>Although the FRAG Option modifies the original UDP payload contents
   (i.e., is UNSAFE with respect to the original UDP payload), it is
   used only in subsequent fragments with zero-length UDP user data
   payloads, thus is SAFE in actual use, as discussed further in
   <xref target="sec-frag"/>.</t>
      <t>These options are defined in the following subsections. Options 0
   and 1 use the same values as for TCP.</t>
      <t>>> An endpoint supporting UDP Options <bcp14>MUST</bcp14> support those marked with
   an "*" above: EOL, NOP, APC, FRAG, MDS, MRDS, REQ, and RES. This
   includes both recognizing and being able to generate these options
   if configured to do so. These are called "must-support" options.</t>
      <t>The set of must-support options is defined herein. New options are
   not eligible for this designation.</t>
      <t>>> All other SAFE Options (without an "*") <bcp14>MAY</bcp14> be implemented, and
   their use <bcp14>SHOULD</bcp14> be determined either out-of-band or negotiated,
   notably if needed to detect when options are silently ignored by
   legacy receivers.</t>
      <t>>> Receivers supporting UDP Options <bcp14>MUST</bcp14> silently ignore unknown or
   malformed SAFE Options (i.e., in the same way a legacy receiver
   would ignore all UDP Options). An option is malformed when its
   length does not indicate (one of) the value(s) stated in the
   option's specification. A malformed FRAG Option is an exception to
   this rule; it <bcp14>SHALL</bcp14> be treated as an unsupported UNSAFE Option.</t>
      <t>>> Options with inherently invalid Length field values, i.e., those
   that indicate underruns of the option itself or overruns of the
   surplus area (pointing past the end of the IP payload), <bcp14>MUST</bcp14> be
   treated as an indication of a malformed surplus area, and all
   options <bcp14>MUST</bcp14> silently be discarded.</t>
      <t>Receivers cannot generally treat unexpected Option Lengths as
   invalid, as this would unnecessarily limit future revision of
   options (e.g., defining a new APC that is defined by having a
   different length).</t>
      <t>>> When UNSAFE Options are present, the UDP user data <bcp14>MUST</bcp14> be empty,
   and any transport payload <bcp14>MUST</bcp14> be contained in a FRAG Option (see
   <xref target="sec-frag"/>). Recall that such options may alter the transport
   payload or signal a change in what its contents represent. This
   restriction ensures their safe use in environments that might
   include legacy receivers (see <xref target="sec-unsafe-opt"/>), because the transport
   payload occurs inside the FRAG Option area and is silently discarded
   by legacy receivers.</t>
      <t>>> Receivers supporting UDP Options that receive unsupported options
   in the UNSAFE range <bcp14>MUST</bcp14> terminate all option processing and <bcp14>MUST</bcp14>
   silently drop all UDP Options in that datagram. See <xref target="sec-unsafe-opt"/> for
   further discussion of UNSAFE Options.</t>
      <t>>> Other than FRAG, NOP, EXP, and UEXP, each option <bcp14>SHOULD NOT</bcp14> occur
   more than once in a single UDP datagram. If an option other than
   these four occurs more than once, a receiver <bcp14>MUST</bcp14> interpret only the
   first instance of that option and <bcp14>MUST</bcp14> ignore later instances.
   <xref target="sec-sec-cons"/> provides additional advice for Denial of Service (DoS)
   issues that involve large numbers of options, whether valid,
   unknown, or repeating.</t>
      <t>>> NOP <bcp14>MAY</bcp14> occur multiple times, either in succession or between
   other options, for option alignment. Additional repetition
   constraints are indicated in <xref target="sec-nop"/>.</t>
      <t>>> If FRAG occurs more than once, the options area <bcp14>MUST</bcp14> be
   considered malformed and <bcp14>MUST NOT</bcp14> be processed.</t>
      <t>>> EXP and UEXP <bcp14>MAY</bcp14> occur more than once but <bcp14>SHOULD NOT</bcp14> occur more
   than once using the same Experimental ID (ExID) (see Sections <xref target="sec-exp" format="counter"/> and <xref target="sec-uexp" format="counter"/>).</t>
      <t>>> Options other than OCS, AUTH, and UENC <bcp14>MUST NOT</bcp14> include fields
   whose values depend on the contents of the surplus area.</t>
      <t>AUTH and UENC are always computed as if their hash and the OCS are
   zero; the OCS is always computed as if its contents are zero and
   after the AUTH or UENC hash has been computed.</t>
      <t>>> Future options <bcp14>MUST NOT</bcp14> be defined as having an option field
   value dependent on the content or presence of other options or on
   the remaining contents of the surplus area, i.e., the area after the
   last option (presumably EOL).</t>
      <t>If future options were to depend on the contents or presence of
   other options, interactions between those values, the OCS, and the
   AUTH and UENC Options could be unpredictable. This does not prohibit
   options that modify later options (in order of appearance within a
   packet), such as would typically be the case for compression (UCMP).</t>
      <t>Note that there is no need to reserve area after the last UDP Option
   for future uses, because any such use can be supported by defining a
   new UDP Option over that area instead. Using an option for this
   purpose is safer than treating the region as an exception, because
   its use can be verified based on option Kind and Length.</t>
      <t>>> AUTH and UENC <bcp14>MUST NOT</bcp14> be used concurrently.</t>
      <t>AUTH and UENC are never used together because UENC would serve both
   purposes.</t>
      <t>>> "Must-support" options other than NOP and EOL <bcp14>MUST</bcp14> be placed by
   the transmitter before other SAFE UDP Options. A receiver <bcp14>MAY</bcp14> drop
   all UDP Options if this ordering is not honored. Such events <bcp14>MAY</bcp14> be
   logged for diagnostic purposes.</t>
      <t>The requirement that must-support options come before others is
   intended to allow for endpoints to implement DoS protection, as
   discussed further in <xref target="sec-sec-cons"/>.</t>
    </section>
    <section anchor="safe-udp-options">
      <name>SAFE UDP Options</name>
      <t>SAFE UDP Options can be silently ignored by legacy receivers without
   affecting the meaning of the UDP user data. They stand in contrast
   to UNSAFE Options, which modify UDP user data in ways that render it
   unusable by legacy receivers (<xref target="sec-unsafe-opt"/>). The following subsections
   describe SAFE Options defined in this document.</t>
      <section anchor="end-of-options-list-eol">
        <name>End of Options List (EOL)</name>
        <t>The End of Options List (EOL, Kind=0) Option indicates that there
   are no more options. It is used to indicate the end of the list of
   options without needing to use NOP Options (see the following
   section) as padding to fill all available option space.</t>
        <figure anchor="fig-7">
          <name>UDP EOL Option Format</name>
          <artwork><![CDATA[
                               +--------+
                               | Kind=0 |
                               +--------+
]]></artwork>
        </figure>
        <t>>> When the UDP Options do not consume the entire surplus area or
   the options area of a UDP fragment, the last non-NOP Option <bcp14>MUST</bcp14> be
   EOL.</t>
        <t>>> NOPs <bcp14>SHOULD NOT</bcp14> be used as padding before the EOL Option. As a
   one-byte option, EOL need not be otherwise aligned.</t>
        <t>>> All bytes after EOL in the surplus area or the options area of a
   UDP fragment <bcp14>MUST</bcp14> be set to zero on transmit.</t>
        <t>>> Bytes after EOL in the surplus area or the options area of a UDP
   fragment <bcp14>MAY</bcp14> be checked as being zero on receipt but <bcp14>MUST NOT</bcp14> be
   otherwise processed (except for OCS calculation, which zeros would
   not affect) and <bcp14>MUST NOT</bcp14> be passed to the user.</t>
        <t>>> If a receiver elects to check the bytes following EOL and finds
   that they are not all set to zero, it <bcp14>MUST</bcp14> silently discard the
   options area. In this case, the UDP user data <bcp14>MUST</bcp14> be delivered to
   the application layer, unless the socket has been explicitly
   configured to do otherwise, as decided by the upper layer or
   negotiated with the other endpoint.</t>
        <t>Requiring the post-option surplus area to be zero prevents side-
   channel uses of this area, instead requiring that all use of the
   surplus area be UDP Options supported by both endpoints. It is
   useful to allow this area to be used for zero padding to increase
   the UDP datagram length without affecting the UDP user data length,
   e.g., for UDP DPLPMTUD (<xref section="4.4" sectionFormat="of" target="RFC9869"/>).</t>
      </section>
      <section anchor="sec-nop">
        <name>No Operation (NOP)</name>
        <t>The No Operation (NOP, Kind=1) Option is a one-byte placeholder,
   intended to be used as padding, e.g., to align multi-byte options
   along 16-bit, 32-bit, or 64-bit boundaries.</t>
        <figure anchor="fig-8">
          <name>UDP NOP Option Format</name>
          <artwork><![CDATA[
                            +--------+
                            | Kind=1 |
                            +--------+
]]></artwork>
        </figure>
        <t>>> UDP packets <bcp14>SHOULD NOT</bcp14> use more than seven consecutive NOPs,
   i.e., to support alignment up to 8-byte boundaries. UDP packets
   <bcp14>SHOULD NOT</bcp14> use NOPs at the end of the options area as a substitute
   for EOL followed by zero-fill. NOPs are intended to assist with
   alignment, not as other padding or fill.</t>
        <t>>> Receivers persistently experiencing packets with more than seven
   consecutive NOPs <bcp14>SHOULD</bcp14> log such events, at least occasionally, as a
   potential DoS indicator.</t>
        <t>NOPs are not reported to the user, whether used per-datagram or per-
   fragment (as defined in <xref target="sec-frag"/>).</t>
        <t>This issue is discussed further in <xref target="sec-sec-cons"/>.</t>
      </section>
      <section anchor="additional-payload-checksum-apc">
        <name>Additional Payload Checksum (APC)</name>
        <t>The Additional Payload Checksum (APC, Kind=2) Option provides a
   stronger supplement to the checksum in the UDP header, using a 32-
   bit Cyclic Redundancy Check (CRC) of the conventional UDP user data payload only (excluding
   the IP pseudoheader, UDP header, and surplus area). It is not an
   alternative to the UDP checksum because it does not cover the IP
   pseudoheader or UDP header, and it is not a supplement to the OCS
   because the latter covers the surplus area only. Its purpose is to
   detect user data errors that the UDP checksum might not detect.</t>
        <t>A CRC32c has been chosen because of its ubiquity and use in other
   Internet protocols, including Internet Small Computer System Interface (iSCSI) <xref target="RFC3385"/> and SCTP. The option
   contains the CRC32c in network standard byte order, as used for
   iSCSI.</t>
        <figure anchor="fig-9">
          <name>UDP APC Option Format</name>
          <artwork><![CDATA[
                +--------+--------+--------+--------+
                | Kind=2 | Len=6  |    CRC32c...    |
                +--------+--------+--------+--------+
                |  CRC32c (cont.) |
                +--------+--------+
]]></artwork>
        </figure>
        <t>When present, the APC always contains a valid CRC checksum. There
   are no reserved values, including the value zero. A CRC value of
   zero is a potentially valid checksum. As such, it does not indicate
   that the APC is not used; instead, the option would simply not be
   included if that were the desired effect.</t>
        <t>The APC does not protect the UDP pseudoheader; only the current UDP
   checksum provides that protection (when used). The APC cannot provide
   that protection because it would need to be updated whenever the UDP
   pseudoheader changed, e.g., during NAT address and port translation
	(see <xref target="RFC1141"/>).</t>
        <t>>> UDP packets with incorrect APC Option checksum fields <bcp14>SHOULD</bcp14> be passed to the
   application with an indication of APC Option checksum failure. This is the default
   behavior for APC.</t>
        <t>>> Like all SAFE UDP Options, the APC <bcp14>MUST</bcp14> be silently ignored when
   failing, unless the receiver has been explicitly configured to do
   otherwise.</t>
        <t>Although all UDP Option aware endpoints support the APC (being in the
   required set), this silently ignored behavior ensures that option-
   aware receivers operate the same as legacy receivers unless
   overridden. Another reason is because the APC check could fail even
   where the user data has not been corrupted, such as when its
   contents have been intentionally overwritten, e.g., by a middlebox to
   update embedded port numbers or IP addresses. Such overwrites could
   be intentional and not widely known; defaulting to silent ignore
   ensures that option-aware endpoints do not change how users or
   applications operate unless explicitly directed to do otherwise.</t>
        <t>>> UDP packets with unrecognized APC lengths <bcp14>MUST</bcp14> receive the same
   treatment as UDP packets with incorrect APC Option checksum fields.</t>
        <t>Ensuring that unrecognized APC lengths are treated as incorrect
   checksums enables future variants of APC to be treated similarly.</t>
        <t>The APC is reported to the user and useful only per-datagram, because
   fragments have no UDP user data.</t>
      </section>
      <section anchor="sec-frag">
        <name>Fragmentation (FRAG)</name>
        <t>The Fragmentation (FRAG, Kind=3) Option supports UDP fragmentation
   and reassembly, which can be used to transfer UDP messages larger
   than allowed by the IP Effective MTU for
   Receiving (EMTU_R) <xref target="RFC1122"/>. FRAG includes
   a copy of the same UDP transport ports in each fragment, enabling
   them to traverse stateless Network Address (and port) Translation
   (NAT) devices, in contrast to the behavior of IP fragments
   <xref target="RFC4787"/>. FRAG is typically used with the UDP MDS and MRDS Options
   to enable more efficient use of large messages, both at the UDP and
   IP layers. The design of FRAG is similar to that of the IPv6
   Fragmentation Header <xref target="RFC8200"/>, except that the UDP variant uses a
   16-bit Offset measured in bytes, rather than IPv6's 13-bit Fragment
   Offset measured in 8-byte units. This UDP variant avoids creating
   reserved fields.</t>
        <t>The FRAG header also enables use of options that modify the contents
   of the UDP payload, such as encryption (UENC, see <xref target="unsafe-encryption-uenc"/>). Like
   FRAG, such options would not be safely used on UDP payloads
   because they would be misinterpreted by legacy receivers. FRAG
   allows use of these options, either on fragments or on a whole,
   unfragmented message (i.e., an "atomic" fragment at the UDP layer,
   similar to atomic IP datagrams <xref target="RFC6864"/>). This is safe because FRAG
   hides the payload from legacy receivers by placing it within the
   surplus area.</t>
        <t>>> When FRAG is present, it <bcp14>SHOULD</bcp14> come as early as possible in the
   UDP Options list.</t>
        <t>When present, placing FRAG first can simplify some implementations,
   notably those using hardware acceleration that assume a fixed
   location for the FRAG Option. However, there are cases where FRAG
   cannot occur first, such as when combined with per-fragment UENC or
   UCMP. In those cases, encryption or compression (or both) would
   precede FRAG when they also encrypt or compress the fragment option
   itself. Additional cases could include recoding, such as could be
   used to support Forward Error Correction (FEC) over a group of
   fragments. FRAG not being first might result in software (so-called
   "slow path") option processing or might also be accommodated via a
	small set of known cases.</t>
        <t>>> When FRAG is present, the UDP user data <bcp14>MUST</bcp14> be empty. If the
   user data is not empty, all UDP Options <bcp14>MUST</bcp14> be silently ignored and
   the user data received <bcp14>MUST</bcp14> be sent to the user.</t>
        <t>Legacy receivers interpret FRAG messages as zero-length user data
   UDP packets (i.e., UDP Length field is 8, the length of just the UDP
   header), which would not affect the receiver unless the presence of
   the UDP packet itself were a signal (see <xref section="5" sectionFormat="of" target="RFC8085"/>).
   In this manner, the FRAG Option also helps hide UNSAFE Options so
   they can be used more safely in the presence of legacy receivers.</t>
        <t>The FRAG Option has two formats: non-terminal fragments use the
   shorter variant (<xref target="fig-10"/>) and terminal fragments use the longer
   (<xref target="fig-11"/>). The latter includes stand-alone fragments, i.e., when
   data is contained in the FRAG Option but reassembly is not required.</t>
        <figure anchor="fig-10">
          <name>UDP Non-Terminal FRAG Option Format</name>
          <artwork><![CDATA[
                +--------+--------+--------+--------+
                | Kind=3 | Len=10 |   Frag. Start   |
                +--------+--------+--------+--------+
                |           Identification          |
                +--------+--------+--------+--------+
                |  Frag. Offset   |
                +--------+--------+
]]></artwork>
        </figure>
        <t>Most fields are common to both FRAG Option formats. The option Len
   field indicates whether there are more fragments (Len=10) or no more
   fragments (Len=12).</t>
        <t>The Frag.&nbsp;Start field indicates the location of the beginning of the fragment
   data, measured from the beginning of the UDP header of the fragment.
   The fragment data follows the remainder of the UDP Options and
   continues to the end of the IP datagram (i.e., the end of the
   surplus area). Those options (i.e., any that precede or follow the
   FRAG Option) are applied to this UDP fragment.</t>
        <t>The Frag.&nbsp;Offset field indicates the location of this fragment
   relative to the original UDP datagram (prior to fragmentation or
   after reassembly), measured from the start of the original UDP
   datagram's header.</t>
        <t>The Identification field is a 32-bit value that, when used in
   combination with the IP source address, UDP source port, IP
   destination address, and UDP destination port, uniquely identifies
   the original UDP datagram.</t>
        <figure anchor="fig-11">
          <name>UDP Non-Terminal FRAG Option Format</name>
          <artwork><![CDATA[
               +--------+--------+--------+--------+
               | Kind=3 | Len=12 |   Frag. Start   |
               +--------+--------+--------+--------+
               |           Identification          |
               +--------+--------+--------+--------+
               |  Frag. Offset   |Reass DgOpt Start|
               +--------+--------+--------+--------+
]]></artwork>
        </figure>
        <t>The terminal FRAG Option format adds a Reassembled Datagram Option
   Start (RDOS) pointer, measured from the start of the original UDP
   datagram header, indicating the end of the reassembled data and the
   start of the surplus area within the original UDP datagram. UDP
   Options that apply to the reassembled datagram are contained in the
   reassembled surplus area, as indicated by RDOS. UDP Options that
   occur within the fragment are processed on the fragment itself. This
   allows either pre-reassembly or post-reassembly UDP Option effects,
   such as using UENC on each fragment while also using TIME on the
   reassembled datagram for round-trip latency measurements.</t>
        <t>An example showing the relationship between UDP fragments and the
   original UDP datagram is provided in <xref target="fig-12"/>. In this example, the
   trailer containing per-datagram options resides entirely within the
   terminal fragment, but this need not always be the case.</t>
        <figure anchor="fig-12">
          <name>UDP Fragments and Original UDP Datagram</name>
          <artwork><![CDATA[
       Constituent UDP Fragments         Original UDP Datagram

     +-------------+------------+
     | Src Port    | Dst Port   |
     +-------------+------------+
     | UDP Len (8) | UDP Chksum |
     +-------------+------------+
     |     OCS     | K=3   L=10 |      +-------------+------------+
     +-------------+------------+      | Src Port    | Dst Port   |
  ,--| Frag. Start | Identifi-  ~      +-------------+------------+
  |  +-------------+------------+      | UDP L.(RDOS)| UDP Chksum |
  |  ~ cation      | Frag. Off. |----->+-------------+------------+
  |  +-------------+------------+      | Frag Data from 1st Frag. |
  |  ~ Per-Fragment Options     ~      |             .            |
  '->+-------------+------------+      ~             .            ~
     ~      Fragment Data       ~      |             .            |
     +-------------+------------+  ,-->+-------------+------------+
                                   |   | Frag Data from 2nd Frag. |
     +-------------+------------+  |   |             .            |
     | Src Port    | Dst Port   |  |   ~             .            ~
     +-------------+------------+  |   |             .            |
     | UDP Len (8) | UDP Chksum |  | ,>+-------------+------------+
     +-------------+------------+  | | |     OCS     | UDP Options|
     |     OCS     | K=3   L=12 |  | | +-------------+            +
     +-------------+------------+  | | ~             .            ~
  ,--| Frag. Start | Identifi-  ~  | | +-------------+------------+
  |  +-------------+------------+  | |
  |  ~ cation      | Frag. Off. |--' |
  |  +-------------+------------+    |
  |  |  RDOS       | Frag.Opts. |    |
  '->+--|----------+------------+    |
     ~  |   Fragment Data       ~    |
     +--|----------+------------+    |
        |                            |
        '----------------------------'
]]></artwork>
        </figure>
        <t>The FRAG Option does not need a "more fragments" bit (as used by IP
   fragmentation) because it provides the same indication by using the
   longer, 12-byte variant, as shown in <xref target="fig-11"/>.</t>
        <t>>> The FRAG Option <bcp14>MAY</bcp14> be used on a single fragment; in this case,
   the Frag.&nbsp;Offset would be zero and the option would have the 12-byte
   format.</t>
        <t>>> Endpoints supporting UDP Options <bcp14>MUST</bcp14> be capable of fragmenting
   and reassembling at least two fragments, each of a size that will
   fit within the standard Ethernet MTU of 1,500 bytes. For further
   details, please see <xref target="sec-mrds"/>.</t>
        <t>Use of the single fragment variant can be helpful in supporting use
   of UNSAFE Options without undesirable impact to receivers that do
   not support either UDP Options or the specific UNSAFE Options.</t>
        <t>During fragmentation, the UDP header checksum of each fragment
   remains constant. It does not depend on the fragment data (which
   appears in the surplus area) because all fragments have a zero-
   length user data field.</t>
        <t>>> The Identification field is a 32-bit value that <bcp14>MUST</bcp14> be unique
   over the expected fragment reassembly timeout.</t>
        <t>>> The Identification field <bcp14>SHOULD</bcp14> be generated in a manner similar
   to that of the IPv6 Fragment ID <xref target="RFC8200"/>.</t>
        <t>>> UDP fragments <bcp14>MUST NOT</bcp14> overlap.</t>
        <t>>> Similar to IPv6 reassembly <xref target="RFC8200"/>, if any of the fragments
   being reassembled overlap with any other fragments being reassembled
   for the same UDP packet, reassembly of that UDP packet <bcp14>MUST</bcp14> be
   abandoned and all the fragments that have been received for that UDP
   packet <bcp14>MUST</bcp14> be discarded, and no ICMP error messages are to be sent
   in this case (to avoid a potential DoS attack turning into an ICMP
   storm in the reverse direction).</t>
        <t>>> Note that fragments might be duplicated in the network. Instead
   of treating these exact duplicate fragments as overlapping
   fragments, an implementation <bcp14>MAY</bcp14> choose to detect this case and drop
   exact duplicate fragments while keeping the other fragments
   belonging to the same UDP packet.</t>
        <t>UDP fragmentation relies on a fragment expiration timer, which can
   be preset or could use a value computed using the UDP Timestamp
   Option.</t>
        <t>>> The default UDP reassembly expiration timeout <bcp14>SHOULD</bcp14> be no more
   than 2 minutes.</t>
        <t>>> UDP reassembly expiration <bcp14>MUST NOT</bcp14> generate an ICMP error. Such
   events are not an IP error and can be addressed by the
   user/application layer if desired.</t>
        <t>>> UDP reassembly space <bcp14>SHOULD</bcp14> be limited to reduce the impact of
	DoS attacks on resource use.</t>

        <t>>> UDP reassembly space limits <bcp14>SHOULD NOT</bcp14> be computed as a shared
   resource across multiple sockets, to avoid cross-socket pair DoS
   attacks.</t>
        <t>>> Individual UDP fragments <bcp14>MUST NOT</bcp14> be forwarded to the user. The
   reassembled datagram is received only after complete reassembly,
   checksum validation, and continued processing of the remaining UDP
   Options.</t>
        <t>Per-fragment UDP Options, if used in addition to FRAG, occur before
   the fragment data. They typically occur after the FRAG Option,
   except where they modify the FRAG Option itself (e.g., UENC or
   UCMP). Per-fragment options are processed before the fragment is
   included in the reassembled datagram. Such options can be useful to
   protect the reassembly process itself, e.g., to prevent the
   reassembly cache from being polluted (using AUTH or UENC).</t>
        <t>>> Fragments of a single datagram <bcp14>MAY</bcp14> use different sets of options.
   It is expected to be computationally expensive to validate
   uniformity across all fragments, and there could be legitimate
   reasons for including options in a fragment but not all fragments
   (e.g., MDS and MRDS).</t>
        <t>If an option is used per-fragment but defined as not usable per-
   fragment, it is treated the same as any other unknown option.</t>
        <t>Per-datagram UDP Options, if used, reside in the surplus area of the
   original UDP datagram. Processing of those options occurs after
   reassembly is complete. This enables the safe use of UNSAFE Options,
   which are required to result in discarding the entire UDP datagram
   if they are unknown to the receiver or otherwise fail (see <xref target="sec-unsafe-opt"/>).</t>
        <t>In general, UDP packets are fragmented as follows:</t>
        <ol spacing="normal" type="1"><li>
            <t>Create a UDP packet with data and UDP Options. This is the
original UDP datagram, which we will call "D". The UDP Options
follow the UDP user data and occur in the surplus area, just as
in an unfragmented UDP datagram with UDP Options.  </t>
            <t>
>> UDP Options for the original packet <bcp14>MUST</bcp14> be fully prepared
before the rest of the fragmentation steps that follow here.  </t>
            <t>
>> The UDP checksum of the original packet <bcp14>SHOULD</bcp14> be set to zero
because it is never transmitted. Equivalent protection is
provided if each fragment has a non-zero OCS value, as will be
the case if each fragment's UDP checksum is non-zero. Similarly,
the OCS value of the original packet <bcp14>SHOULD</bcp14> be zero if each
fragment will have a non-zero OCS value, as will be the case if
each fragment's UDP checksum is non-zero.</t>
          </li>
          <li>
            <t>Identify the desired fragment size, which we will call "S". This
value is calculated to take into account the path MTU (if known)
and to allow space for per-fragment options.</t>
          </li>
          <li>
            <t>Fragment "D" into chunks of size no larger than "S"-12 each (10
for the non-terminal FRAG Option and 2 for OCS), with one final
chunk no larger than "S"-14 (12 for the terminal FRAG Option and
2 for OCS). Note that all the per-datagram options in step #1
need not be limited to the terminal fragment, i.e., the RDOS
pointer can indicate the start of the original surplus area
anywhere in the reassembled datagram.</t>
          </li>
          <li>
            <t>For each chunk of "D" in step #3, create a UDP packet with no
user data (UDP Length=8) followed by the word-aligned OCS, the
FRAG Option, and any additional per-fragment UDP Options,
followed by the FRAG data chunk.</t>
          </li>
          <li>
            <t>Complete the processing associated with creating these additional
per-fragment UDP Options for each fragment.</t>
          </li>
        </ol>
        <t>Receivers reverse the above sequence. They process all received
   options in each fragment. When the FRAG Option is encountered, the
   FRAG data is used in reassembly. After all fragments are received,
   the entire UDP packet is processed with any trailing UDP Options
   applying to the reassembled user data.</t>
        <t>>> Reassembly failures at the receiver result in silent discard of
   any per-fragment options and fragment contents, and such failures
   <bcp14>SHOULD NOT</bcp14> generate zero-length frames to the user.</t>
        <t>>> Finally, because fragmentation processing can be expensive, the
   FRAG Option <bcp14>SHOULD</bcp14> be avoided unless the original datagram requires
   fragmentation or it is needed for "safe" use of UNSAFE Options.</t>
        <t>>> The FRAG Option <bcp14>MAY</bcp14> also be used to provide limited support for
   UDP Options in systems that have access to only the initial portion
   of the data in incoming or outgoing packets, as such systems could
   potentially access per-fragment options. Such packets would, of
   course, be silently ignored by legacy receivers that do not support
   UDP Options.</t>
        <t>The presence of the FRAG Option is not reported to the user.</t>
      </section>
      <section anchor="maximum-datagram-size-mds">
        <name>Maximum Datagram Size (MDS)</name>
        <t>The Maximum Datagram Size (MDS, Kind=4) Option is a 16-bit hint of
   the largest UDP packet or UDP fragment that an endpoint believes can
   be received without use of IP fragmentation. It helps UDP
   applications limit the largest UDP packet that can be sent without
   UDP fragmentation and helps UDP fragmentation determine the largest
   UDP fragment to send -- in both cases, to avoid IP fragmentation.</t>
        <t>As with the TCP Maximum Segment Size (MSS) Option <xref target="RFC9293"/>, the
   size indicated is the IP layer MTU decreased by the fixed IP and UDP
   headers only <xref target="RFC9293"/>. The space needed for IP and UDP Options
   needs to be adjusted by the sender when using the value indicated.
   The value transmitted is based on EMTU_R, the largest IP datagram
   that can be received (i.e., reassembled at the receiver) <xref target="RFC1122"/>.
   However, as with TCP, this value is only a hint at what the receiver
   believes, as when used with PLPMTUD at the UDP layer, as discussed
   later in this section.</t>
        <t>>> MDS does not indicate a known path MTU and thus <bcp14>MUST NOT</bcp14> be used
   to limit transmissions.</t>
        <figure anchor="fig-13">
          <name>UDP MDS Option Format</name>
          <artwork><![CDATA[
                +--------+--------+--------+--------+
                | Kind=4 | Len=4  |    MDS size     |
                +--------+--------+--------+--------+
]]></artwork>
        </figure>
        <t>>> The UDP MDS Option <bcp14>MAY</bcp14> be used as a hint for path MTU discovery
   <xref target="RFC1191"/> <xref target="RFC8201"/>, but this could be difficult because of known
   issues with ICMP blocking <xref target="RFC2923"/> as well as UDP lacking automatic
   retransmission.</t>
        <t>MDS is more likely to be useful when coupled with IP source
   fragmentation or UDP fragmentation to limit the largest reassembled
   UDP message as indicated by MRDS (see <xref target="sec-mrds"/>), e.g., when
   EMTU_R is larger than the required minimums (576 for IPv4 <xref target="RFC0791"/>
   and 1500 for IPv6 <xref target="RFC8200"/>).</t>
        <t>>> MDS can be used with DPLPMTUD <xref target="RFC8899"/> to provide a hint to the
   Packetization Layer Path MTU (PLPMTU) value, though it <bcp14>MUST NOT</bcp14>
   prohibit transmission of larger UDP packets used as DPLPMTUD probes.</t>
        <t>MDS is reported to the user, whether used per-datagram or per-
   fragment (as defined in <xref target="sec-frag"/>). When used per-fragment, the
   reported value is the minimum of the MDS values received per-
   fragment.</t>
      </section>
      <section anchor="sec-mrds">
        <name>Maximum Reassembled Datagram Size (MRDS)</name>
        <t>The Maximum Reassembled Datagram Size (MRDS, Kind=5) Option is a 16-
   bit indicator of the largest reassembled UDP datagram that can be
   received, including the UDP header and any per-datagram UDP Options,
   accompanied by an 8-bit indication of how many UDP fragments can be
   reassembled. The MRDS size field is the UDP equivalent of IP's EMTU_R, but the
   two are not related <xref target="RFC1122"/>. Using the FRAG Option (<xref target="sec-frag"/>),
   UDP packets can be transmitted as transport fragments, each in their
   own (presumably not fragmented) IP datagram, and be reassembled at
   the UDP layer. MRDS segs is the number of UDP fragments that can be
   reassembled.</t>
        <figure anchor="fig-14">
          <name>UDP MRDS Option Format</name>
          <artwork><![CDATA[
            +--------+--------+--------+--------+---------+
            | Kind=5 | Len=5  |    MRDS size    |MRDS segs|
            +--------+--------+--------+--------+---------+
]]></artwork>
        </figure>
        <t>>> Endpoints supporting UDP Options <bcp14>MUST</bcp14> support a local MRDS size
   of at least 2,926 bytes for IPv4 and 2,886 bytes for IPv6. Support
   for larger values is encouraged.</t>
        <t>>> Endpoints supporting UDP Options <bcp14>MUST</bcp14> support a local MRDS segs
	value of at least 2. Support for larger values is encouraged.</t>
	

        <t>These parameters plus the Path MTU (PMTU) allow a sender to compute the size of
   the largest pre-fragmentation UDP packet that a receiver will
   guarantee to accept. MMS_S is defined as the PMTU less the size of
   the IP header and the UDP header, i.e., the maximum UDP message size
   that can be successfully sent in a single UDP datagram if there are
   no IP options or extension headers and no UDP per-fragment options.
   Given the above size definitions, the size of the largest pre-fragmentation UDP packet that the
   receiver will guarantee to accept is the smaller of the MRDS size
   and the following:</t>
        <t>(MMS_S - 12) * (MRDS segs) - 2 - (Total Per-Frag IP/UDP Options) + 8</t>
        <t>In the above expression, the Total Per-Frag IP/UDP Options includes the size of all IP
   options and extension headers and all per-fragment UDP Options,
   except for OCS and FRAG, that are in the sequence of UDP fragments.</t>
        <t>>> If no MRDS Option has been received, a sender <bcp14>MUST</bcp14> assume that
   MRDS size is 2,926 bytes for IPv4 and 2,886 bytes for IPv6 and that
   MRDS segs is 2, i.e., the minimum values allowed.</t>
        <t>MRDS is reported to the user, whether used per-datagram or per-
   fragment (as defined in <xref target="sec-frag"/>). When used per-fragment, the
   reported value is the minimum of the MRDS values received per-
   fragment.</t>
      </section>
      <section anchor="echo-request-req-and-echo-response-res">
        <name>Echo Request (REQ) and Echo Response (RES)</name>
        <t>The echo Request (REQ, Kind=6) and echo Response (RES, Kind=7)
   Options provide UDP packet-level acknowledgments as a capability
   for use by upper layer protocols, e.g., user applications,
   libraries, operating systems, etc. Both the REQ and RES are under
   the control of these upper layers, i.e., UDP Option support
   described in this document never automatically responds to a REQ
   with a RES. Instead, the REQ is delivered to the upper layer, which
   decides whether and when to issue a RES.</t>
        <t>One such use is described as part of DPLPMTUD <xref target="RFC9869"/>. This use case
   is described as part of UDP Options but is logically considered to
   be a capability of an upper layer that uses UDP Options. The options
   both have the format indicated in <xref target="fig-15"/>, in which the token has
   no internal structure or meaning.</t>
        <figure anchor="fig-15">
          <name>UDP REQ and RES Options Format</name>
          <artwork><![CDATA[
                +--------+--------+-----------------+
                |  Kind  | Len=6  |      token      |
                +--------+--------+-----------------+
                  1 byte   1 byte       4 bytes
]]></artwork>
        </figure>
        <t>>> As advice to upper layer protocol/library designers, when
   supporting REQ/RES and responding with a RES, the upper layer <bcp14>SHOULD</bcp14>
   respond with the most recently received REQ token.</t>
        <t>>> If the implementation includes a layer/library that produces and
   consumes REQ/RES on behalf of the user/application, then that layer
   <bcp14>MUST</bcp14> be disabled by default; in this case, REQ/RES are simply sent
   upon request by the user/application and passed to it when received,
	as with most other UDP Options.</t>
        <t>For example, an application needs to explicitly enable the
   generation of a RES Option by DPLPMTUD when using UDP Options
   <xref target="RFC9869"/>.</t>
        <t>>> The token transmitted in a RES Option <bcp14>MUST</bcp14> be a token received in
   a REQ Option by the transmitter. This ensures that the response is
   to a received request.</t>
        <t>REQ and RES Option kinds each appear at most once in each UDP
   packet, as with most other options. A single packet can include both
   options, though they would be otherwise unrelated to each other.
   Note also that the FRAG Option is not used when sending DPLPMTUD
   probes to determine a PLPMTU <xref target="RFC9869"/>.</t>
        <t>REQ and RES are reported to the user, whether used per-datagram or
   per-fragment (as defined in <xref target="sec-frag"/>). When used per-fragment,
   the reported value indicates the most recently received token.</t>
      </section>
      <section anchor="timestamps-time">
        <name>Timestamp (TIME)</name>
        <t>Timestamps are provided as a capability to be used by applications
   and other upper layer protocols. They are based on a notion of time
   as a monotonically non-decreasing unsigned integer, with wraparound.
   They are defined the same way as TCP Protection Against Wrapped
   Sequence (PAWS) numbers, i.e., "without any connection to [real-world,
   classical physics wall-clock] time" <xref target="RFC7323"/>. They are quite
   similar to the behavior of relativistic time or the individual
   scalars of Lamport clocks <xref target="La78"/>. However, if desired, they can
   correspond to real-world time, e.g., as used for round-trip time (RTT)
   estimation. This option makes no assertions as to which is the case;
	the decision is up to the application layer using this option.</t>
        <t>The Timestamp (TIME, Kind=8) Option exchanges two four-byte unsigned
   timestamp fields. It serves a similar purpose to TCP's Timestamp (TS) Option
   <xref target="RFC7323"/>, enabling UDP to estimate the RTT
   between hosts. For UDP, this RTT can be useful for establishing UDP
   fragment reassembly timeouts or transport-layer rate limiting
   <xref target="RFC8085"/>.</t>
        <figure anchor="fig-16">
          <name>UDP TIME Option Format</name>
          <artwork><![CDATA[
     +--------+--------+------------------+------------------+
     | Kind=8 | Len=10 |      TSval       |      TSecr       |
     +--------+--------+------------------+------------------+
       1 byte   1 byte       4 bytes            4 bytes
]]></artwork>
        </figure>
        <t>TS Value (TSval) and TS Echo Reply (TSecr) are used in a similar
   manner to the TCP TS Option <xref target="RFC7323"/>. On transmitted UDP packets
   using the option, TSval is always set based on the local "time"
   value. Received TSval and TSecr field contents are provided to the
   application, which can pass the received TSval to be used as TSecr in
   UDP messages sent in response (i.e., to echo the received TSval). A
   received TSecr of zero indicates that the TSval was not echoed by
   the transmitter, i.e., from a previously received UDP packet.</t>
        <t>>> TIME <bcp14>MAY</bcp14> use an RTT estimate based on non-zero Timestamp values as
   a hint for fragmentation reassembly, rate limiting, or other
   mechanisms that benefit from such an estimate.</t>
        <t>>> An application <bcp14>MAY</bcp14> use TIME to compute this RTT estimate for
   further use by the user.</t>
        <t>UDP timestamps are modeled after TCP timestamps and have similar
   expectations. In particular, they are expected to follow these
   guidelines:</t>
        <ul spacing="normal">
          <li>
            <t>Values are monotonic and non-decreasing except for anticipated
 number-space rollover events.</t>
          </li>
          <li>
            <t>Values "increase" (allowing for rollover, i.e., modulo the field
 size except zero) according to a typical 'tick' time.</t>
          </li>
          <li>
            <t>A request is defined as TSval being non-zero, and a reply is
 defined as TSecr being non-zero.</t>
          </li>
          <li>
            <t>A receiver always responds to a request with the highest TSval
 received (allowing for rollover), which is not necessarily the
 most recently received.</t>
          </li>
        </ul>
        <t>Rollover can be handled as a special case or more completely using
   sequence number extension <xref target="RFC9187"/>; however, zero values need to be
   avoided explicitly.</t>
        <t>>> TIME values <bcp14>MUST NOT</bcp14> use zeros as valid time values, because they
   are used as indicators of requests and responses.</t>
        <t>TIME is reported to the user, whether used per-datagram or per-
   fragment (as defined in <xref target="sec-frag"/>). When used per-fragment, the
   reported value is the minimum and maximum of each of the timestamp
   values received per-fragment.</t>
        <t>>> Use of TIME per-fragment is <bcp14>NOT RECOMMENDED</bcp14>. Exceptions include
   supporting diagnostics on the reassembly process itself, which could
   be more appropriate to handle within the UDP Option processing
   implementation.</t>
      </section>
      <section anchor="sec-auth">
        <name>Authentication (AUTH), RESERVED Only</name>
        <t>The Authentication (AUTH, Kind=9) Option is reserved for all UDP
   authentication mechanisms <xref target="I-D.touch-tsvwg-udp-auth-opt"/>. AUTH is expected to cover the UDP
   user data and UDP Options, with possible additional coverage of the
   IP pseudoheader and UDP header and potentially also support for NAT
   traversal (i.e., by zeroing the remote socket -- the source IP
   address and UDP port -- before computing the check), the latter in a
   similar manner as per TCP Authentication Option (TCP-AO) NAT traversal <xref target="RFC6978"/>.</t>
        <t>Like APC, AUTH is a SAFE Option because it does not modify the UDP
   user data. AUTH could fail even where the user data has not been
   corrupted, such as when its contents have been overwritten. Such
   overwrites could be intentional and not widely known; defaulting to
   silent ignore ensures that option-aware endpoints do not change how
   users or applications operate unless explicitly directed to do
   otherwise. When a socket pair relies on AUTH, e.g., upon
   configuration of a security policy, this default is expected to be
   overridden, where incoming packets without AUTH or with a failed
   AUTH check would be silently dropped, such that only authenticated
   packets would be sent to the user. This approach enables security
   checks for AUTH to occur above UDP, in a separate shim layer or
   application library.</t>
        <t>A specification for using AUTH is expected to define the
   coordination of AUTH security parameters and configuration of the
   socket pair when those parameters are installed. That specification
   is expected to address rules for when AUTH is required upon
   transmission and when the presence and correct validation of AUTH is
   required on reception.</t>
      </section>
      <section anchor="sec-exp">
        <name>Experimental (EXP)</name>
        <t>The Experimental (EXP, Kind=127) Option is allocated for experiments
   <xref target="RFC3692"/>. Only one such value is allocated because experiments are
   expected to use an Experimental ID (ExID) to differentiate
   concurrent use for different purposes, using UDP ExIDs registered
   with IANA according to the approach developed for TCP experimental
   options <xref target="RFC6994"/>.</t>
        <figure anchor="fig-17">
          <name>UDP EXP Option Format</name>
          <artwork><![CDATA[
            +----------+----------+----------+----------+
            | Kind=127 |   Len    |      UDP ExID       |
            +----------+----------+----------+----------+
            |  (option contents, as defined)...         |
            +----------+----------+----------+----------+
]]></artwork>
        </figure>
        <t>>> The length of the Experimental Option <bcp14>MUST</bcp14> be at least 4 to
   account for the Kind, Len, and 16-bit UDP ExID
   (similar to TCP ExIDs <xref target="RFC6994"/>).</t>
        <t>The UDP EXP Option uses only 16-bit ExIDs, unlike TCP ExIDs. In TCP,
   the first 16 bits of the ExID is unique; the additional 16 bits,
   where present, are used to decrease the chance of the entire ExID
   occurring in legacy use of the TCP EXP Option. This extended variant
   provides no similar use for UDP EXP because ExIDs are required.</t>
        <t>The UDP EXP Option also includes an Extended Length format, where
   the option Len is 255, followed by two bytes of Extended Length.</t>
        <figure anchor="fig-18">
          <name>UDP EXP Extended Option Format</name>
          <artwork><![CDATA[
            +----------+----------+----------+----------+
            | Kind=127 |   255    |   Extended Length   |
            +----------+----------+----------+----------+
            |      UDP ExID       |(option contents...) |
            +----------+----------+----------+----------+
]]></artwork>
        </figure>
        <t>UDP Experimental IDs (ExIDs) are assigned from a combined
   TCP/UDP ExID registry managed by IANA (see <xref target="sec-iana-cons"/>). Assigned
   ExIDs can be used in either the EXP or UEXP Options (see <xref target="sec-uexp"/> 
   for the latter).</t>
      </section>
    </section>
    <section anchor="sec-unsafe-opt">
      <name>UNSAFE Options</name>
      <t>UNSAFE Options are not safe to ignore and can be used
   unidirectionally or without soft-state confirmation of UDP Option
   capability. They are always used only when the user data occurs
   inside a reassembled set of one or more UDP fragments, such that if
   UDP fragmentation is not supported, the enclosed UDP user data would
   be silently dropped anyway.</t>
      <t>>> Applications using UNSAFE Options <bcp14>SHOULD NOT</bcp14> also use zero-length
   UDP packets as signals, because they will arrive when UNSAFE Options
   fail. Those that choose to allow such packets <bcp14>MUST</bcp14> account for such
   events.</t>
      <t>>> UNSAFE Options <bcp14>MUST</bcp14> be used only as part of UDP fragments, used
      either per-fragment or after reassembly.</t>
      <t>>> Receivers supporting UDP Options <bcp14>MUST</bcp14> silently drop the UDP user
   data of the reassembled datagram if any fragment or the entire
   datagram includes an UNSAFE Option whose Kind is not supported or
   if an UNSAFE Option appears outside the context of a fragment or
   reassembled fragments.</t>
      <section anchor="unsafe-compression-ucmp">
        <name>UNSAFE Compression (UCMP)</name>
        <t>The UNSAFE Compression (UCMP, Kind=192) Option is reserved for all
   UDP compression mechanisms. UCMP is expected to cover the UDP user
   data and some (e.g., later, in sequence) UDP Options.</t>
      </section>
      <section anchor="unsafe-encryption-uenc">
        <name>UNSAFE Encryption (UENC)</name>
        <t>The UNSAFE Encryption (UENC, Kind=193) Option is reserved for all
   UDP encryption mechanisms. UENC is expected to provide all of the
   services of the AUTH Option (<xref target="sec-auth"/>) and in addition to
   encrypt the UDP user data and some (e.g., later or in sequence) UDP
   Options, in a similar manner as TCP Authentication Option Extension for Payload Encryption (TCP-AO-ENC) <xref target="I-D.touch-tcp-ao-encrypt"/>.</t>
      </section>
      <section anchor="sec-uexp">
        <name>UNSAFE Experimental (UEXP)</name>
        <t>The UNSAFE Experimental (UEXP, Kind=254) Option is reserved for
   experiments <xref target="RFC3692"/>. As with EXP, only one such UEXP value is
   reserved because experiments are expected to use an Experimental ID
   (ExIDs) to differentiate concurrent use for different purposes,
   using UDP ExIDs registered with IANA according to the approach
   developed for TCP experimental options <xref target="RFC6994"/>.</t>
        <t>Assigned ExIDs can be used with either the UEXP or EXP Options.</t>
      </section>
    </section>
    <section anchor="sec-rules">
      <name>Rules for Designing New Options</name>
      <t>The UDP Option Kind space allows for the definition of new options;
   however, the currently defined options (including AUTH, UENC, and
   UCMP) do not allow for arbitrary new options. The following is a
   summary of rules for new options and their rationales:</t>
      <t>>> New options <bcp14>MUST NOT</bcp14> be defined as "must-implement", i.e., they
   are not eligible for the asterisk ("*") designation used in <xref target="sec-udp-opt"/>.</t>
      <t>This document defines the minimum set of "must-implement" UDP
   Options. All new options are included at the discretion of a given
   implementation.</t>
      <t>>> New options <bcp14>MUST NOT</bcp14> modify the content of options that precede
   them (in order of appearance and thus processing).</t>
      <t>>> The fields of new options <bcp14>MUST NOT</bcp14> depend on the content of other
   options.</t>
      <t>UNSAFE Options can both depend on and vary user data content because
   they are contained only inside UDP fragments and thus are processed
   only by receivers capable of handling UDP Options.</t>
      <t>>> New options <bcp14>MUST NOT</bcp14> declare their order relative to other
      options, whether new or old, even as a preference.</t>
      <t>>> At the sender, new options <bcp14>MUST NOT</bcp14> modify UDP packet content
   anywhere outside their option field, excepting only UNSAFE Options; areas that need to remain
   unmodified include the IP header, IP options, UDP user data, and
   surplus area (i.e., other options).</t>
      <t>>> Options <bcp14>MUST NOT</bcp14> be modified in transit. This includes those
   already defined as well as new options.</t>
      <t>>> New options <bcp14>MUST NOT</bcp14> require or allow that any UDP Options
   (including themselves) or the remaining surplus area be modified in
      transit.</t>
      <t>>> All options <bcp14>MUST</bcp14> indicate whether they can be used per-fragment
   and, if so, <bcp14>MUST</bcp14> also indicate how their success or failure is
   reported to the user. It is <bcp14>RECOMMENDED</bcp14> that new options be designed to support per-fragment use; it is also <bcp14>RECOMMENDED</bcp14> that options used per-fragment
   be reported to the user as a finite aggregate (e.g., a sum,
      a flag, etc.) rather than individually.</t>
      <t>With one exception, UNSAFE Options are used when UDP user data needs to be modified:</t>
          <t>>> The FRAG Option modifies UDP user data, splitting it across
 multiple IP packets. UNSAFE Options <bcp14>MAY</bcp14> modify the UDP user data,
 e.g., by encryption, compression, or other transformations. All
 other (SAFE) options <bcp14>MUST NOT</bcp14> modify the UDP user data.</t>
    </section>
    <section anchor="sec-opt-inclusion">
      <name>Option Inclusion and Processing</name>
      <t>The following rules apply to option inclusion by senders and
   processing by receivers.</t>
      <t>>> Senders <bcp14>MAY</bcp14> add any option, as configured by the API.</t>
      <t>>> All "must-support" options <bcp14>MUST</bcp14> be processed by receivers, if
      present (presuming UDP Options are supported at that receiver).</t>
      <t>>> Options that are not "must-support" options <bcp14>MAY</bcp14>, if present, be ignored by receivers,
   based, e.g., on API settings.</t>
      <t>>> All options <bcp14>MUST</bcp14> be processed by receivers in the order
   encountered in the options area.</t>
      <t>>> Unless configuration settings direct otherwise, all options
   except UNSAFE Options <bcp14>MUST</bcp14> result in the UDP user data being passed
   to the upper layer protocol or application, regardless of whether
   all options are processed, are supported, or succeed.</t>
      <t>The basic premise is that, for options-aware endpoints, the sender
   decides what options to add and the receiver decides what options to
   handle. Simply adding an option does not force work upon a receiver,
   with the exception of the "must-support" options.</t>
      <t>Upon receipt, the receiver checks various properties of the UDP
   packet and its options to decide whether to accept or drop the UDP
   packet and whether to accept or ignore some of its options as
   follows (in order):</t>
      <sourcecode type="pseudocode"><![CDATA[
        if the UDP checksum fails then
            silently drop the entire UDP packet (per RFC 1122)
        if the UDP checksum passes or is zero then
            if (OCS != 0 and OCS fails) or
               (OCS == 0 and UDP CS != 0) then
                deliver the UDP user data but ignore other options
                (this is required to emulate legacy behavior)
            if (OCS != 0 and OCS passes) or
               (OCS == 0 and UDP CS == 0) then
                deliver the UDP user data after parsing
                and processing the rest of the options,
                regardless of whether each is supported or succeeds
                (again, this is required to emulate legacy behavior)
]]></sourcecode>
      <t>The design of the UNSAFE Options ensures that the resulting UDP data
   will be silently dropped in both legacy receivers and options-aware receivers
   that do not recognize those options. Again, note that this still
   results in the delivery of a zero-length UDP packet.</t>
      <t>Options-aware receivers can drop UDP packets with option processing
   errors via either an override of the default UDP processing or at
   the application layer.</t>
      <t>Put another way, all options are treated the same, in that the transmitter can
   add each option as desired and the receiver has the choice to require a given option or
   not. Only if a particular option is indicated as mandatory by a receiver (e.g., by API configuration) would the
   receiver need to confirm it being present and correct.</t>
      <t>In summary, for all options:</t>
      <ul spacing="normal">
        <li>
          <t>if the option is not required by the receiver, then UDP packets
 missing the option are accepted.</t>
        </li>
        <li>
          <t>if the option is required (e.g., by override of the default
 behavior at the receiver) and missing or incorrectly formed,
 silently drop the UDP packet.</t>
        </li>
        <li>
          <t>if the UDP packet is accepted (either because the option is not
 required or because it was required and correct), then pass the
 option with the UDP packet via the API. Note that FRAG, NOP, and
 EOL are not passed to the user (see <xref target="sec-udp-api"/>).</t>
        </li>
      </ul>
      <t>>> Any options whose length exceeds that of the UDP packet (i.e.,
   intending to use data that would have been beyond the surplus area)
   <bcp14>SHOULD</bcp14> be silently ignored (again to model legacy behavior).</t>
    </section>
    <section anchor="sec-udp-api">
      <name>UDP API Extensions</name>
      <t>UDP currently specifies an Application Programming Interface (API),
   summarized as follows (with Unix-style command as an example)
   <xref target="RFC0768"/>:</t>
      <ul spacing="normal">
        <li>
          <t>Method to create new receive ports  </t>
          <ul spacing="normal">
            <li>
              <t>e.g., bind(handle, recvaddr(optional), recvport)</t>
            </li>
          </ul>
        </li>
        <li>
          <t>Receive, which returns data octets, source port, and source
address  </t>
          <ul spacing="normal">
            <li>
              <t>e.g., recvfrom(handle, srcaddr, srcport, data)</t>
            </li>
          </ul>
        </li>
        <li>
          <t>Send, which specifies data, source and destination addresses, and
source and destination ports  </t>
          <ul spacing="normal">
            <li>
              <t>e.g., sendto(handle, destaddr, destport, data)</t>
            </li>
          </ul>
        </li>
      </ul>
      <t>This API is extended to support options as follows:</t>
      <ul spacing="normal">
        <li>
          <t>Extend the method to create receive ports to include per-packet
 and per-fragment receive options that are required or omitted as
 indicated by the application.  </t>
          <t>
>> Datagrams not containing these required options <bcp14>MUST</bcp14> be
 silently dropped and <bcp14>SHOULD</bcp14> be logged.</t>
        </li>
        <li>
          <t>Extend the method to create receive ports to have a means to
 indicate that all packets containing UDP Options that are
 received on a particular socket pair are to be discarded.  </t>
          <t>
>> The default value for the setting to drop all packets
 containing UDP Options <bcp14>MUST</bcp14> be to process packets containing UDP
 Options normally (i.e., not to discard them).</t>
        </li>
        <li>
          <t>Extend the receive function to indicate the per-packet options
 and their parameters as received with the corresponding received
 datagram. Note that per-fragment options are handled within the
 processing of each fragment.  </t>
          <t>
>> Options and their processing status (success/fail) <bcp14>MUST</bcp14> be
 available to the user (i.e., application layer or upper layer
 protocol/service), both for the packet and for the fragment set,
 except for FRAG, NOP, and EOL; those three options are handled
 within UDP Option processing only. As a reminder (from <xref target="sec-opt-inclusion"/>), all options except UNSAFE Options <bcp14>MUST</bcp14> result in the UDP
 user data being passed to the application layer (unless
 overridden in the API), regardless of whether all options are
 processed, supported, or succeed.</t>
        </li>
        <li>
          <t>For fragments, success for an option is reported only when all
 fragments succeed for that option.  </t>
          <t>
>> Per-fragment option status reporting <bcp14>SHOULD</bcp14> default as needed
 (e.g., not computed and/or not passed up to the upper layers) to
 minimize overhead unless actively requested (e.g., by the
	  user/application layer).  </t>
          <t>
>> SAFE Options associated with fragments are accumulated when
 associated with the reassembled packet; values <bcp14>MAY</bcp14> be coalesced,
 e.g., to indicate that only an AUTH failure of a fragment
 occurred, rather than not indicating the AUTH status of each
 fragment.</t>
        </li>
        <li>
          <t>Extend the send function to indicate the options to be added to
 the corresponding sent datagram. This includes indicating which
 options apply to individual fragments vs. which apply to the UDP
 packet prior to fragmentation, if fragmentation is enabled. This
 includes a minimum datagram length, such that the options list
 ends in EOL and additional space is zero-filled as needed. It
 also includes a maximum fragment size, e.g., as discovered by
 DPLPMTUD, whether implemented at the application layer per
 <xref target="RFC8899"/> or in conjunction with other UDP Options <xref target="RFC9869"/>.</t>
        </li>
      </ul>
      <t>Examples of API instances for Linux and FreeBSD are provided in
   <xref target="implementation-information"/> to encourage uniform cross-platform implementations.</t>
      <t>APIs are not intended to provide user control over option order,
   especially on a per-packet basis, as this could create a covert
   channel (see <xref target="sec-sec-cons"/>). Similarly, APIs are not intended to
   provide user/application control over UDP fragment boundaries on a
   per-packet basis; they are, however, expected to allow control over
   which options, including fragmentation, are enabled (or disabled) on
   a per-packet basis. Such control over fragmentation is critical to
   DPLPMTUD.</t>
    </section>
    <section anchor="udp-options-are-for-transport-not-transit">
      <name>UDP Options Are for Transport, Not Transit</name>
      <t>UDP Options are indicated in the surplus area of the IP payload that
   is not used by UDP. That area is really part of the IP payload, not
   the UDP payload, and as such, it might be tempting to consider
   whether this is a generally useful approach to extending IP.</t>
      <t>Unfortunately, the surplus area exists only for transports that
   include their own transport layer payload length indicator. TCP and
   SCTP include header length fields that already provide space for
   transport options by indicating the total length of the header area,
   such that the entire remaining area indicated in the network layer
   (IP) is the transport payload. UDP-Lite already uses the UDP Length
   field to indicate the boundary between data covered by the transport
   checksum and data not covered, and so there is no remaining area
   where the length of the UDP-Lite payload as a whole can be indicated
   <xref target="RFC3828"/>.</t>
      <t>UDP Options are transport options. They are no more (or less)
   appropriate to be modified in-transit than any other portion of the
      transport datagram.</t>
      <t>>> Generally, transport headers, options, and data are not intended
   to be modified in-transit. UDP Options are no exception and are
   specified here as "<bcp14>MUST NOT</bcp14> be altered in transit".</t>
      <t>However, note that the UDP Option mechanism provides no specific
   protection against in-transit modification of the UDP header, UDP
   payload, or surplus area, except as provided by the OCS or the
   options selected (e.g., AUTH or UENC).</t>
      <t>Unless protected by encryption (e.g., UENC or via other layers,
   like IPsec), UDP Options remain visible to devices on the network
   path. The decision to not require mandatory encryption for UDP
   Options to prevent such visibility was made because the key
   distribution and management infrastructure necessary to support such
   encryption does not exist in many of the deployment scenarios of
   interest, notably those that use UDP directly as a stateless and
   connectionless transport protocol (e.g., see <xref target="I-D.heard-dnsop-udp-opt-large-dns-responses"/>).</t>
    </section>
    <section anchor="sec-options-vs-lite">
      <name>UDP Options vs. UDP-Lite</name>
      <t>UDP-Lite provides partial checksum coverage so that UDP packets
   with errors in some locations can be delivered to the user
   <xref target="RFC3828"/>. It uses a different transport protocol number (136) than
   UDP (17) to interpret the UDP Length field as the prefix covered by
   the UDP checksum.</t>
      <t>UDP (protocol 17) already defines the UDP Length field as the limit
   of the UDP checksum but by default also limits the data provided to
   the application as that which precedes the UDP Length. A goal of
   UDP-Lite is to deliver data beyond UDP Length as a default, which is
   why a separate transport protocol number was required.</t>
      <t>UDP Options do not use or need a separate transport protocol number
   because the data beyond the UDP Length offset (surplus data) is not
   provided to the application by default. That data is interpreted
   exclusively within the UDP transport layer.</t>
      <t>UDP-Lite cannot support UDP Options, either as proposed here or in
   any other form, because the entire payload of the UDP packet is
   already defined as user data and there is no additional field in
   which to indicate a surplus area for options. The UDP Length field
   in UDP-Lite is already used to indicate the boundary between user
   data covered by the checksum and user data not covered.</t>
    </section>
    <section anchor="sec-legacy-int">
      <name>Interactions with Legacy Devices</name>
      <t>It has always been permissible for the UDP Length to be inconsistent
   with the IP transport payload length <xref target="RFC0768"/>. Such inconsistency
   has been utilized in UDP-Lite using a different transport number <xref target="RFC3828"/>. 
   There are no known systems that use this inconsistency for UDP. 
   It is possible that such use might interact with UDP
   Options, i.e., where legacy systems might generate UDP datagrams
   that appear to have UDP Options. The OCS provides protection against
   such events and is stronger than a static "magic number".</t>
      <t>UDP Options have been tested as interoperable with Linux, macOS, and
   Windows Cygwin and worked through NAT devices. These systems
   successfully delivered only the user data indicated by the UDP
   Length field and silently discarded the surplus area.</t>
      <t>One reported embedded device passes the entire IP datagram to the
   UDP application layer. Although this feature could enable
   application-layer UDP Option processing, it would require that
   conventional UDP user applications examine only the UDP user data.
   This feature is also inconsistent with the UDP application interface
      <xref target="RFC0768"/> <xref target="RFC1122"/>.</t>
      <t>It has been noted that Alcatel-Lucent's "Brick" Intrusion
   Detection System has a default configuration that interprets
   inconsistencies between UDP Length and IP Length as an attack to be
   reported. Note that other firewall systems, e.g., Check Point, use a
   default "relaxed UDP Length verification" to avoid falsely
      interpreting this inconsistency as an attack.</t>
      <t>There are known uses of UDP exchanges of zero-length UDP user data
   packets, notably in the TIME protocol <xref target="RFC0868"/>. The need to support
   such packets is also noted in the UDP usage guidelines <xref target="RFC8085"/>.
   Some of the mechanisms in this document can generate more zero-length 
   UDP packets for a UDP Option aware endpoint than for a legacy
   endpoint (e.g., based on some error conditions), and some
   can generate fewer (e.g., fragment reassembly). Because such packets
   inherently carry no unique transport header or transport content,
   endpoints are already expected to be tolerant of their (inadvertent)
   replication or loss by the network, so such variations are not
   expected to be problematic.</t>
    </section>
    <section anchor="options-in-a-stateless-unreliable-transport-protocol">
      <name>Options in a Stateless, Unreliable Transport Protocol</name>
      <t>There are two ways to interpret options for a stateless, unreliable
   protocol -- an option is either local to the message or intended to
   affect a stream of messages in a soft-state manner. Either
   interpretation is valid for defined UDP Options.</t>
      <t>It is impossible to know in advance whether an endpoint supports a
   UDP Option.</t>
      <t>>> All UDP Options other than UNSAFE ones <bcp14>MUST</bcp14> be ignored if not
   supported or upon failure (e.g., APC).</t>
      <t>>> All UDP Options that fail <bcp14>MUST</bcp14> result in the UDP data still being
   sent to the application layer by default to ensure equivalence with
   legacy devices.</t>
      <t>UDP Options that rely on soft-state exchange need to allow message
   reordering and loss, in the same way as UDP applications <xref target="RFC8085"/>.</t>
      <t>The above requirements prevent using any option that cannot be
   safely ignored unless it is hidden inside the FRAG area (i.e.,
   UNSAFE Options). Legacy systems also always need to be able to
   interpret the transport fragments as individual UDP packets.</t>
    </section>
    <section anchor="udp-option-state-caching">
      <name>UDP Option State Caching</name>
      <t>Some TCP connection parameters, stored in the TCP Control Block (TCB), can
   be usefully shared either among concurrent connections or between
   connections in sequence, known as TCB sharing <xref target="RFC9040"/>. Although
   UDP is stateless, some of the options proposed herein could have
   similar benefits in being shared or cached. We call this UCB sharing,
   or UDP Control Block sharing, by analogy. Just as TCB sharing is not
   a standard because it is consistent with existing TCP
   specifications, UCB sharing would be consistent with existing UDP
   specifications, including this one. Both are implementation issues
   that are outside the scope of their respective specifications, and
   so UCB sharing is outside the scope of this document.</t>
    </section>
    <section anchor="sec-updates-768">
      <name>Updates to RFC 768</name>
      <t>This document updates <xref target="RFC0768"/> as follows:</t>
      <ul spacing="normal">
        <li>
          <t>This document defines the meaning of the IP payload area beyond
 the UDP Length but within the IP Length as the surplus area used
 herein for UDP Options.</t>
        </li>
        <li>
          <t>This document extends the UDP API to support the use of UDP
 Options.</t>
        </li>
      </ul>
    </section>
    <section anchor="interactions-with-other-rfcs-and-drafts">
      <name>Interactions with Other RFCs</name>
      <t>This document clarifies the interaction between UDP Length and IP
   Length that is not explicitly constrained in either UDP or the host
      requirements <xref target="RFC0768"/> <xref target="RFC1122"/>.</t>
      <t>Teredo extensions define use of a similar difference between
   these lengths for trailers <xref target="RFC4380"/> <xref target="RFC6081"/>. In <xref target="RFC6081"/>, Teredo extensions define the length
   of an IPv6 payload inside UDP as pointing to less than the end of
   the UDP payload, enabling trailing options for that IPv6 packet:</t>
      <blockquote>
        <t>...the IPv6 packet length (i.e., the Payload Length value in
the IPv6 header plus the IPv6 header size) is less than or
equal to the UDP payload length (i.e., the Length value in
the UDP header minus the UDP header size)</t>
      </blockquote>
      <t>UDP Options are not affected by the difference between the UDP user
   payload end and the payload IPv6 end; both would end at the UDP user
   payload, which could end before the enclosing IPv4 or IPv6 header
   indicates -- allowing UDP Options in addition to the trailer options
   of the IPv6 payload. The result, if UDP Options were used, is shown
   in <xref target="fig-19"/>.</t>
      <figure anchor="fig-19">
        <name>TE Trailers and UDP Options Used Concurrently</name>
        <artwork><![CDATA[
                         Outer IP Length
    <---------------------------------------------------------->
   +--------+---------+------------------------------+----------+
   | IP Hdr | UDP Hdr | IPv6 packet/len | TE trailer | surplus  |
   +--------+---------+------------------------------+----------+
                       <--------------->
                       Inner IPv6 Length
             <-------------------------------------->
                           UDP Length
]]></artwork>
      </figure>
      <t>UDP Options cannot be supported when a UDP packet has no independent
   UDP Length. One such case is when UDP Length==0 in IPv6, intended
   for (but not limited to) IPv6 Jumbograms <xref target="RFC2675"/>. Note that
   although this technique is "Standard", the specification did not
   "update" UDP <xref target="RFC0768"/>. Another such case arises when UDP is proxied
   via HTTP <xref target="RFC9298"/>, as the UDP header is omitted and only the UDP
   user data is transported.</t>
      <t>This document is consistent with the UDP profile for RObust Header
   Compression (ROHC) <xref target="RFC3095"/>, noted here:</t>
      <blockquote>
        <t>The Length field of the UDP header <bcp14>MUST</bcp14> match the Length
field(s) of the preceding subheaders, i.e., there must not
be any padding after the UDP payload that is covered by the
IP Length.</t>
      </blockquote>
      <t>ROHC compresses UDP headers only when this match succeeds. It does
   not prohibit UDP headers where the match fails; in those cases, ROHC
   default rules (<xref section="5.10" sectionFormat="of" target="RFC3095"/>) would cause the UDP header to remain
   uncompressed. Upon receipt of a compressed UDP header, <xref section="A.1.3" sectionFormat="of" target="RFC3095"/>
   indicates that the UDP Length is "INFERRED"; in
   uncompressed packets, it would simply be explicitly provided.</t>
      <t>This issue of handling UDP header compression is more explicitly
   described in more recent specifications, e.g., <xref section="10.10" sectionFormat="of" target="RFC8724"/>.</t>
    </section>
    <section anchor="multicast-and-broadcast-considerations">
      <name>Multicast and Broadcast Considerations</name>
      <t>UDP Options are primarily intended for unicast use. Using these
   options over multicast or broadcast IP requires careful
   consideration, e.g., to ensure that the options used are safe for
   different endpoints to interpret differently (e.g., either to
   support or silently ignore) or to ensure that all receivers of a
   multicast or broadcast group confirm support for the options in use.</t>
    </section>
    <section anchor="network-management-considerations">
      <name>Network Management Considerations</name>
      <t>UDP Options use and configuration may be useful to track and manage
   remotely. IP Flow Information Export (IPFIX) <xref target="RFC7011"/> Information
   Elements for UDP Options have been defined in <xref target="RFC9870"/>. Similar to
   what has been done for TCP <xref target="RFC9648"/>, a YANG model <xref target="RFC7950"/> for use
   by network management protocols (e.g., NETCONF <xref target="RFC6241"/> or RESTCONF
   <xref target="RFC8040"/>) may be developed. Development of these models is outside
   the scope of this document.</t>
    </section>
    <section anchor="sec-sec-cons">
      <name>Security Considerations</name>
      <t>There are a number of security issues raised by the introduction of
   options to UDP. Some are specific to this variant, but others are
   associated with any packet processing mechanism; all are discussed
   further in this section.</t>
      <section anchor="general-considerations-regarding-the-use-of-options">
        <name>General Considerations Regarding the Use of Options</name>
        <t>Note that any user application that considers UDP Options to
   adversely affect security need not enable them. However, their use
   does not impact security in a substantially different way than TCP
   options; both enable the use of a control channel that has the
   potential for abuse. Similar to TCP, there are many options that, if
   unprotected, could be used by an attacker to interfere with
   communication.</t>
        <t>UDP Options are not covered by DTLS <xref target="RFC9147"/>. Neither TLS <xref target="RFC8446"/>
   (Transport Layer Security for TCP) nor DTLS (TLS for UDP) protect
   the transport layer; both operate as a shim layer solely on the user
   data of transport packets, protecting only their contents.</t>
        <t>Just as TLS does not protect the TCP header or its options, DTLS
   does not protect the UDP header or the new options introduced by
   this document. Transport security is provided in TCP by the TCP
   Authentication Option (TCP-AO) <xref target="RFC5925"/> and (when defined) in UDP
   by the Authentication (AUTH) Option (<xref target="sec-auth"/>) and (when
   defined) the UNSAFE Encryption (UENC) Option (<xref target="sec-unsafe-opt"/>). Transport
   headers are also protected as payload when using IP security (IPsec)
   <xref target="RFC4301"/>.</t>
        <t>Some UDP Options are never passed to the receiving application,
   notably FRAG, NOP, and EOL. They are not intended to convey
   information, either by their presence (FRAG, EOL) or number (NOP).
   It could also be useful to provide the options received in a
   reference order (e.g., sorted by option number) to avoid the order
   of options being used as a covert channel.</t>
        <t>All logging is rate limited to avoid logging itself becoming a
   resource vulnerability.</t>
      </section>
      <section anchor="considerations-regarding-on-path-attacks">
        <name>Considerations Regarding On-Path Attacks</name>
        <t>UDP Options, like any options, have the potential to expose option
   information to on-path attackers, unless the options themselves are
   encrypted (as might be the case with some configurations of UENC,
   when defined). Application protocol designers are expected to ensure
   that information in UDP Options is not used with the assumption of
   privacy unless UENC provides that capability. Application protocol
   designers using secure payload contents (e.g., via DTLS) are
   expected to be aware that UDP Options add information that is not
   inside the UDP payload and thus not protected by the same mechanism
   and that alternate mechanisms (again, as might be the case with some
   configurations of UENC) could be additionally required to protect
   against information disclosure.</t>
        <t>>> Implementations concerned with the potential use of UDP Options
   as a covert channel <bcp14>MAY</bcp14> consider limiting use of some or all
   options. Such implementations <bcp14>SHOULD</bcp14> return options in an order not
   related to their sequence in the received packet.</t>
        <t>UDP Options create new potential opportunities for Distributed DoS
   (DDos) attacks, notably through the use of fragmentation. When
   enabled, UDP Options cause additional work at the receiver; however,
   of the "must-support" options, only REQ (e.g., when used with
   DPLPMTUD <xref target="RFC9869"/>) will cause the upper layer to initiate a UDP
   response in the absence of user transmission.</t>
        <t>>> Implementations concerned with the potential for DoS attacks
   involving large numbers of UDP Options, either implemented or
   unknown, or excessive sequences of valid repeating options (e.g.,
   NOPs) <bcp14>SHOULD</bcp14> detect excessive numbers of such occurrences and limit
   resources they use, e.g., through silent packet drops. Such
   responses <bcp14>SHOULD</bcp14> be logged. Specific thresholds for such limits will
   vary based on implementation and are thus not included here.</t>
      </section>
      <section anchor="considerations-regarding-option-processing">
        <name>Considerations Regarding Option Processing</name>
        <t>UDP Options use the TLV syntax similar to that of TCP. This syntax
   is known to require serial processing and could pose a DoS risk,
   e.g., if an attacker adds large numbers of unknown options that need
   to be parsed in their entirety, as is the case for IPv6 <xref target="RFC8504"/>.</t>
        <t>The use of UDP packets with inconsistent IP and UDP Length fields
   has the potential to trigger a buffer overflow error if not properly
   handled, e.g., if space is allocated based on the smaller field and
   copying is based on the larger field. However, there have been no reports
   of such vulnerability, and it would rely on inconsistent use of the
   two fields for memory allocation and copying.</t>
        <t>Because required options come first and at most once each (with the
   exception of NOPs, which never need to come in sequences of more
   than seven in a row), their DoS impact is limited. Note that TLV
   formats for options do require serial processing, but any format
   that allows future options, whether ignored or not, could introduce
   a similar DoS vulnerability.</t>
        <t>>> Implementations concerned with the potential for UDP Options
   introducing a vulnerability <bcp14>MAY</bcp14> implement only the required UDP
   Options and <bcp14>SHOULD</bcp14> also limit processing of TLVs, in number
   of non-padding options, total length, or both. The number of non-zero
   TLVs allowed in such cases <bcp14>MUST</bcp14> be at least as many as the
   number of concurrent options supported with an additional few to
   account for unexpected unknown options but <bcp14>SHOULD</bcp14> also consider
   being adaptive and based on the implementation to avoid locking in
   that limit globally.</t>
        <t>For example, if a system supports 10 different option types that could
   concurrently be used, it is expected to allow up to around 13-14
   different options in the same packet. This document avoids
   specifying a fixed minimum but recognizes that a given system might
   not expect to receive more than a few unknown option types per
   packet.</t>
      </section>
      <section anchor="considerations-for-fragmentation">
        <name>Considerations for Fragmentation</name>
        <t>UDP fragmentation introduces its own set of security concerns, which
   can be handled in a manner similar to IP reassembly or TCP segment
   reordering <xref target="CERT18"/>. In particular, the number of UDP packets
   pending reassembly and effort used for reassembly is typically
   limited. In addition, it could be useful to assume a reasonable
   minimum fragment size, e.g., that non-terminal fragments are never
   smaller than 500 bytes.</t>
        <t>>> Implementations concerned with the potential for UDP
   fragmentation introducing a vulnerability <bcp14>SHOULD</bcp14> implement limits on
   the number of pending fragments.</t>
      </section>
      <section anchor="considerations-for-providing-udp-security">
        <name>Considerations for Providing UDP Security</name>
        <t>UDP security is not intended to rely solely on transport layer
   processing of options. UNSAFE Options are the only type that share
   fate with the UDP data because of the way that data is hidden in
   the surplus area until after those options are processed. All other
   options default to being silently ignored at the transport layer but
   could be dropped if that default is either overridden (e.g., by
   configuration) or discarded at the application layer (e.g., using
   information about the options processed that are passed along with
   the UDP packet).</t>
        <t>Options providing UDP security, e.g., AUTH and UENC, require
   endpoint key and security parameter coordination, which UDP Options
   (being stateless) do not facilitate. These parameters include
   whether and when to override the defaults described herein,
   especially at the transmitter as to when emitted packets need to
   include AUTH and at the receiver as to whether (and when) packets
   with failed AUTH and/or without AUTH (or that fail the AUTH checks)
   are not to be forwarded to the user/application.</t>
      </section>
      <section anchor="considerations-regarding-middleboxes">
        <name>Considerations Regarding Middleboxes</name>
        <t>Some middleboxes operate as UDP relays, forwarding data between a
   UDP socket and another transport socket by modifying the IP and/or
   UDP headers without properly acting as a protocol endpoint (i.e., an
   application layer proxy). In such cases, a sender might add UDP
   Options that could be stripped by the middlebox before the packet is
   forwarded to the second socket. A remote application will not
   receive the options (for SAFE Options, the payload data will be
   received; for UNSAFE Options, the payload data will not be received).
   In such cases, the application will function as it would if
   communicating with a remote endpoint that does not support UDP
   Options.</t>
        <t>Additionally, <xref target="Zu20"/> reports that packets containing UDP Options do
   not traverse certain Internet paths; most likely, those options were
   stripped (e.g., by resetting the IP Length to correspond to the UDP
   Length, truncating the surplus area) or packets with options were
   dropped. UDP Options do not function over such paths.</t>
      </section>
    </section>
    <section anchor="sec-iana-cons">
      <name>IANA Considerations</name>
      <t>IANA has created the "User Datagram Protocol (UDP)" registry group, which 
      consists of the "UDP Option Kind Numbers" registry and a pointer to the unified "TCP/UDP Experimental Option Experiment Identifiers (TCP/UDP ExIDs)" registry.  Note that the "TCP experimental IDs (ExIDs)" registry has been renamed as the "TCP/UDP Experimental Option Experiment Identifiers (TCP/UDP ExIDs)" registry, and is a unified registry for both TCP and UDP ExIDs.  IANA has added the following note to the unified TCP/UDP ExID registry:</t>
      
<blockquote>
    16-bit ExIDs can be used with either TCP or UDP; 32-bit ExIDs can be 
    used with TCP or their first 16 bits can be used with UDP. Use with 
    each transport (TCP, UDP) is indicated in the protocol column, as 
    defined in RFC 9868. 
</blockquote>

      <t>Initial values of the "UDP Option Kind Numbers" registry are as listed in
   <xref target="sec-udp-opt"/>, including those both assigned and reserved. Additional
   values in this registry are to be assigned from the Unassigned
   values in <xref target="sec-udp-opt"/> by IESG Approval or Standards Action <xref target="RFC8126"/>.
   Those assignments are subject to the conditions set forth in this
   document, particularly (but not limited to) those in <xref target="sec-rules"/>.</t>
      <t>>> Although option nicknames are not used in-band, new UNSAFE
   Option names <bcp14>MUST</bcp14> commence with the capital letter "U" and new SAFE
   Options <bcp14>MUST NOT</bcp14> commence with either uppercase or lowercase "U".</t>
      <t>IANA has added the following note to the "UDP Option Kind Numbers" indicating
   entries are mandatory to implement when UDP Options are supported.  
   No new options may be created that are mandatory to
   implement in all UDP Options implementations.</t>
      <blockquote>
        <t>Codepoints 0-7 <bcp14>MUST</bcp14> be supported on any implementation
supporting UDP Options. All others are supported at the
discretion of each implementation.</t>
      </blockquote>

      <t>UDP Experimental Option Experiment Identifiers (UDP ExIDs) are
   intended for use in a similar manner as TCP ExIDs <xref target="RFC6994"/>. Both
   TCP and UDP ExIDs are managed as a single, unified registry because
   such options could be used for both transport protocols and because
   the option space is large enough that there is no clear need to
   maintain them separately. This new TCP/UDP ExIDs registry has entries
   for both transports, although each codepoint needs to be explicitly
   defined for each transport protocol in which it is used, i.e.,
   defining a codepoint in TCP does not imply it has a similar use in
   UDP. IANA has added a "Protocol" field to the registry and updated
   the current TCP ExIDs to be indicated as defined for TCP.  New assignments are to indicate the transport for which
   it is defined.</t>

      <t>TCP/UDP ExIDs can be used in either (or both) the UDP EXP (<xref target="sec-exp"/>) or UEXP (<xref target="sec-uexp"/>) Options. TCP/UDP ExID entries for use
   in UDP consist of a 16-bit ExID (in network-standard order), and (as
   with the original TCP ExIDs) will preferentially also include a
   short description and acronym for use in documentation. TCP/UDP
   ExIDs used for UDP are always 16 bits because their use in EXP and
   UEXP Options is required and thus do not need a larger codepoint
   value to decrease the probability of accidental occurrence with non-ExID
   uses of the experimental options, as is the case with TCP ExIDs
   (e.g., when using 32-bit ExIDs). ExIDs defined solely for TCP
   options could be either 16 or 32 bits and all ExIDs (including now
   UDP) need to be unique in their first 16 bits, as originally
   described for TCP <xref target="RFC6994"/>.</t>
      <t>Values in the TCP/UDP ExID registry are to be assigned by IANA using
   the First Come First Served (FCFS) policy <xref target="RFC8126"/>, which applies to both the ExID value
   and the acronym. UDP Options using these ExIDs are subject
   to the same conditions as new UDP Options, i.e., they too are
   subject to the conditions set forth in this document, particularly
   (but not limited to) those in <xref target="sec-rules"/>.</t>
    </section>
  </middle>
  <back>

<displayreference target="I-D.heard-dnsop-udp-opt-large-dns-responses" to="He24"/>
<displayreference target="I-D.fairhurst-udp-options-cco" to="Fa18"/>
<displayreference target="I-D.hildebrand-spud-prototype" to="Hi15"/>
<displayreference target="I-D.touch-tcp-ao-encrypt" to="To18"/>
<displayreference target="I-D.touch-tsvwg-udp-auth-opt" to="To24"/>

    <references anchor="sec-combined-references">
      <name>References</name>
      <references anchor="sec-normative-references">
        <name>Normative References</name>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.0768.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.0791.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.1122.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml"/>

<reference anchor="RFC9869" target="https://www.rfc-editor.org/info/rfc9869">
  <front>
<title>Datagram Packetization Layer Path MTU Discovery (DPLPMTUD) for UDP Options</title>
<author initials="G." surname="Fairhurst" fullname="Gorry Fairhurst">
<organization>University of Aberdeen</organization>
</author>
<author initials="T." surname="Jones" fullname="Tom Jones">
  <organization>University of Aberdeen</organization>
</author>
<date month="October" year="2025"/>
</front>
<seriesInfo name="RFC" value="9869"/>
<seriesInfo name="DOI" value="10.17487/RFC9869"/>
</reference>

      </references>
      <references anchor="sec-informative-references">
        <name>Informative References</name>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.0793.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.0868.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.1071.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.1141.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.1191.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.2675.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.2923.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.3095.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.3173.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.3385.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.3692.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.3828.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.4301.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.4340.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.4380.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.4787.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.5925.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.6081.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.6241.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.6864.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.6935.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.6978.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.6994.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.7011.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.7323.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.7950.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8040.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8085.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8126.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8200.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8201.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8446.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8504.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8724.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8899.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9040.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9147.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9187.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9260.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9293.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9298.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9648.xml"/>

<reference anchor="RFC9870" target="https://www.rfc-editor.org/info/rfc9870">
<front>
<title>
Export of UDP Options Information in IP Flow Information Export (IPFIX)
</title>
<author fullname="Mohamed Boucadair" initials="M." surname="Boucadair">
<organization>Orange</organization>
</author>
<author fullname="Tirumaleswar Reddy.K" initials="T." surname="Reddy.K">
<organization>Nokia</organization>
</author>
<date month="October" year="2025"/>
</front>
<seriesInfo name="RFC" value="9870"/>
<seriesInfo name="DOI" value="10.17487/RFC9870"/>
</reference>

        <xi:include href="https://bib.ietf.org/public/rfc/bibxml3/reference.I-D.heard-dnsop-udp-opt-large-dns-responses.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml3/reference.I-D.draft-fairhurst-udp-options-cco-00.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml3/reference.I-D.draft-hildebrand-spud-prototype-03.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml3/reference.I-D.touch-tcp-ao-encrypt.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml3/reference.I-D.draft-touch-tsvwg-udp-auth-opt-00.xml"/>

        <reference anchor="CERT18" target="https://www.kb.cert.org/vuls/id/962459">
          <front>
            <title>TCP implementations vulnerable to Denial of Service</title>
            <author>
              <organization>CERT Coordination Center</organization>
            </author>
            <date year="2018"/>
          </front>
          <refcontent>Vulnerability Note VU#962459</refcontent>
          <refcontent>Software Engineering Institute, CMU</refcontent>
        </reference>

        <reference anchor="La78">
          <front>
            <title>Time, clocks, and the ordering of events in a distributed system</title>
            <author initials="L." surname="Lamport" fullname="Leslie Lamport">
              <organization/>
            </author>
            <date year="1978" month="July"/>
          </front>
          <refcontent>Communications of the ACM, vol. 21, no. 7, pp. 558-565</refcontent>
          <seriesInfo name="DOI" value="10.1145/359545.359563"/>
        </reference>

        <reference anchor="Zu20" target="https://dl.ifip.org/db/conf/tma/tma2020/tma2020-camera-paper70.pdf">
          <front>
            <title>Overcoming the Sorrows of the Young UDP Options</title>
            <author initials="R." surname="Zullo">
              <organization/>
            </author>
            <author initials="T." surname="Jones">
              <organization/>
            </author>
            <author initials="G." surname="Fairhurst">
              <organization/>
            </author>
            <date year="2020"/>
          </front>
          <refcontent>4th Network Traffic Measurement and Analysis Conference (TMA)</refcontent>
        </reference>
      </references>
    </references>
    <?line 2451?>

<section anchor="implementation-information">
      <name>Implementation Information</name>
      <t>The following information is provided to encourage consistent naming
   for API implementations.</t>
      <t>System-level variables (sysctl):</t>
      <table>
        <thead>
          <tr>
            <th align="left">Name</th>
            <th align="left">Default</th>
            <th align="left">Meaning</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left">net.ipv4.udp_opt</td>
            <td align="left">0</td>
            <td align="left">UDP Options available</td>
          </tr>
          <tr>
            <td align="left">net.ipv4.udp_opt_ocs</td>
            <td align="left">1</td>
            <td align="left">Use OCS</td>
          </tr>
          <tr>
            <td align="left">net.ipv4.udp_opt_apc</td>
            <td align="left">0</td>
            <td align="left">Include APC</td>
          </tr>
          <tr>
            <td align="left">net.ipv4.udp_opt_frag</td>
            <td align="left">0</td>
            <td align="left">Fragment</td>
          </tr>
          <tr>
            <td align="left">net.ipv4.udp_opt_mds</td>
            <td align="left">0</td>
            <td align="left">Include MDS</td>
          </tr>
          <tr>
            <td align="left">net.ipv4.udp_opt_mrds</td>
            <td align="left">0</td>
            <td align="left">Include MRDS</td>
          </tr>
          <tr>
            <td align="left">net.ipv4.udp_opt_req</td>
            <td align="left">0</td>
            <td align="left">Include REQ</td>
          </tr>
          <tr>
            <td align="left">net.ipv4.udp_opt_resp</td>
            <td align="left">0</td>
            <td align="left">Include RES</td>
          </tr>
          <tr>
            <td align="left">net.ipv4.udp_opt_time</td>
            <td align="left">0</td>
            <td align="left">Include TIME</td>
          </tr>
          <tr>
            <td align="left">net.ipv4.udp_opt_auth</td>
            <td align="left">0</td>
            <td align="left">Include AUTH</td>
          </tr>
          <tr>
            <td align="left">net.ipv4.udp_opt_exp</td>
            <td align="left">0</td>
            <td align="left">Include EXP</td>
          </tr>
          <tr>
            <td align="left">net.ipv4.udp_opt_ucmp</td>
            <td align="left">0</td>
            <td align="left">Include UCMP</td>
          </tr>
          <tr>
            <td align="left">net.ipv4.udp_opt_uenc</td>
            <td align="left">0</td>
            <td align="left">Include UENC</td>
          </tr>
          <tr>
            <td align="left">net.ipv4.udp_opt_uexp</td>
            <td align="left">0</td>
            <td align="left">Include UEXP</td>
          </tr>
        </tbody>
      </table>
      <t>Socket options (sockopt), cached for outgoing datagrams:</t>
      <table>
        <thead>
          <tr>
            <th align="left">Name</th>
            <th align="left">Meaning</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left">UDP_OPT</td>
            <td align="left">Enable UDP Options (at all)</td>
          </tr>
          <tr>
            <td align="left">UDP_OPT_OCS</td>
            <td align="left">Use UDP OCS</td>
          </tr>
          <tr>
            <td align="left">UDP_OPT_APC</td>
            <td align="left">Enable UDP APC Option</td>
          </tr>
          <tr>
            <td align="left">UDP_OPT_FRAG</td>
            <td align="left">Enable UDP fragmentation</td>
          </tr>
          <tr>
            <td align="left">UDP OPT MDS</td>
            <td align="left">Enable UDP MDS Option</td>
          </tr>
          <tr>
            <td align="left">UDP OPT MRDS</td>
            <td align="left">Enable UDP MRDS Option</td>
          </tr>
          <tr>
            <td align="left">UDP OPT REQ</td>
            <td align="left">Enable UDP REQ Option</td>
          </tr>
          <tr>
            <td align="left">UDP OPT RES</td>
            <td align="left">Enable UDP RES Option</td>
          </tr>
          <tr>
            <td align="left">UDP_OPT_TIME</td>
            <td align="left">Enable UDP TIME Option</td>
          </tr>
          <tr>
            <td align="left">UDP OPT AUTH</td>
            <td align="left">Enable UDP AUTH Option</td>
          </tr>
          <tr>
            <td align="left">UDP OPT EXP</td>
            <td align="left">Enable UDP EXP Option</td>
          </tr>
          <tr>
            <td align="left">UDP_OPT_UCMP</td>
            <td align="left">Enable UDP UCMP Option</td>
          </tr>
          <tr>
            <td align="left">UDP_OPT_UENC</td>
            <td align="left">Enable UDP UENC Option</td>
          </tr>
          <tr>
            <td align="left">UDP OPT UEXP</td>
            <td align="left">Enable UDP UEXP Option</td>
          </tr>
        </tbody>
      </table>
      <t>Send/sendto parameters:</t>
      <ul spacing="normal">
        <li>
          <t>(Same as sysctl, with different prefixes)</t>
        </li>
      </ul>
      <t>Connection parameters (per-socket pair cached state, part UCB):</t>
      <table>
        <thead>
          <tr>
            <th align="left">Name</th>
            <th align="left">Initial Value</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left">opts_enabled</td>
            <td align="left">net.ipv4.udp_opt</td>
          </tr>
          <tr>
            <td align="left">ocs_enabled</td>
            <td align="left">net.ipv4.udp_opt_ocs</td>
          </tr>
        </tbody>
      </table>
      <t>NB: The JUNK Option is included for debugging purposes and is not
   intended to be enabled otherwise.</t>
      <t>System variables:</t>
      <t>net.ipv4.udp_opt_junk   0</t>
      <t>System-level variables (sysctl):</t>
      <table>
        <thead>
          <tr>
            <th align="left">Name</th>
            <th align="left">Default</th>
            <th align="left">Meaning</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left">net.ipv4.udp_opt_junk</td>
            <td align="left">0</td>
            <td align="left">Default use of junk</td>
          </tr>
        </tbody>
      </table>
      <t>Socket options (sockopt):</t>
      <table>
        <thead>
          <tr>
            <th align="left">Name</th>
            <th align="left">Params</th>
            <th align="left">Meaning</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left">UDP_JUNK</td>
            <td align="left">-</td>
            <td align="left">Enable UDP junk option</td>
          </tr>
          <tr>
            <td align="left">UDP_JUNK_VAL</td>
            <td align="left">fillval</td>
            <td align="left">Value to use as junk fill</td>
          </tr>
          <tr>
            <td align="left">UDP_JUNK_LEN</td>
            <td align="left">length</td>
            <td align="left">Length of junk payload in bytes</td>
          </tr>
        </tbody>
      </table>
      <t>Connection parameters (per-socket pair cached state, part UCB):</t>
      <table>
        <thead>
          <tr>
            <th align="left">Name</th>
            <th align="left">Initial Value</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left">junk_enabled</td>
            <td align="left">net.ipv4.udp_opt_junk</td>
          </tr>
          <tr>
            <td align="left">junk_value</td>
            <td align="left">0xABCD</td>
          </tr>
          <tr>
            <td align="left">junk_len</td>
            <td align="left">4</td>
          </tr>
        </tbody>
      </table>
    </section>
    <section numbered="false" anchor="acks">
      <name>Acknowledgments</name>
      <t>This work benefitted from feedback from <contact fullname="Erik Auerswald"/>, <contact fullname="Bob Briscoe"/>,
<contact fullname="Ken Calvert"/>, <contact fullname="Ted Faber"/>, <contact fullname="Gorry Fairhurst"/> (including OCS for errant
middlebox traversal), <contact fullname="C. M. Heard"/> (editor of this document, including
combining previous FRAG and LITE Options into the new FRAG, as well
as <xref target="fig-12"/>), <contact fullname="Tom Herbert"/>, <contact fullname="Tom Jones"/>, <contact fullname="Mark Smith"/>, <contact fullname="Carl Williams"/>,
and <contact fullname="Raffaele Zullo"/>, as well as discussions on the IETF TSVWG and
SPUD email lists.</t>
      <t>This work was partly supported by USC/ISI's Postel Center.</t>
    </section>
  </back>
</rfc>
